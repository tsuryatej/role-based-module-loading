{"version":3,"file":"_widget-chunk.mjs","sources":["../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/event-manager/event-manager.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/event-manager/keyboard-event-manager.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/event-manager/pointer-event-manager.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/list-focus/list-focus.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/list-navigation/list-navigation.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/grid/grid-data.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/grid/grid-focus.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/grid/grid-navigation.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/grid/grid-selection.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/grid/grid.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/grid/grid.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/grid/row.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/grid/cell.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/grid/widget.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\n/**\n * An event that supports modifier keys.\n *\n * Matches the native KeyboardEvent, MouseEvent, and TouchEvent.\n */\nexport interface EventWithModifiers extends Event {\n  ctrlKey: boolean;\n  shiftKey: boolean;\n  altKey: boolean;\n  metaKey: boolean;\n}\n\n/**\n * Options that are applicable to all event handlers.\n *\n * This library has not yet had a need for stopPropagationImmediate.\n */\nexport interface EventHandlerOptions {\n  stopPropagation: boolean;\n  preventDefault: boolean;\n}\n\n/** A basic event handler. */\nexport type EventHandler<T extends Event> = (event: T) => void;\n\n/** A function that determines whether an event is to be handled. */\nexport type EventMatcher<T extends Event> = (event: T) => boolean;\n\n/** A config that specifies how to handle a particular event. */\nexport interface EventHandlerConfig<T extends Event> extends EventHandlerOptions {\n  matcher: EventMatcher<T>;\n  handler: EventHandler<T>;\n}\n\n/** Bit flag representation of the possible modifier keys that can be present on an event. */\nexport enum Modifier {\n  None = 0,\n  Ctrl = 0b1,\n  Shift = 0b10,\n  Alt = 0b100,\n  Meta = 0b1000,\n  Any = 'Any',\n}\n\nexport type ModifierInputs = Modifier | Modifier[];\n\n/**\n * Abstract base class for all event managers.\n *\n * Event managers are designed to normalize how event handlers are authored and create a safety net\n * for common event handling gotchas like remembering to call preventDefault or stopPropagation.\n */\nexport abstract class EventManager<T extends Event> {\n  protected configs: EventHandlerConfig<T>[] = [];\n  abstract options: EventHandlerOptions;\n\n  /** Runs the handlers that match with the given event. */\n  handle(event: T): void {\n    for (const config of this.configs) {\n      if (config.matcher(event)) {\n        config.handler(event);\n\n        if (config.preventDefault) {\n          event.preventDefault();\n        }\n\n        if (config.stopPropagation) {\n          event.stopPropagation();\n        }\n      }\n    }\n  }\n\n  /** Configures the event manager to handle specific events. (See subclasses for more). */\n  abstract on(...args: [...unknown[]]): this;\n}\n\n/** Gets bit flag representation of the modifier keys present on the given event. */\nexport function getModifiers(event: EventWithModifiers): number {\n  return (\n    (+event.ctrlKey && Modifier.Ctrl) |\n    (+event.shiftKey && Modifier.Shift) |\n    (+event.altKey && Modifier.Alt) |\n    (+event.metaKey && Modifier.Meta)\n  );\n}\n\n/**\n * Checks if the given event has modifiers that are an exact match for any of the given modifier\n * flag combinations.\n */\nexport function hasModifiers(event: EventWithModifiers, modifiers: ModifierInputs): boolean {\n  const eventModifiers = getModifiers(event);\n  const modifiersList = Array.isArray(modifiers) ? modifiers : [modifiers];\n\n  if (modifiersList.includes(Modifier.Any)) {\n    return true;\n  }\n\n  return modifiersList.some(modifiers => eventModifiers === modifiers);\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {SignalLike} from '../signal-like/signal-like';\nimport {\n  EventHandler,\n  EventHandlerOptions,\n  EventManager,\n  hasModifiers,\n  ModifierInputs,\n  Modifier,\n} from './event-manager';\n\n/**\n * Used to represent a keycode.\n *\n * This is used to match whether an events keycode should be handled. The ability to match using a\n * string, SignalLike, or Regexp gives us more flexibility when authoring event handlers.\n */\ntype KeyCode = string | SignalLike<string> | RegExp;\n\n/**\n * An event manager that is specialized for handling keyboard events. By default this manager stops\n * propagation and prevents default on all events it handles.\n */\nexport class KeyboardEventManager<T extends KeyboardEvent> extends EventManager<T> {\n  options: EventHandlerOptions = {\n    preventDefault: true,\n    stopPropagation: true,\n  };\n\n  /** Configures this event manager to handle events with a specific key and no modifiers. */\n  on(key: KeyCode, handler: EventHandler<T>, options?: Partial<EventHandlerOptions>): this;\n\n  /**  Configures this event manager to handle events with a specific modifer and key combination. */\n  on(\n    modifiers: ModifierInputs,\n    key: KeyCode,\n    handler: EventHandler<T>,\n    options?: Partial<EventHandlerOptions>,\n  ): this;\n\n  on(...args: any[]) {\n    const {modifiers, key, handler, options} = this._normalizeInputs(...args);\n\n    this.configs.push({\n      handler: handler,\n      matcher: event => this._isMatch(event, key, modifiers),\n      ...this.options,\n      ...options,\n    });\n\n    return this;\n  }\n\n  private _normalizeInputs(...args: any[]) {\n    const withModifiers = Array.isArray(args[0]) || args[0] in Modifier;\n    const modifiers = withModifiers ? args[0] : Modifier.None;\n    const key = withModifiers ? args[1] : args[0];\n    const handler = withModifiers ? args[2] : args[1];\n    const options = withModifiers ? args[3] : args[2];\n\n    return {\n      key: key as KeyCode,\n      handler: handler as EventHandler<T>,\n      modifiers: modifiers as ModifierInputs,\n      options: (options ?? {}) as Partial<EventHandlerOptions>,\n    };\n  }\n\n  private _isMatch(event: T, key: KeyCode, modifiers: ModifierInputs) {\n    if (!hasModifiers(event, modifiers)) {\n      return false;\n    }\n\n    if (key instanceof RegExp) {\n      return key.test(event.key);\n    }\n\n    const keyStr = typeof key === 'string' ? key : key();\n    return keyStr.toLowerCase() === event.key.toLowerCase();\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {\n  EventHandler,\n  EventHandlerOptions,\n  EventManager,\n  hasModifiers,\n  ModifierInputs,\n  Modifier,\n} from './event-manager';\n\n/**\n * The different mouse buttons that may appear on a pointer event.\n */\nexport enum MouseButton {\n  Main = 0,\n  Auxiliary = 1,\n  Secondary = 2,\n}\n\n/** An event manager that is specialized for handling pointer events. */\nexport class PointerEventManager<T extends PointerEvent> extends EventManager<T> {\n  options: EventHandlerOptions = {\n    preventDefault: false,\n    stopPropagation: false,\n  };\n\n  /**\n   * Configures this event manager to handle events with a specific modifer and mouse button\n   * combination.\n   */\n  on(button: MouseButton, modifiers: ModifierInputs, handler: EventHandler<T>): this;\n\n  /**\n   * Configures this event manager to handle events with a specific mouse button and no modifiers.\n   */\n  on(modifiers: ModifierInputs, handler: EventHandler<T>): this;\n\n  /**\n   * Configures this event manager to handle events with the main mouse button and no modifiers.\n   *\n   * @param handler The handler function\n   * @param options Options for whether to stop propagation or prevent default.\n   */\n  on(handler: EventHandler<T>): this;\n\n  on(...args: any[]) {\n    const {button, handler, modifiers} = this._normalizeInputs(...args);\n\n    this.configs.push({\n      handler,\n      matcher: event => this._isMatch(event, button, modifiers),\n      ...this.options,\n    });\n    return this;\n  }\n\n  private _normalizeInputs(...args: any[]) {\n    if (args.length === 3) {\n      return {\n        button: args[0] as MouseButton,\n        modifiers: args[1] as ModifierInputs,\n        handler: args[2] as EventHandler<T>,\n      };\n    }\n\n    if (args.length === 2) {\n      return {\n        button: MouseButton.Main,\n        modifiers: args[0] as ModifierInputs,\n        handler: args[1] as EventHandler<T>,\n      };\n    }\n\n    return {\n      button: MouseButton.Main,\n      modifiers: Modifier.None,\n      handler: args[0] as EventHandler<T>,\n    };\n  }\n\n  _isMatch(event: PointerEvent, button: MouseButton, modifiers: ModifierInputs) {\n    return button === (event.button ?? 0) && hasModifiers(event, modifiers);\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed, signal} from '@angular/core';\nimport {SignalLike, WritableSignalLike} from '../signal-like/signal-like';\n\n/** Represents an item in a collection, such as a listbox option, than may receive focus. */\nexport interface ListFocusItem {\n  /** A unique identifier for the item. */\n  id: SignalLike<string>;\n\n  /** The html element that should receive focus. */\n  element: SignalLike<HTMLElement | undefined>;\n\n  /** Whether an item is disabled. */\n  disabled: SignalLike<boolean>;\n\n  /** The index of the item in the list. */\n  index: SignalLike<number>;\n}\n\n/** Represents the required inputs for a collection that contains focusable items. */\nexport interface ListFocusInputs<T extends ListFocusItem> {\n  /** The focus strategy used by the list. */\n  focusMode: SignalLike<'roving' | 'activedescendant'>;\n\n  /** Whether the list is disabled. */\n  disabled: SignalLike<boolean>;\n\n  /** The items in the list. */\n  items: SignalLike<T[]>;\n\n  /** The active item. */\n  activeItem: WritableSignalLike<T | undefined>;\n\n  /** Whether disabled items in the list should be focusable. */\n  softDisabled: SignalLike<boolean>;\n\n  element: SignalLike<HTMLElement | undefined>;\n}\n\n/** Controls focus for a list of items. */\nexport class ListFocus<T extends ListFocusItem> {\n  /** The last item that was active. */\n  prevActiveItem = signal<T | undefined>(undefined);\n\n  /** The index of the last item that was active. */\n  prevActiveIndex = computed(() => {\n    return this.prevActiveItem() ? this.inputs.items().indexOf(this.prevActiveItem()!) : -1;\n  });\n\n  /** The current active index in the list. */\n  activeIndex = computed(() => {\n    return this.inputs.activeItem() ? this.inputs.items().indexOf(this.inputs.activeItem()!) : -1;\n  });\n\n  constructor(readonly inputs: ListFocusInputs<T>) {}\n\n  /** Whether the list is in a disabled state. */\n  isListDisabled(): boolean {\n    return this.inputs.disabled() || this.inputs.items().every(i => i.disabled());\n  }\n\n  /** The id of the current active item. */\n  getActiveDescendant(): string | undefined {\n    if (this.isListDisabled()) {\n      return undefined;\n    }\n    if (this.inputs.focusMode() === 'roving') {\n      return undefined;\n    }\n    return this.inputs.activeItem()?.id() ?? undefined;\n  }\n\n  /** The tab index for the list. */\n  getListTabIndex(): -1 | 0 {\n    if (this.isListDisabled()) {\n      return 0;\n    }\n    return this.inputs.focusMode() === 'activedescendant' ? 0 : -1;\n  }\n\n  /** Returns the tab index for the given item. */\n  getItemTabIndex(item: T): -1 | 0 {\n    if (this.isListDisabled()) {\n      return -1;\n    }\n    if (this.inputs.focusMode() === 'activedescendant') {\n      return -1;\n    }\n    return this.inputs.activeItem() === item ? 0 : -1;\n  }\n\n  /** Moves focus to the given item if it is focusable. */\n  focus(item: T, opts?: {focusElement?: boolean}): boolean {\n    if (this.isListDisabled() || !this.isFocusable(item)) {\n      return false;\n    }\n\n    this.prevActiveItem.set(this.inputs.activeItem());\n    this.inputs.activeItem.set(item);\n\n    if (opts?.focusElement || opts?.focusElement === undefined) {\n      this.inputs.focusMode() === 'roving'\n        ? item.element()?.focus()\n        : this.inputs.element()?.focus();\n    }\n\n    return true;\n  }\n\n  /** Returns true if the given item can be navigated to. */\n  isFocusable(item: T): boolean {\n    return !item.disabled() || this.inputs.softDisabled();\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {SignalLike} from '../signal-like/signal-like';\nimport {ListFocus, ListFocusInputs, ListFocusItem} from '../list-focus/list-focus';\n\n/** Represents an item in a collection, such as a listbox option, than can be navigated to. */\nexport interface ListNavigationItem extends ListFocusItem {}\n\n/** Represents the required inputs for a collection that has navigable items. */\nexport interface ListNavigationInputs<T extends ListNavigationItem> extends ListFocusInputs<T> {\n  /** Whether focus should wrap when navigating. */\n  wrap: SignalLike<boolean>;\n\n  /** Whether the list is vertically or horizontally oriented. */\n  orientation: SignalLike<'vertical' | 'horizontal'>;\n\n  /** The direction that text is read based on the users locale. */\n  textDirection: SignalLike<'rtl' | 'ltr'>;\n}\n\n/** Controls navigation for a list of items. */\nexport class ListNavigation<T extends ListNavigationItem> {\n  constructor(readonly inputs: ListNavigationInputs<T> & {focusManager: ListFocus<T>}) {}\n\n  /** Navigates to the given item. */\n  goto(item?: T, opts?: {focusElement?: boolean}): boolean {\n    return item ? this.inputs.focusManager.focus(item, opts) : false;\n  }\n\n  /** Navigates to the next item in the list. */\n  next(opts?: {focusElement?: boolean}): boolean {\n    return this._advance(1, opts);\n  }\n\n  /** Peeks the next item in the list. */\n  peekNext(): T | undefined {\n    return this._peek(1);\n  }\n\n  /** Navigates to the previous item in the list. */\n  prev(opts?: {focusElement?: boolean}): boolean {\n    return this._advance(-1, opts);\n  }\n\n  /** Peeks the previous item in the list. */\n  peekPrev(): T | undefined {\n    return this._peek(-1);\n  }\n\n  /** Navigates to the first item in the list. */\n  first(opts?: {focusElement?: boolean}): boolean {\n    const item = this.peekFirst();\n    return item ? this.goto(item, opts) : false;\n  }\n\n  /** Navigates to the last item in the list. */\n  last(opts?: {focusElement?: boolean}): boolean {\n    const item = this.peekLast();\n    return item ? this.goto(item, opts) : false;\n  }\n\n  /** Gets the first focusable item from the given list of items. */\n  peekFirst(items: T[] = this.inputs.items()): T | undefined {\n    return items.find(i => this.inputs.focusManager.isFocusable(i));\n  }\n\n  /** Gets the last focusable item from the given list of items. */\n  peekLast(items: T[] = this.inputs.items()): T | undefined {\n    for (let i = items.length - 1; i >= 0; i--) {\n      if (this.inputs.focusManager.isFocusable(items[i])) {\n        return items[i];\n      }\n    }\n    return;\n  }\n\n  /** Advances to the next or previous focusable item in the list based on the given delta. */\n  private _advance(delta: 1 | -1, opts?: {focusElement?: boolean}): boolean {\n    const item = this._peek(delta);\n    return item ? this.goto(item, opts) : false;\n  }\n\n  /** Peeks the next or previous focusable item in the list based on the given delta. */\n  private _peek(delta: 1 | -1): T | undefined {\n    const items = this.inputs.items();\n    const itemCount = items.length;\n    const startIndex = this.inputs.focusManager.activeIndex();\n    const step = (i: number) =>\n      this.inputs.wrap() ? (i + delta + itemCount) % itemCount : i + delta;\n\n    // If wrapping is enabled, this loop ultimately terminates when `i` gets back to `startIndex`\n    // in the case that all options are disabled. If wrapping is disabled, the loop terminates\n    // when the index goes out of bounds.\n    for (let i = step(startIndex); i !== startIndex && i < itemCount && i >= 0; i = step(i)) {\n      if (this.inputs.focusManager.isFocusable(items[i])) {\n        return items[i];\n      }\n    }\n\n    return;\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed} from '@angular/core';\nimport {SignalLike} from '../signal-like/signal-like';\n\n/** Represents coordinates in a grid. */\nexport interface RowCol {\n  /** The row index. */\n  row: number;\n\n  /** The column index. */\n  col: number;\n}\n\n/** A string representation of grid coordinates. */\ntype CoordString = `${RowCol['row']}:${RowCol['col']}`;\n\n/** The base interface for a cell in a grid. */\nexport interface BaseGridCell {\n  /** The number of rows the cell should span. */\n  rowSpan: SignalLike<number>;\n\n  /** The number of columns the cell should span. */\n  colSpan: SignalLike<number>;\n}\n\n/** Represents the required inputs for GridData. */\nexport interface GridDataInputs<T extends BaseGridCell> {\n  /** The two-dimensional array of cells that represents the grid. */\n  cells: SignalLike<T[][]>;\n}\n\n/** Controls internal coordinates for a grid of items. */\nexport class GridData<T extends BaseGridCell> {\n  /** The two-dimensional array of cells that represents the grid. */\n  readonly cells: SignalLike<T[][]>;\n\n  /** The maximum number of rows in the grid, accounting for row spans. */\n  readonly maxRowCount = computed<number>(() => Math.max(...this._rowCountByCol().values(), 0));\n\n  /** The maximum number of columns in the grid, accounting for column spans. */\n  readonly maxColCount = computed<number>(() => Math.max(...this._colCountsByRow().values(), 0));\n\n  /** A map from a cell to its primary and spanned coordinates. */\n  private readonly _coordsMap = computed<Map<T, {coords: RowCol; spanCoords: RowCol[]}>>(() => {\n    const coordsMap = new Map();\n    const visitedCoords = new Set();\n\n    for (let rowIndex = 0; rowIndex < this.cells().length; rowIndex++) {\n      let colIndex = 0;\n      const row = this.cells()[rowIndex];\n\n      for (const cell of row) {\n        // Skip past cells that are already taken.\n        while (visitedCoords.has(`${rowIndex}:${colIndex}`)) {\n          colIndex++;\n        }\n\n        const rowspan = cell.rowSpan();\n        const colspan = cell.colSpan();\n        const spanCoords: RowCol[] = [];\n\n        for (let rowOffset = 0; rowOffset < rowspan; rowOffset++) {\n          const row = rowIndex + rowOffset;\n          for (let colOffset = 0; colOffset < colspan; colOffset++) {\n            const col = colIndex + colOffset;\n            visitedCoords.add(`${row}:${col}`);\n            spanCoords.push({row, col});\n          }\n        }\n        coordsMap.set(cell, {coords: spanCoords[0], spanCoords});\n\n        colIndex += colspan;\n      }\n    }\n\n    return coordsMap;\n  });\n\n  /** A map from a coordinate string to the cell at that coordinate. */\n  private readonly _cellMap = computed<Map<CoordString, T>>(() => {\n    const cellMap = new Map();\n    for (const [cell, {spanCoords}] of this._coordsMap().entries()) {\n      for (const {row, col} of spanCoords) {\n        cellMap.set(`${row}:${col}`, cell);\n      }\n    }\n    return cellMap;\n  });\n\n  /** A map from a row index to the number of columns in that row. */\n  private readonly _colCountsByRow = computed<Map<number, number>>(() => {\n    const colCountByRow = new Map();\n    for (const [_, {spanCoords}] of this._coordsMap().entries()) {\n      for (const {row, col} of spanCoords) {\n        const colCount = colCountByRow.get(row);\n        const newColCount = col + 1;\n        if (colCount === undefined || colCount < newColCount) {\n          colCountByRow.set(row, newColCount);\n        }\n      }\n    }\n    return colCountByRow;\n  });\n\n  /** A map from a column index to the number of rows in that column. */\n  private readonly _rowCountByCol = computed<Map<number, number>>(() => {\n    const rowCountByCol = new Map();\n    for (const [_, {spanCoords}] of this._coordsMap().entries()) {\n      for (const {row, col} of spanCoords) {\n        const rowCount = rowCountByCol.get(col);\n        const newRowCount = row + 1;\n        if (rowCount === undefined || rowCount < newRowCount) {\n          rowCountByCol.set(col, newRowCount);\n        }\n      }\n    }\n    return rowCountByCol;\n  });\n\n  constructor(readonly inputs: GridDataInputs<T>) {\n    this.cells = this.inputs.cells;\n  }\n\n  /** Whether the cell exists. */\n  hasCell(cell: T): boolean {\n    return this._coordsMap().has(cell);\n  }\n\n  /** Gets the cell at the given coordinates. */\n  getCell(rowCol: RowCol): T | undefined {\n    return this._cellMap().get(`${rowCol.row}:${rowCol.col}`);\n  }\n\n  /** Gets the primary coordinates of the given cell. */\n  getCoords(cell: T): RowCol | undefined {\n    return this._coordsMap().get(cell)?.coords;\n  }\n\n  /** Gets all coordinates that the given cell spans. */\n  getAllCoords(cell: T): RowCol[] | undefined {\n    return this._coordsMap().get(cell)?.spanCoords;\n  }\n\n  /** Gets the number of rows in the given column. */\n  getRowCount(col: number): number | undefined {\n    return this._rowCountByCol().get(col);\n  }\n\n  /** Gets the number of columns in the given row. */\n  getColCount(row: number): number | undefined {\n    return this._colCountsByRow().get(row);\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed, signal, WritableSignal} from '@angular/core';\nimport {SignalLike} from '../signal-like/signal-like';\nimport type {GridData, BaseGridCell, RowCol} from './grid-data';\n\n/** Represents an cell in a grid, such as a grid cell, that may receive focus. */\nexport interface GridFocusCell extends BaseGridCell {\n  /** A unique identifier for the cell. */\n  id: SignalLike<string>;\n\n  /** The html element that should receive focus. */\n  element: SignalLike<HTMLElement>;\n\n  /** Whether a cell is disabled. */\n  disabled: SignalLike<boolean>;\n}\n\n/** Represents the required inputs for a grid that contains focusable cells. */\nexport interface GridFocusInputs {\n  /** The focus strategy used by the grid. */\n  focusMode: SignalLike<'roving' | 'activedescendant'>;\n\n  /** Whether the grid is disabled. */\n  disabled: SignalLike<boolean>;\n\n  /** Whether disabled cells in the grid should be focusable. */\n  softDisabled: SignalLike<boolean>;\n}\n\n/** Dependencies for the `GridFocus` class. */\ninterface GridFocusDeps<T extends GridFocusCell> {\n  /** The `GridData` instance that this focus manager operates on. */\n  grid: GridData<T>;\n}\n\n/** Controls focus for a 2D grid of cells. */\nexport class GridFocus<T extends GridFocusCell> {\n  /** The current active cell. */\n  readonly activeCell: WritableSignal<T | undefined> = signal(undefined);\n\n  /** The current active cell coordinates. */\n  readonly activeCoords = signal<RowCol>({row: -1, col: -1});\n\n  /** Whether the grid active state is empty (no active cell or coordinates). */\n  readonly stateEmpty = computed(\n    () =>\n      this.activeCell() === undefined ||\n      (this.activeCoords().row === -1 && this.activeCoords().col === -1),\n  );\n\n  /**\n   * Whether the grid focus state is stale.\n   *\n   * A stale state means the active cell or coordinates are no longer valid based on the\n   * current grid data, for example if the underlying cells have changed.\n   * A stale state should be re-initialized.\n   */\n  readonly stateStale = computed(() => {\n    if (this.stateEmpty()) {\n      return true;\n    }\n\n    const activeCell = this.activeCell();\n    const activeCellCoords = this.inputs.grid.getCoords(activeCell!);\n    const activeCoords = this.activeCoords();\n    const activeCoordsCell = this.inputs.grid.getCell(activeCoords);\n\n    const activeCellNotValid = activeCellCoords === undefined;\n    const activeCellMismatch = activeCell !== activeCoordsCell;\n    return activeCellNotValid || activeCellMismatch;\n  });\n\n  /** The id of the current active cell, for ARIA activedescendant. */\n  readonly activeDescendant = computed<string | undefined>(() => {\n    if (this.gridDisabled() || this.inputs.focusMode() === 'roving') {\n      return undefined;\n    }\n    const currentActiveCell = this.activeCell();\n    return currentActiveCell ? currentActiveCell.id() : undefined;\n  });\n\n  /** Whether the grid is in a disabled state. */\n  readonly gridDisabled = computed<boolean>(() => {\n    if (this.inputs.disabled()) {\n      return true;\n    }\n    const gridCells = this.inputs.grid.cells();\n    return gridCells.length === 0 || gridCells.every(row => row.every(cell => cell.disabled()));\n  });\n\n  /** The tab index for the grid container. */\n  readonly gridTabIndex = computed<-1 | 0>(() => {\n    if (this.gridDisabled()) {\n      return 0;\n    }\n    return this.inputs.focusMode() === 'activedescendant' ? 0 : -1;\n  });\n\n  constructor(readonly inputs: GridFocusInputs & GridFocusDeps<T>) {}\n\n  /** Returns the tab index for the given grid cell cell. */\n  getCellTabIndex(cell: T): -1 | 0 {\n    if (this.gridDisabled()) {\n      return -1;\n    }\n    if (this.inputs.focusMode() === 'activedescendant') {\n      return -1;\n    }\n    return this.activeCell() === cell ? 0 : -1;\n  }\n\n  /** Returns true if the given cell can be navigated to. */\n  isFocusable(cell: T): boolean {\n    return this.inputs.grid.hasCell(cell) && (!cell.disabled() || this.inputs.softDisabled());\n  }\n\n  /** Focuses the given cell. */\n  focusCell(cell: T): boolean {\n    if (this.gridDisabled()) {\n      return false;\n    }\n\n    if (!this.isFocusable(cell)) {\n      return false;\n    }\n\n    if (this.inputs.grid.getCoords(cell) === undefined) {\n      return false;\n    }\n\n    this.activeCoords.set(this.inputs.grid.getCoords(cell)!);\n    this.activeCell.set(cell);\n\n    return true;\n  }\n\n  /** Moves focus to the cell at the given coordinates if it's part of a focusable cell. */\n  focusCoordinates(coords: RowCol): boolean {\n    if (this.gridDisabled()) {\n      return false;\n    }\n\n    const cell = this.inputs.grid.getCell(coords);\n\n    if (!cell || !this.isFocusable(cell)) {\n      return false;\n    }\n\n    if (this.inputs.grid.getCell(coords) === undefined) {\n      return false;\n    }\n\n    this.activeCoords.set(coords);\n    this.activeCell.set(this.inputs.grid.getCell(coords));\n\n    return true;\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed} from '@angular/core';\nimport {SignalLike} from '../signal-like/signal-like';\nimport {GridFocus, GridFocusCell, GridFocusInputs} from './grid-focus';\nimport {GridData, RowCol} from './grid-data';\n\n/** A utility type that ensures an object has exactly one key from a given set. */\ntype ExactlyOneKey<T, K extends keyof T = keyof T> = {\n  [P in K]: Record<P, T[P]> & Partial<Record<Exclude<K, P>, never>>;\n}[K];\n\n/** Represents a directional change in the grid, either by row or by column. */\ntype Delta = ExactlyOneKey<{row: -1 | 1; col: -1 | 1}>;\n\n/** Constants for the four cardinal directions. */\nexport const direction: Record<'Up' | 'Down' | 'Left' | 'Right', Delta> = {\n  Up: {row: -1},\n  Down: {row: 1},\n  Left: {col: -1},\n  Right: {col: 1},\n} as const;\n\n/** The wrapping behavior for keyboard navigation. */\nexport type WrapStrategy = 'continuous' | 'loop' | 'nowrap';\n\n/** Represents an item in a collection, such as a listbox option, than can be navigated to. */\nexport interface GridNavigationCell extends GridFocusCell {}\n\n/** Represents the required inputs for a collection that has navigable items. */\nexport interface GridNavigationInputs extends GridFocusInputs {\n  /** The wrapping behavior for keyboard navigation along the row axis. */\n  rowWrap: SignalLike<WrapStrategy>;\n\n  /** The wrapping behavior for keyboard navigation along the column axis. */\n  colWrap: SignalLike<WrapStrategy>;\n}\n\n/** Dependencies for the `GridNavigation` class. */\ninterface GridNavigationDeps<T extends GridNavigationCell> {\n  /** The `GridData` instance that this navigation manager operates on. */\n  grid: GridData<T>;\n\n  /** The `GridFocus` instance that this navigation manager uses to manage focus. */\n  gridFocus: GridFocus<T>;\n}\n\n/** Controls navigation for a grid of items. */\nexport class GridNavigation<T extends GridNavigationCell> {\n  /** The maximum number of steps to take when searching for the next cell. */\n  private _maxSteps = computed<number>(\n    () => this.inputs.grid.maxRowCount() * this.inputs.grid.maxColCount(),\n  );\n\n  constructor(readonly inputs: GridNavigationInputs & GridNavigationDeps<T>) {}\n\n  /** Navigates to the given item. */\n  gotoCell(cell: T): boolean {\n    return this.inputs.gridFocus.focusCell(cell);\n  }\n\n  /** Navigates to the given coordinates. */\n  gotoCoords(coords: RowCol): boolean {\n    return this.inputs.gridFocus.focusCoordinates(coords);\n  }\n\n  /**\n   * Gets the coordinates of the next focusable cell in a given direction, without changing focus.\n   */\n  peek(\n    direction: Delta,\n    fromCoords: RowCol,\n    wrap?: WrapStrategy,\n    allowDisabled?: boolean,\n  ): RowCol | undefined {\n    wrap = wrap ?? (direction.row !== undefined ? this.inputs.rowWrap() : this.inputs.colWrap());\n    return this._peekDirectional(direction, fromCoords, wrap, allowDisabled);\n  }\n\n  /**\n   * Navigates to the next focusable cell in a given direction.\n   */\n  advance(direction: Delta): boolean {\n    const nextCoords = this.peek(direction, this.inputs.gridFocus.activeCoords());\n    return !!nextCoords && this.gotoCoords(nextCoords);\n  }\n\n  /**\n   * Gets the coordinates of the first focusable cell.\n   * If a row is not provided, searches the entire grid.\n   */\n  peekFirst(row?: number, allowDisabled?: boolean): RowCol | undefined {\n    const fromCoords = {\n      row: row ?? 0,\n      col: -1,\n    };\n    return row === undefined\n      ? this._peekDirectional(direction.Right, fromCoords, 'continuous', allowDisabled)\n      : this._peekDirectional(direction.Right, fromCoords, 'nowrap', allowDisabled);\n  }\n\n  /**\n   * Navigates to the first focusable cell.\n   * If a row is not provided, searches the entire grid.\n   */\n  first(row?: number): boolean {\n    const nextCoords = this.peekFirst(row);\n    return !!nextCoords && this.gotoCoords(nextCoords);\n  }\n\n  /**\n   * Gets the coordinates of the last focusable cell.\n   * If a row is not provided, searches the entire grid.\n   */\n  peekLast(row?: number, allowDisabled?: boolean): RowCol | undefined {\n    const fromCoords = {\n      row: row ?? this.inputs.grid.maxRowCount() - 1,\n      col: this.inputs.grid.maxColCount(),\n    };\n    return row === undefined\n      ? this._peekDirectional(direction.Left, fromCoords, 'continuous', allowDisabled)\n      : this._peekDirectional(direction.Left, fromCoords, 'nowrap', allowDisabled);\n  }\n\n  /**\n   * Navigates to the last focusable cell.\n   * If a row is not provided, searches the entire grid.\n   */\n  last(row?: number): boolean {\n    const nextCoords = this.peekLast(row);\n    return !!nextCoords && this.gotoCoords(nextCoords);\n  }\n\n  /**\n   * Finds the next focusable cell in a given direction based on the wrapping behavior.\n   */\n  private _peekDirectional(\n    delta: Delta,\n    fromCoords: RowCol,\n    wrap: 'continuous' | 'loop' | 'nowrap',\n    allowDisabled: boolean = false,\n  ): RowCol | undefined {\n    if (this.inputs.gridFocus.gridDisabled()) return undefined;\n\n    const fromCell = this.inputs.grid.getCell(fromCoords);\n    const maxRowCount = this.inputs.grid.maxRowCount();\n    const maxColCount = this.inputs.grid.maxColCount();\n    const rowDelta = delta.row ?? 0;\n    const colDelta = delta.col ?? 0;\n    let nextCoords = {...fromCoords};\n\n    for (let step = 0; step < this._maxSteps(); step++) {\n      const isWrapping =\n        nextCoords.col + colDelta < 0 ||\n        nextCoords.col + colDelta >= maxColCount ||\n        nextCoords.row + rowDelta < 0 ||\n        nextCoords.row + rowDelta >= maxRowCount;\n\n      if (wrap === 'nowrap' && isWrapping) return undefined;\n\n      if (wrap === 'continuous') {\n        const generalDelta = delta.row ?? delta.col;\n        const rowStep = isWrapping ? generalDelta : rowDelta;\n        const colStep = isWrapping ? generalDelta : colDelta;\n\n        // Reaching start or end.\n        const bothWrapping =\n          (nextCoords.row + rowStep >= maxRowCount && nextCoords.col + colStep >= maxColCount) ||\n          (nextCoords.row + rowStep < 0 && nextCoords.col + colStep < 0);\n        if (bothWrapping) return undefined;\n\n        nextCoords = {\n          row: (nextCoords.row + rowStep + maxRowCount) % maxRowCount,\n          col: (nextCoords.col + colStep + maxColCount) % maxColCount,\n        };\n      }\n\n      if (wrap === 'loop') {\n        nextCoords = {\n          row: (nextCoords.row + rowDelta + maxRowCount) % maxRowCount,\n          col: (nextCoords.col + colDelta + maxColCount) % maxColCount,\n        };\n      }\n\n      if (wrap === 'nowrap') {\n        nextCoords = {\n          row: nextCoords.row + rowDelta,\n          col: nextCoords.col + colDelta,\n        };\n      }\n\n      // Back to original coordinates.\n      if (nextCoords.row === fromCoords.row && nextCoords.col === fromCoords.col) {\n        return undefined;\n      }\n\n      const nextCell = this.inputs.grid.getCell(nextCoords);\n      if (\n        nextCell !== undefined &&\n        nextCell !== fromCell &&\n        (allowDisabled || this.inputs.gridFocus.isFocusable(nextCell))\n      ) {\n        return nextCoords;\n      }\n    }\n\n    return undefined;\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {SignalLike, WritableSignalLike} from '../signal-like/signal-like';\nimport {GridFocus, GridFocusCell, GridFocusInputs} from './grid-focus';\nimport {GridData, RowCol} from './grid-data';\nimport {signal} from '@angular/core';\n\n/** Represents a cell in a grid that can be selected. */\nexport interface GridSelectionCell extends GridFocusCell {\n  /** Whether the cell is selected. */\n  selected: WritableSignalLike<boolean>;\n\n  /** Whether the cell is selectable. */\n  selectable: SignalLike<boolean>;\n}\n\n/** Represents the required inputs for a grid that has selectable cells. */\nexport interface GridSelectionInputs extends GridFocusInputs {}\n\n/** Dependencies for the `GridSelection` class. */\ninterface GridSelectionDeps<T extends GridSelectionCell> {\n  /** The `GridData` instance that this selection manager operates on. */\n  grid: GridData<T>;\n\n  /** The `GridFocus` instance that this selection manager uses to manage focus. */\n  gridFocus: GridFocus<T>;\n}\n\n/** Controls selection for a grid of items. */\nexport class GridSelection<T extends GridSelectionCell> {\n  /** The list of cells that were changed in the last selection operation. */\n  private readonly _undoList: WritableSignalLike<[T, boolean][]> = signal([]);\n\n  constructor(readonly inputs: GridSelectionInputs & GridSelectionDeps<T>) {}\n\n  /** Reverts the last selection change. */\n  undo(): void {\n    for (const [cell, oldState] of this._undoList()) {\n      cell.selected.set(oldState);\n    }\n    this._undoList.set([]);\n  }\n\n  /** Selects one or more cells in a given range. */\n  select(fromCoords: RowCol, toCoords?: RowCol): void {\n    this._updateState(fromCoords, toCoords ?? fromCoords, () => true);\n  }\n\n  /** Deselects one or more cells in a given range. */\n  deselect(fromCoords: RowCol, toCoords?: RowCol): void {\n    this._updateState(fromCoords, toCoords ?? fromCoords, () => false);\n  }\n\n  /** Toggles the selection state of one or more cells in a given range. */\n  toggle(fromCoords: RowCol, toCoords?: RowCol): void {\n    this._updateState(fromCoords, toCoords ?? fromCoords, oldState => !oldState);\n  }\n\n  /** Selects all valid cells in the grid. */\n  selectAll(): void {\n    this._updateState(\n      {row: 0, col: 0},\n      {row: this.inputs.grid.maxRowCount(), col: this.inputs.grid.maxColCount()},\n      () => true,\n    );\n  }\n\n  /** Deselects all valid cells in the grid. */\n  deselectAll(): void {\n    this._updateState(\n      {row: 0, col: 0},\n      {row: this.inputs.grid.maxRowCount(), col: this.inputs.grid.maxColCount()},\n      () => false,\n    );\n  }\n\n  /** Whether a cell is selctable. */\n  isSelectable(cell: T) {\n    return cell.selectable() && !cell.disabled();\n  }\n\n  /** A generator that yields all cells within a given range. */\n  *_validCells(fromCoords: RowCol, toCoords: RowCol): Generator<T> {\n    const startRow = Math.min(fromCoords.row, toCoords.row);\n    const startCol = Math.min(fromCoords.col, toCoords.col);\n    const endRow = Math.max(fromCoords.row, toCoords.row);\n    const endCol = Math.max(fromCoords.col, toCoords.col);\n    const visited = new Set<T>();\n    for (let row = startRow; row < endRow + 1; row++) {\n      for (let col = startCol; col < endCol + 1; col++) {\n        const cell = this.inputs.grid.getCell({row, col});\n        if (cell === undefined) continue;\n        if (!this.isSelectable(cell)) continue;\n        if (visited.has(cell)) continue;\n        visited.add(cell);\n        yield cell;\n      }\n    }\n  }\n\n  /**\n   * Updates the selection state of cells in a given range and preserves previous changes\n   * to a undo list.\n   */\n  private _updateState(\n    fromCoords: RowCol,\n    toCoords: RowCol,\n    stateFn: (oldState: boolean) => boolean,\n  ): void {\n    const undoList: [T, boolean][] = [];\n    for (const cell of this._validCells(fromCoords, toCoords)) {\n      const oldState = cell.selected();\n      undoList.push([cell, oldState]);\n      cell.selected.set(stateFn(oldState));\n    }\n    this._undoList.set(undoList);\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed, linkedSignal, signal} from '@angular/core';\nimport {GridData, BaseGridCell, GridDataInputs, RowCol} from './grid-data';\nimport {GridFocus, GridFocusCell, GridFocusInputs} from './grid-focus';\nimport {\n  direction,\n  GridNavigation,\n  GridNavigationCell,\n  GridNavigationInputs,\n} from './grid-navigation';\nimport {GridSelectionCell, GridSelectionInputs, GridSelection} from './grid-selection';\nimport {SignalLike} from '../signal-like/signal-like';\n\n/** The selection operations that can be performed after a navigation operation. */\nexport interface NavOptions {\n  /** Toggles the selection state of the active cell. */\n  toggle?: boolean;\n\n  /**\n   * Toggles the selection state of the active cell, and deselects all other cells if the\n   * active cell is selected. If the active cell is the only selected cell, it will be deselected.\n   */\n  toggleOne?: boolean;\n\n  /** Selects the active cell, preserving the selection state of other cells. */\n  select?: boolean;\n\n  /** Deselects all other cells and selects the active cell. */\n  selectOne?: boolean;\n\n  /**\n   * Moves the selection anchor to the active cell and updates the selection to include all\n   * cells between the anchor and the active cell.\n   */\n  anchor?: boolean;\n}\n\n/** A type that represents a cell in a grid, combining all cell-related interfaces. */\nexport type GridCell = BaseGridCell & GridFocusCell & GridNavigationCell & GridSelectionCell;\n\n/** Represents the required inputs for a grid. */\nexport type GridInputs<T extends GridCell> = GridDataInputs<T> &\n  GridFocusInputs &\n  GridNavigationInputs &\n  GridSelectionInputs;\n\n/** The main class that orchestrates the grid behaviors. */\nexport class Grid<T extends GridCell> {\n  /** The underlying data structure for the grid. */\n  readonly data: GridData<T>;\n\n  /** Controls focus for the grid. */\n  readonly focusBehavior: GridFocus<T>;\n\n  /** Controls navigation for the grid. */\n  readonly navigationBehavior: GridNavigation<T>;\n\n  /** Controls selection for the grid. */\n  readonly selectionBehavior: GridSelection<T>;\n\n  /** The anchor point for range selection, linked to the active coordinates. */\n  readonly selectionAnchor = linkedSignal<RowCol>(() => this.focusBehavior.activeCoords());\n\n  /** The cell at the selection anchor. */\n  readonly selectionAnchorCell = computed(() => this.data.getCell(this.selectionAnchor()));\n\n  /** Whether a range selection has settled. */\n  readonly selectionStabled = signal(true);\n\n  /** Whether all selectable cells are selected. */\n  readonly allSelected: SignalLike<boolean> = computed(() =>\n    this.data\n      .cells()\n      .flat()\n      .filter(c => this.selectionBehavior.isSelectable(c))\n      .every(c => c.selected()),\n  );\n\n  /** The tab index for the grid container. */\n  readonly gridTabIndex: SignalLike<-1 | 0> = () => this.focusBehavior.gridTabIndex();\n\n  /** Whether the grid is in a disabled state. */\n  readonly gridDisabled: SignalLike<boolean> = () => this.focusBehavior.gridDisabled();\n\n  /** The ID of the active descendant for ARIA `activedescendant` focus management. */\n  readonly activeDescendant: SignalLike<string | undefined> = () =>\n    this.focusBehavior.activeDescendant();\n\n  constructor(readonly inputs: GridInputs<T>) {\n    this.data = new GridData(inputs);\n    this.focusBehavior = new GridFocus({...inputs, grid: this.data});\n    this.navigationBehavior = new GridNavigation({\n      ...inputs,\n      grid: this.data,\n      gridFocus: this.focusBehavior,\n    });\n    this.selectionBehavior = new GridSelection({\n      ...inputs,\n      grid: this.data,\n      gridFocus: this.focusBehavior,\n    });\n  }\n\n  /** Gets the 1-based row index of a cell. */\n  rowIndex(cell: T): number | undefined {\n    const index = this.data.getCoords(cell)?.row;\n    return index !== undefined ? index + 1 : undefined;\n  }\n\n  /** Gets the 1-based column index of a cell. */\n  colIndex(cell: T): number | undefined {\n    const index = this.data.getCoords(cell)?.col;\n    return index !== undefined ? index + 1 : undefined;\n  }\n\n  /** Gets the tab index for a given cell. */\n  cellTabIndex(cell: T): -1 | 0 {\n    return this.focusBehavior.getCellTabIndex(cell);\n  }\n\n  /** Navigates to the cell above the currently active cell. */\n  up(opts: NavOptions = {}): boolean {\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() =>\n              this.navigationBehavior.peek(direction.Up, this.selectionAnchor(), 'nowrap', true),\n            )\n          : this.navigationBehavior.advance(direction.Up),\n      opts,\n    );\n  }\n\n  /** Navigates to the cell below the currently active cell. */\n  down(opts: NavOptions = {}): boolean {\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() =>\n              this.navigationBehavior.peek(direction.Down, this.selectionAnchor(), 'nowrap', true),\n            )\n          : this.navigationBehavior.advance(direction.Down),\n      opts,\n    );\n  }\n\n  /** Navigates to the cell to the left of the currently active cell. */\n  left(opts: NavOptions = {}): boolean {\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() =>\n              this.navigationBehavior.peek(direction.Left, this.selectionAnchor(), 'nowrap', true),\n            )\n          : this.navigationBehavior.advance(direction.Left),\n      opts,\n    );\n  }\n\n  /** Navigates to the cell to the right of the currently active cell. */\n  right(opts: NavOptions = {}): boolean {\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() =>\n              this.navigationBehavior.peek(direction.Right, this.selectionAnchor(), 'nowrap', true),\n            )\n          : this.navigationBehavior.advance(direction.Right),\n      opts,\n    );\n  }\n\n  /** Navigates to the first focusable cell in the grid. */\n  first(opts: NavOptions = {}): boolean {\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() => this.navigationBehavior.peekFirst(undefined, true))\n          : this.navigationBehavior.first(),\n      opts,\n    );\n  }\n\n  /** Navigates to the first focusable cell in the current row. */\n  firstInRow(opts: NavOptions = {}): boolean {\n    const row = this.focusBehavior.activeCoords().row;\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() => this.navigationBehavior.peekFirst(row, true))\n          : this.navigationBehavior.first(row),\n      opts,\n    );\n  }\n\n  /** Navigates to the last focusable cell in the grid. */\n  last(opts: NavOptions = {}): boolean {\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() => this.navigationBehavior.peekLast(undefined, true))\n          : this.navigationBehavior.last(),\n      opts,\n    );\n  }\n\n  /** Navigates to the last focusable cell in the current row. */\n  lastInRow(opts: NavOptions = {}): boolean {\n    const row = this.focusBehavior.activeCoords().row;\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() => this.navigationBehavior.peekLast(row, true))\n          : this.navigationBehavior.last(row),\n      opts,\n    );\n  }\n\n  /** Selects all cells in the current row. */\n  selectRow(): void {\n    const row = this.focusBehavior.activeCoords().row;\n    this.selectionBehavior.deselectAll();\n    this.selectionBehavior.select({row, col: 0}, {row, col: this.data.maxColCount()});\n  }\n\n  /** Selects all cells in the current column. */\n  selectCol(): void {\n    const col = this.focusBehavior.activeCoords().col;\n    this.selectionBehavior.deselectAll();\n    this.selectionBehavior.select({row: 0, col}, {row: this.data.maxRowCount(), col});\n  }\n\n  /** Selects the active cell. */\n  select(): void {\n    this.selectionBehavior.select(this.focusBehavior.activeCoords());\n  }\n\n  /** Deselects the active cell. */\n  deselect(): void {\n    this.selectionBehavior.deselect(this.focusBehavior.activeCoords());\n  }\n\n  /**\n   * Toggles the selection state of the coordinates of the given cell\n   * or the current active coordinates.\n   */\n  toggle(): void {\n    this.selectionBehavior.toggle(this.focusBehavior.activeCoords());\n  }\n\n  /** Toggles the selection state of the active cell, and deselects all other cells. */\n  toggleOne(): void {\n    const selected = !!this.focusBehavior.activeCell()?.selected();\n    if (selected) {\n      this.deselect();\n      return;\n    }\n\n    this.deselectAll();\n    this.select();\n  }\n\n  /** Selects all selectable cells in the grid. */\n  selectAll(): void {\n    this.selectionBehavior.selectAll();\n  }\n\n  /** Deselects all cells in the grid. */\n  deselectAll(): void {\n    this.selectionBehavior.deselectAll();\n  }\n\n  /** Navigates to and focuses the given cell. */\n  gotoCell(cell: T, opts: NavOptions = {}): boolean {\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() => this.data.getCoords(cell))\n          : this.navigationBehavior.gotoCell(cell),\n      opts,\n    );\n  }\n\n  /** Sets the default active state of the grid. */\n  setDefaultState(): boolean {\n    // Try to find a selected cell that's focusable.\n    const focusableSelectedCell: T | undefined = this.data\n      .cells()\n      .flat()\n      .filter(c => this.focusBehavior.isFocusable(c))\n      .find(c => c.selected());\n\n    if (focusableSelectedCell !== undefined) {\n      this.focusBehavior.focusCell(focusableSelectedCell);\n      return true;\n    }\n\n    // Otherwise find the first focusable cell.\n    const firstFocusableCoords = this.navigationBehavior.peekFirst();\n\n    if (firstFocusableCoords !== undefined) {\n      return this.focusBehavior.focusCoordinates(firstFocusableCoords);\n    }\n\n    return false;\n  }\n\n  /** Resets the active state of the grid if it is empty or stale. */\n  resetState(): boolean {\n    if (this.focusBehavior.stateEmpty()) {\n      return this.setDefaultState();\n    }\n\n    if (this.focusBehavior.stateStale()) {\n      // Try focus on the same active cell after if a reordering happened.\n      if (this.focusBehavior.focusCell(this.focusBehavior.activeCell()!)) {\n        return true;\n      }\n\n      // If the active cell is no longer exist, focus on the coordinates instead.\n      if (this.focusBehavior.focusCoordinates(this.focusBehavior.activeCoords())) {\n        return true;\n      }\n\n      // If the coordinates no longer valid, go back to the first available cell.\n      if (this.focusBehavior.focusCoordinates(this.navigationBehavior.peekFirst()!)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /** Updates the selection anchor to the given coordinates. */\n  private _updateSelectionAnchor(peekFn: () => RowCol | undefined): boolean {\n    const coords = peekFn();\n    const success = coords !== undefined;\n    if (!success) return false;\n    this.selectionAnchor.set(coords);\n    return success;\n  }\n\n  /** Updates the selection to include all cells between the anchor and the active cell. */\n  private _updateRangeSelection(): void {\n    if (!this.selectionStabled()) {\n      this.selectionBehavior.undo();\n    }\n    this.selectionBehavior.select(\n      ...this._getSelectionCoords(this.focusBehavior.activeCoords(), this.selectionAnchor()),\n    );\n  }\n\n  /** Gets the start and end coordinates for a selection range. */\n  private _getSelectionCoords(startCoords: RowCol, endCoords: RowCol): [RowCol, RowCol] {\n    const startCell = this.data.getCell(startCoords)!;\n    const endCell = this.data.getCell(endCoords)!;\n    const allCoords = [...this.data.getAllCoords(startCell)!, ...this.data.getAllCoords(endCell)!];\n    const allRows = allCoords.map(c => c.row);\n    const allCols = allCoords.map(c => c.col);\n    const fromCoords = {\n      row: Math.min(...allRows),\n      col: Math.min(...allCols),\n    };\n    const toCoords = {\n      row: Math.max(...allRows),\n      col: Math.max(...allCols),\n    };\n\n    return [fromCoords, toCoords];\n  }\n\n  /** Executes a navigation operation and applies selection options. */\n  private _navigateWithSelection(op: () => boolean, opts: NavOptions = {}): boolean {\n    const success = op();\n    if (!success) return false;\n\n    if (opts.anchor) {\n      this._updateRangeSelection();\n      this.selectionStabled.set(false);\n      return success;\n    }\n\n    // Selection becomes stable after the active cell/coords moved.\n    this.selectionStabled.set(true);\n\n    if (opts.select) {\n      this.select();\n      return success;\n    }\n\n    if (opts.selectOne) {\n      this.deselectAll();\n      this.select();\n      return success;\n    }\n\n    if (opts.toggle) {\n      this.toggle();\n      return success;\n    }\n\n    if (opts.toggleOne) {\n      const selected = !!this.focusBehavior.activeCell()?.selected();\n      this.deselectAll();\n      if (!selected) {\n        this.select();\n      }\n      return success;\n    }\n\n    return success;\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed, signal, untracked} from '@angular/core';\nimport {SignalLike} from '../behaviors/signal-like/signal-like';\nimport {KeyboardEventManager, PointerEventManager, Modifier} from '../behaviors/event-manager';\nimport {NavOptions, Grid, GridInputs as GridBehaviorInputs} from '../behaviors/grid';\nimport type {GridRowPattern} from './row';\nimport type {GridCellPattern} from './cell';\n\n/** Represents the required inputs for the grid pattern. */\nexport interface GridInputs extends Omit<GridBehaviorInputs<GridCellPattern>, 'cells'> {\n  /** The html element of the grid. */\n  element: SignalLike<HTMLElement>;\n\n  /** The rows that make up the grid. */\n  rows: SignalLike<GridRowPattern[]>;\n\n  /** The direction that text is read based on the users locale. */\n  textDirection: SignalLike<'rtl' | 'ltr'>;\n\n  /** Whether selection is enabled for the grid. */\n  enableSelection: SignalLike<boolean>;\n\n  /** Whether multiple cell in the grid can be selected. */\n  multi: SignalLike<boolean>;\n\n  /** The selection strategy used by the grid. */\n  selectionMode: SignalLike<'follow' | 'explicit'>;\n\n  /** Whether enable range selection. */\n  enableRangeSelection: SignalLike<boolean>;\n\n  /** A function that returns the grid cell associated with a given element. */\n  getCell: (e: Element | null) => GridCellPattern | undefined;\n}\n\n/** The UI pattern for a grid, handling keyboard navigation, focus, and selection. */\nexport class GridPattern {\n  /** The underlying grid behavior that this pattern is built on. */\n  readonly gridBehavior: Grid<GridCellPattern>;\n\n  /** The cells in the grid. */\n  readonly cells = computed(() => this.gridBehavior.data.cells());\n\n  /** The tab index for the grid. */\n  readonly tabIndex = computed(() => this.gridBehavior.gridTabIndex());\n\n  /** Whether the grid is disabled. */\n  readonly disabled = computed(() => this.gridBehavior.gridDisabled());\n\n  /** The ID of the currently active descendant cell. */\n  readonly activeDescendant = computed(() => this.gridBehavior.activeDescendant());\n\n  /** The currently active cell. */\n  readonly activeCell = computed(() => this.gridBehavior.focusBehavior.activeCell());\n\n  /** The current selection anchor cell. */\n  readonly anchorCell: SignalLike<GridCellPattern | undefined> = computed(() =>\n    this.inputs.enableSelection() && this.inputs.multi()\n      ? this.gridBehavior.selectionAnchorCell()\n      : undefined,\n  );\n\n  /** Whether to pause grid navigation and give the keyboard control to cell or widget. */\n  readonly pauseNavigation: SignalLike<boolean> = computed(() =>\n    this.gridBehavior.data\n      .cells()\n      .flat()\n      .reduce((res, c) => res || c.isActivated(), false),\n  );\n\n  /** Whether the focus is in the grid. */\n  readonly isFocused = signal(false);\n\n  /** Whether the grid has been focused once. */\n  readonly hasBeenFocused = signal(false);\n\n  /** Whether the user is currently dragging to select a range of cells. */\n  readonly dragging = signal(false);\n\n  /** The key for navigating to the previous column. */\n  readonly prevColKey = computed(() =>\n    this.inputs.textDirection() === 'rtl' ? 'ArrowRight' : 'ArrowLeft',\n  );\n\n  /** The key for navigating to the next column. */\n  readonly nextColKey = computed(() =>\n    this.inputs.textDirection() === 'rtl' ? 'ArrowLeft' : 'ArrowRight',\n  );\n\n  /** The keydown event manager for the grid. */\n  readonly keydown = computed(() => {\n    const manager = new KeyboardEventManager();\n\n    if (this.pauseNavigation()) {\n      return manager;\n    }\n\n    // Navigation handlers.\n    const opts: NavOptions = {\n      selectOne: this.inputs.enableSelection() && this.inputs.selectionMode() === 'follow',\n    };\n    manager\n      .on('ArrowUp', () => this.gridBehavior.up(opts))\n      .on('ArrowDown', () => this.gridBehavior.down(opts))\n      .on(this.prevColKey(), () => this.gridBehavior.left(opts))\n      .on(this.nextColKey(), () => this.gridBehavior.right(opts))\n      .on('Home', () => this.gridBehavior.firstInRow(opts))\n      .on('End', () => this.gridBehavior.lastInRow(opts))\n      .on([Modifier.Ctrl], 'Home', () => this.gridBehavior.first(opts))\n      .on([Modifier.Ctrl], 'End', () => this.gridBehavior.last(opts));\n\n    // Basic explicit selection handlers.\n    if (this.inputs.enableSelection() && this.inputs.selectionMode() === 'explicit') {\n      manager.on(/Enter| /, () =>\n        this.inputs.multi() ? this.gridBehavior.toggle() : this.gridBehavior.toggleOne(),\n      );\n    }\n\n    // Range selection handlers.\n    if (this.inputs.enableSelection() && this.inputs.enableRangeSelection()) {\n      manager\n        .on(Modifier.Shift, 'ArrowUp', () => this.gridBehavior.up({anchor: true}))\n        .on(Modifier.Shift, 'ArrowDown', () => this.gridBehavior.down({anchor: true}))\n        .on(Modifier.Shift, this.prevColKey(), () => this.gridBehavior.left({anchor: true}))\n        .on(Modifier.Shift, this.nextColKey(), () => this.gridBehavior.right({anchor: true}))\n        .on(Modifier.Shift, 'Home', () => this.gridBehavior.firstInRow({anchor: true}))\n        .on(Modifier.Shift, 'End', () => this.gridBehavior.lastInRow({anchor: true}))\n        .on([Modifier.Ctrl | Modifier.Shift], 'Home', () => this.gridBehavior.first({anchor: true}))\n        .on([Modifier.Ctrl | Modifier.Shift], 'End', () => this.gridBehavior.last({anchor: true}))\n        .on([Modifier.Ctrl, Modifier.Meta], 'A', () => {\n          if (this.gridBehavior.allSelected()) {\n            this.gridBehavior.deselectAll();\n          } else {\n            this.gridBehavior.selectAll();\n          }\n        })\n        .on([Modifier.Shift], ' ', () => this.gridBehavior.selectRow())\n        .on([Modifier.Ctrl, Modifier.Meta], ' ', () => this.gridBehavior.selectCol());\n    }\n\n    return manager;\n  });\n\n  /** The pointerdown event manager for the grid. */\n  readonly pointerdown = computed(() => {\n    const manager = new PointerEventManager();\n\n    // Navigation without selection.\n    if (!this.inputs.enableSelection()) {\n      manager.on(e => {\n        const cell = this.inputs.getCell(e.target as Element);\n        if (!cell || !this.gridBehavior.focusBehavior.isFocusable(cell)) return;\n\n        this.gridBehavior.gotoCell(cell);\n      });\n    }\n\n    // Navigation with selection.\n    if (this.inputs.enableSelection()) {\n      manager.on(e => {\n        const cell = this.inputs.getCell(e.target as Element);\n        if (!cell || !this.gridBehavior.focusBehavior.isFocusable(cell)) return;\n\n        this.gridBehavior.gotoCell(cell, {\n          selectOne: this.inputs.selectionMode() === 'follow',\n          toggleOne: this.inputs.selectionMode() === 'explicit' && !this.inputs.multi(),\n          toggle: this.inputs.selectionMode() === 'explicit' && this.inputs.multi(),\n        });\n\n        if (this.inputs.multi() && this.inputs.enableRangeSelection()) {\n          this.dragging.set(true);\n        }\n      });\n\n      // Selection with modifier keys.\n      if (this.inputs.multi()) {\n        manager.on([Modifier.Ctrl, Modifier.Meta], e => {\n          const cell = this.inputs.getCell(e.target as Element);\n          if (!cell || !this.gridBehavior.focusBehavior.isFocusable(cell)) return;\n\n          this.gridBehavior.gotoCell(cell, {toggle: true});\n\n          if (this.inputs.enableRangeSelection()) {\n            this.dragging.set(true);\n          }\n        });\n\n        if (this.inputs.enableRangeSelection()) {\n          manager.on(Modifier.Shift, e => {\n            const cell = this.inputs.getCell(e.target as Element);\n            if (!cell) return;\n\n            this.gridBehavior.gotoCell(cell, {anchor: true});\n            this.dragging.set(true);\n          });\n        }\n      }\n    }\n\n    return manager;\n  });\n\n  /** The pointerup event manager for the grid. */\n  readonly pointerup = computed(() => {\n    const manager = new PointerEventManager();\n\n    if (this.inputs.enableSelection() && this.inputs.enableRangeSelection()) {\n      manager.on([Modifier.Shift, Modifier.Ctrl, Modifier.Meta, Modifier.None], () => {\n        this.dragging.set(false);\n      });\n    }\n\n    return manager;\n  });\n\n  /** Indicates maybe the losing focus is caused by row/cell deletion. */\n  private readonly _maybeDeletion = signal(false);\n\n  /** Indicates the losing focus is certainly caused by row/cell deletion. */\n  private readonly _deletion = signal(false);\n\n  /** Whether the grid state is stale and needs to be reconciled. */\n  private readonly _stateStale = signal(false);\n\n  constructor(readonly inputs: GridInputs) {\n    this.gridBehavior = new Grid({\n      ...inputs,\n      cells: computed(() => this.inputs.rows().map(row => row.inputs.cells())),\n    });\n  }\n\n  /** Handles keydown events on the grid. */\n  onKeydown(event: KeyboardEvent) {\n    if (this.disabled()) return;\n\n    this.activeCell()?.onKeydown(event);\n    this.keydown().handle(event);\n  }\n\n  /** Handles pointerdown events on the grid. */\n  onPointerdown(event: PointerEvent) {\n    if (this.disabled()) return;\n\n    this.pointerdown().handle(event);\n  }\n\n  /** Handles pointermove events on the grid. */\n  onPointermove(event: PointerEvent) {\n    if (\n      this.disabled() ||\n      !this.inputs.enableSelection() ||\n      !this.inputs.enableRangeSelection() ||\n      !this.dragging()\n    ) {\n      return;\n    }\n\n    const cell = this.inputs.getCell(event.target as Element);\n\n    // Dragging anchor.\n    if (cell !== undefined) {\n      this.gridBehavior.gotoCell(cell, {anchor: true});\n    }\n  }\n\n  /** Handles pointerup events on the grid. */\n  onPointerup(event: PointerEvent) {\n    if (this.disabled()) return;\n\n    this.pointerup().handle(event);\n  }\n\n  /** Handles focusin events on the grid. */\n  onFocusIn(event: FocusEvent) {\n    this.isFocused.set(true);\n    this.hasBeenFocused.set(true);\n\n    // Skip if in the middle of range selection.\n    if (this.dragging()) return;\n\n    // Cell that receives focus.\n    const cell = this.inputs.getCell(event.target as Element | null);\n    if (!cell || !this.gridBehavior.focusBehavior.isFocusable(cell)) return;\n\n    // Pass down the focusin event to the cell.\n    cell.onFocusIn(event);\n\n    // Update active cell state if the cell is receiving focus by\n    // tabbing, pointer, or any programmatic control into a widget inside the cell.\n    if (cell !== this.activeCell()) {\n      this.gridBehavior.gotoCell(cell);\n    }\n  }\n\n  /** Handles focusout events on the grid. */\n  onFocusOut(event: FocusEvent) {\n    // Pass down focusout event to the cell that loses focus.\n    const blurTarget = event.target as Element | null;\n    const cell = this.inputs.getCell(blurTarget);\n\n    // Pass down the focusout event to the cell.\n    cell?.onFocusOut(event);\n\n    const focusTarget = event.relatedTarget as Element | null;\n    if (this.inputs.element().contains(focusTarget)) return;\n\n    // If a `relatedTarget`(focusing target) is null, then it can be caused by either\n    // - Clicking on a non-focusable element, or\n    // - The focused element is removed from the page.\n    if (focusTarget === null) {\n      this._maybeDeletion.set(true);\n    }\n\n    this.isFocused.set(false);\n  }\n\n  /** Sets the default active state of the grid before receiving focus the first time. */\n  setDefaultStateEffect(): void {\n    if (this.hasBeenFocused()) return;\n\n    this.gridBehavior.setDefaultState();\n  }\n\n  /** Resets the active state of the grid if it is empty or stale. */\n  resetStateEffect(): void {\n    const hasReset = this.gridBehavior.resetState();\n\n    if (hasReset) {\n      // If the active state has been reset right after a focusout event, then\n      // we know it's caused by a row/cell deletion.\n      if (this._maybeDeletion()) {\n        this._deletion.set(true);\n      } else {\n        this._stateStale.set(true);\n      }\n    }\n    // Reset maybe deletion state.\n    this._maybeDeletion.set(false);\n  }\n\n  /** Resets the focus to the active cell element or grid element. */\n  resetFocusEffect(): void {\n    const stateStale = this._stateStale();\n    if (!stateStale) return;\n\n    const isFocused = untracked(() => this.isFocused());\n    const isRoving = untracked(() => this.inputs.focusMode() === 'roving');\n    const activeCell = untracked(() => this.activeCell());\n\n    if (isRoving && activeCell !== undefined && isFocused) {\n      if (!activeCell.isFocused()) {\n        activeCell.focus();\n      }\n    }\n\n    this._stateStale.set(false);\n  }\n\n  /** Restore focus when a deletion happened. */\n  restoreFocusEffect(): void {\n    const deletion = this._deletion();\n    if (!deletion) return;\n\n    const isRoving = untracked(() => this.inputs.focusMode() === 'roving');\n    const activeCell = untracked(() => this.activeCell());\n\n    if (isRoving && activeCell !== undefined) {\n      if (!activeCell.isFocused()) {\n        activeCell.focus();\n      }\n    }\n\n    this._deletion.set(false);\n  }\n\n  /** Sets focus when active cell changed. */\n  focusEffect(): void {\n    const activeCell = this.activeCell();\n    const gridFocused = untracked(() => this.isFocused());\n\n    if (activeCell === undefined || !gridFocused) return;\n\n    const isRoving = untracked(() => this.inputs.focusMode() === 'roving');\n    const cellFocused = untracked(() => activeCell.isFocused());\n\n    if (isRoving && !cellFocused) {\n      activeCell.focus();\n    }\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {SignalLike} from '../behaviors/signal-like/signal-like';\nimport type {GridPattern} from './grid';\nimport type {GridCellPattern} from './cell';\n\n/** The inputs for the `GridRowPattern`. */\nexport interface GridRowInputs {\n  /** The `GridPattern` that this row belongs to. */\n  grid: SignalLike<GridPattern>;\n\n  /** The cells that make up this row. */\n  cells: SignalLike<GridCellPattern[]>;\n\n  /** The index of this row within the grid. */\n  rowIndex: SignalLike<number | undefined>;\n}\n\n/** The UI pattern for a grid row. */\nexport class GridRowPattern {\n  /** The index of this row within the grid. */\n  rowIndex: SignalLike<number | undefined>;\n\n  constructor(readonly inputs: GridRowInputs) {\n    this.rowIndex = inputs.rowIndex;\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed, signal, linkedSignal, WritableSignal} from '@angular/core';\nimport {KeyboardEventManager} from '../behaviors/event-manager';\nimport {ListFocus} from '../behaviors/list-focus/list-focus';\nimport {ListNavigation, ListNavigationInputs} from '../behaviors/list-navigation/list-navigation';\nimport {SignalLike, WritableSignalLike} from '../behaviors/signal-like/signal-like';\nimport {GridCell} from '../behaviors/grid';\nimport type {GridPattern} from './grid';\nimport type {GridRowPattern} from './row';\nimport {GridCellWidgetPattern} from './widget';\n\n/** The inputs for the `GridCellPattern`. */\nexport interface GridCellInputs\n  extends GridCell,\n    Omit<\n      ListNavigationInputs<GridCellWidgetPattern>,\n      'focusMode' | 'items' | 'activeItem' | 'softDisabled' | 'element'\n    > {\n  /** The `GridPattern` that this cell belongs to. */\n  grid: SignalLike<GridPattern>;\n\n  /** The `GridRowPattern` that this cell belongs to. */\n  row: SignalLike<GridRowPattern>;\n\n  /** The widget patterns contained within this cell, if any. */\n  widgets: SignalLike<GridCellWidgetPattern[]>;\n\n  /** The index of this cell's row within the grid. */\n  rowIndex: SignalLike<number | undefined>;\n\n  /** The index of this cell's column within the grid. */\n  colIndex: SignalLike<number | undefined>;\n\n  /** A function that returns the cell widget associated with a given element. */\n  getWidget: (e: Element | null) => GridCellWidgetPattern | undefined;\n}\n\n/** The UI pattern for a grid cell. */\nexport class GridCellPattern implements GridCell {\n  /** A unique identifier for the cell. */\n  readonly id: SignalLike<string> = () => this.inputs.id();\n\n  /** The html element that should receive focus. */\n  readonly element: SignalLike<HTMLElement> = () => this.inputs.element();\n\n  /** Whether the cell has focus. */\n  readonly isFocused: WritableSignal<boolean> = signal(false);\n\n  /** Whether the cell is selected. */\n  readonly selected: WritableSignalLike<boolean>;\n\n  /** Whether the cell is selectable. */\n  readonly selectable: SignalLike<boolean> = () => this.inputs.selectable();\n\n  /** Whether a cell is disabled. */\n  readonly disabled: SignalLike<boolean> = () => this.inputs.disabled();\n\n  /** The number of rows the cell should span. */\n  readonly rowSpan: SignalLike<number> = () => this.inputs.rowSpan();\n\n  /** The number of columns the cell should span. */\n  readonly colSpan: SignalLike<number> = () => this.inputs.colSpan();\n\n  /** Whether the cell is active. */\n  readonly active: SignalLike<boolean> = computed(() => this.inputs.grid().activeCell() === this);\n\n  /** Whether the cell is a selection anchor. */\n  readonly anchor: SignalLike<true | undefined> = computed(() =>\n    this.inputs.grid().anchorCell() === this ? true : undefined,\n  );\n\n  /** The `aria-selected` attribute for the cell. */\n  readonly ariaSelected: SignalLike<boolean | undefined> = computed(() =>\n    this.inputs.grid().inputs.enableSelection() && this.selectable() ? this.selected() : undefined,\n  );\n\n  /** The `aria-rowindex` attribute for the cell. */\n  readonly ariaRowIndex: SignalLike<number | undefined> = computed(\n    () =>\n      this.inputs.row().rowIndex() ??\n      this.inputs.rowIndex() ??\n      this.inputs.grid().gridBehavior.rowIndex(this),\n  );\n\n  /** The `aria-colindex` attribute for the cell. */\n  readonly ariaColIndex: SignalLike<number | undefined> = computed(\n    () => this.inputs.colIndex() ?? this.inputs.grid().gridBehavior.colIndex(this),\n  );\n\n  /** The internal tab index calculation for the cell. */\n  private readonly _tabIndex: SignalLike<-1 | 0> = computed(() =>\n    this.inputs.grid().gridBehavior.cellTabIndex(this),\n  );\n\n  /** The tab index for the cell. If the cell contains a widget, the cell's tab index is -1. */\n  readonly tabIndex: SignalLike<-1 | 0> = computed(() => {\n    if (this.singleWidgetMode() || this.navigationActivated()) {\n      return -1;\n    }\n    return this._tabIndex();\n  });\n\n  // Single/Multi Widget Navigation Setup\n\n  /** Whether the cell contains a single widget. */\n  readonly singleWidgetMode: SignalLike<boolean> = computed(\n    () => this.inputs.widgets().length === 1,\n  );\n\n  /** Whether the cell contains multiple widgets. */\n  readonly multiWidgetMode: SignalLike<boolean> = computed(() => this.inputs.widgets().length > 1);\n\n  /** Whether navigation between widgets is disabled. */\n  readonly navigationDisabled: SignalLike<boolean> = computed(\n    () => !this.multiWidgetMode() || !this.active() || this.inputs.disabled(),\n  );\n\n  /** The focus behavior for the widgets in the cell. */\n  readonly focusBehavior: ListFocus<GridCellWidgetPattern>;\n\n  /** The navigation behavior for the widgets in the cell. */\n  readonly navigationBehavior: ListNavigation<GridCellWidgetPattern>;\n\n  /** The currently active widget in the cell. */\n  readonly activeWidget: WritableSignalLike<GridCellWidgetPattern | undefined> = linkedSignal(() =>\n    this.inputs.widgets().length > 0 ? this.inputs.widgets()[0] : undefined,\n  );\n\n  /** Whether navigation between widgets is activated. */\n  readonly navigationActivated: WritableSignalLike<boolean> = signal(false);\n\n  /** Whether any widget within the cell is activated. */\n  readonly widgetActivated: SignalLike<boolean> = computed(() =>\n    this.inputs.widgets().some(w => w.isActivated()),\n  );\n\n  /** Whether the cell or widget inside the cell is activated. */\n  readonly isActivated: SignalLike<boolean> = computed(\n    () => this.navigationActivated() || this.widgetActivated(),\n  );\n\n  /** The key used to navigate to the previous widget. */\n  readonly prevKey = computed(() => {\n    if (this.inputs.orientation() === 'vertical') {\n      return 'ArrowUp';\n    }\n    return this.inputs.textDirection() === 'rtl' ? 'ArrowRight' : 'ArrowLeft';\n  });\n\n  /** The key used to navigate to the next widget. */\n  readonly nextKey = computed(() => {\n    if (this.inputs.orientation() === 'vertical') {\n      return 'ArrowDown';\n    }\n    return this.inputs.textDirection() === 'rtl' ? 'ArrowLeft' : 'ArrowRight';\n  });\n\n  /** The keyboard event manager for the cell. */\n  readonly keydown = computed(() => {\n    const manager = new KeyboardEventManager();\n\n    // Before start list navigation.\n    if (!this.navigationActivated()) {\n      manager.on('Enter', () => this.startNavigation());\n      return manager;\n    }\n\n    // Start list navigation.\n    manager\n      .on('Escape', () => this.stopNavigation())\n      .on(this.prevKey(), () =>\n        this._advance(() => this.navigationBehavior.prev({focusElement: false})),\n      )\n      .on(this.nextKey(), () =>\n        this._advance(() => this.navigationBehavior.next({focusElement: false})),\n      )\n      .on('Home', () => this._advance(() => this.navigationBehavior.next({focusElement: false})))\n      .on('End', () => this._advance(() => this.navigationBehavior.next({focusElement: false})));\n\n    return manager;\n  });\n\n  constructor(readonly inputs: GridCellInputs) {\n    this.selected = inputs.selected;\n\n    const listNavigationInputs: ListNavigationInputs<GridCellWidgetPattern> = {\n      ...inputs,\n      items: inputs.widgets,\n      activeItem: this.activeWidget,\n      disabled: this.navigationDisabled,\n      focusMode: () => 'roving',\n      softDisabled: () => true,\n    };\n\n    this.focusBehavior = new ListFocus<GridCellWidgetPattern>(listNavigationInputs);\n    this.navigationBehavior = new ListNavigation<GridCellWidgetPattern>({\n      ...listNavigationInputs,\n      focusManager: this.focusBehavior,\n    });\n  }\n\n  /** Handles keydown events for the cell. */\n  onKeydown(event: KeyboardEvent): void {\n    if (this.disabled() || this.inputs.widgets().length === 0) return;\n\n    // No navigation needed if single widget.\n    if (this.singleWidgetMode()) {\n      this.activeWidget()!.onKeydown(event);\n      return;\n    }\n\n    // Focus is on the cell before the navigation starts.\n    if (!this.navigationActivated()) {\n      this.keydown().handle(event);\n      return;\n    }\n\n    // Widget activate state can be changed during the widget keydown handling.\n    const widgetActivated = this.widgetActivated();\n\n    this.activeWidget()!.onKeydown(event);\n\n    if (!widgetActivated) {\n      this.keydown().handle(event);\n    }\n  }\n\n  /** Handles focusin events for the cell. */\n  onFocusIn(event: FocusEvent): void {\n    this.isFocused.set(true);\n\n    const focusTarget = event.target as Element | null;\n    const widget = this.inputs.getWidget(focusTarget);\n    if (!widget) return;\n\n    // Pass down focusin event to the widget.\n    widget.onFocusIn(event);\n\n    // Update internal states if the widget(or anything within the widget) is\n    // receiving focus by tabbing, pointer, or any programmatic control.\n\n    // Update current active widget.\n    if (widget !== this.activeWidget()) {\n      this.navigationBehavior.goto(widget, {focusElement: false});\n    }\n\n    // Start widget navigation if multi widget.\n    if (this.multiWidgetMode()) {\n      this.navigationActivated.set(true);\n    }\n  }\n\n  /** Handles focusout events for the cell. */\n  onFocusOut(event: FocusEvent): void {\n    const blurTarget = event.target as Element | null;\n    const widget = this.inputs.getWidget(blurTarget);\n\n    // Pass down focusout event to the widget.\n    widget?.onFocusOut(event);\n\n    const focusTarget = event.relatedTarget as Element | null;\n    if (this.element().contains(focusTarget)) return;\n\n    this.isFocused.set(false);\n    // Reset navigation state when focus leaving cell.\n    this.navigationActivated.set(false);\n  }\n\n  /** Focuses the cell or the active widget. */\n  focus(): void {\n    if (this.singleWidgetMode()) {\n      this.activeWidget()?.focus();\n    } else {\n      this.element().focus();\n    }\n  }\n\n  /** Gets the tab index for the widget within the cell. */\n  widgetTabIndex(): -1 | 0 {\n    if (this.singleWidgetMode()) {\n      return this._tabIndex();\n    }\n    return this.navigationActivated() ? 0 : -1;\n  }\n\n  /** Starts navigation between widgets. */\n  startNavigation(): void {\n    if (this.navigationActivated()) return;\n\n    this.navigationActivated.set(true);\n    this.navigationBehavior.first();\n  }\n\n  /** Stops navigation between widgets and restores focus to the cell. */\n  stopNavigation(): void {\n    if (!this.navigationActivated()) return;\n\n    this.navigationActivated.set(false);\n    this.element().focus();\n  }\n\n  /** Executes a navigation operation and focuses the new active widget. */\n  private _advance(op: () => boolean): void {\n    const success = op();\n    if (success) {\n      this.activeWidget()?.focus();\n    }\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed, signal, Signal, WritableSignal} from '@angular/core';\nimport {KeyboardEventManager, Modifier} from '../behaviors/event-manager';\nimport {ListNavigationItem} from '../behaviors/list-navigation/list-navigation';\nimport {SignalLike} from '../behaviors/signal-like/signal-like';\nimport type {GridCellPattern} from './cell';\n\n/** The inputs for the `GridCellWidgetPattern`. */\nexport interface GridCellWidgetInputs extends Omit<ListNavigationItem, 'index'> {\n  /** The `GridCellPattern` that this widget belongs to. */\n  cell: SignalLike<GridCellPattern>;\n\n  /** The html element that should receive focus. */\n  element: SignalLike<HTMLElement>;\n\n  /** The type of widget, which determines how it is activated. */\n  widgetType: SignalLike<'simple' | 'complex' | 'editable'>;\n\n  /** The element that will receive focus when the widget is activated. */\n  focusTarget: SignalLike<HTMLElement | undefined>;\n}\n\n/** The UI pattern for a widget inside a grid cell. */\nexport class GridCellWidgetPattern implements ListNavigationItem {\n  /** A unique identifier for the widget. */\n  readonly id: SignalLike<string> = () => this.inputs.id();\n\n  /** The html element that should receive focus. */\n  readonly element: SignalLike<HTMLElement> = () => this.inputs.element();\n\n  /** The element that should receive focus. */\n  readonly widgetHost: Signal<HTMLElement> = computed(\n    () => this.inputs.focusTarget() ?? this.element(),\n  );\n\n  /** The index of the widget within the cell. */\n  readonly index: Signal<number> = computed(() =>\n    this.inputs.cell().inputs.widgets().indexOf(this),\n  );\n\n  /** Whether the widget is disabled. */\n  readonly disabled: Signal<boolean> = computed(\n    () => this.inputs.disabled() || this.inputs.cell().disabled(),\n  );\n\n  /** The tab index for the widget. */\n  readonly tabIndex: Signal<-1 | 0> = computed(() => this.inputs.cell().widgetTabIndex());\n\n  /** Whether the widget is the active item in the widget list. */\n  readonly active: Signal<boolean> = computed(() => this.inputs.cell().activeWidget() === this);\n\n  /** Whether the widget is currently activated. */\n  readonly isActivated: WritableSignal<boolean> = signal(false);\n\n  /** The last event that caused the widget to be activated. */\n  readonly lastActivateEvent: WritableSignal<KeyboardEvent | FocusEvent | undefined> =\n    signal(undefined);\n\n  /** The last event that caused the widget to be deactivated. */\n  readonly lastDeactivateEvent: WritableSignal<KeyboardEvent | FocusEvent | undefined> =\n    signal(undefined);\n\n  /** The keyboard event manager for the widget. */\n  readonly keydown = computed(() => {\n    const manager = new KeyboardEventManager();\n\n    // Simple widget does not need to pause default grid behaviors.\n    if (this.inputs.widgetType() === 'simple') {\n      return manager;\n    }\n\n    // If a widget is activated, only listen to events that exits activate state.\n    if (this.isActivated()) {\n      manager.on('Escape', e => {\n        this.deactivate(e);\n        this.focus();\n      });\n\n      if (this.inputs.widgetType() === 'editable') {\n        manager.on('Enter', e => {\n          this.deactivate(e);\n          this.focus();\n        });\n      }\n\n      return manager;\n    }\n\n    // Enter key is used to activate widget for both complex and editable type.\n    manager.on('Enter', e => this.activate(e));\n\n    if (this.inputs.widgetType() === 'editable') {\n      manager.on([Modifier.Shift, Modifier.None], /^[a-zA-Z0-9]$/, e => this.activate(e), {\n        preventDefault: false,\n      });\n    }\n\n    return manager;\n  });\n\n  constructor(readonly inputs: GridCellWidgetInputs) {}\n\n  /** Handles keydown events for the widget. */\n  onKeydown(event: KeyboardEvent): void {\n    if (this.disabled()) return;\n\n    this.keydown().handle(event);\n  }\n\n  /** Handles focusin events for the widget. */\n  onFocusIn(event: FocusEvent): void {\n    // Simple widget does not have activate state.\n    if (this.inputs.widgetType() === 'simple') return;\n\n    // Set activate state if the focus is inside of widget.\n    const focusTarget = event.target as Element;\n    if (this.widgetHost().contains(focusTarget) && this.widgetHost() !== focusTarget) {\n      this.activate(event);\n    }\n  }\n\n  /** Handles focusout events for the widget. */\n  onFocusOut(event: FocusEvent): void {\n    const focusTarget = event.relatedTarget as Element;\n    if (this.widgetHost().contains(focusTarget)) return;\n\n    // Reset states when focus leaving widget.\n    this.deactivate(event);\n  }\n\n  /** Focuses the widget's host element. */\n  focus(): void {\n    this.widgetHost().focus();\n  }\n\n  /** Activates the widget. */\n  activate(event?: KeyboardEvent | FocusEvent): void {\n    if (this.isActivated()) return;\n    if (this.inputs.widgetType() === 'simple') return;\n\n    this.isActivated.set(true);\n    this.lastActivateEvent.set(event);\n  }\n\n  /** Deactivates the widget and restores focus to the widget's host element. */\n  deactivate(event?: KeyboardEvent | FocusEvent): void {\n    if (!this.isActivated()) return;\n\n    this.isActivated.set(false);\n    this.lastDeactivateEvent.set(event);\n  }\n}\n"],"names":["Modifier","EventManager","configs","handle","event","config","matcher","handler","preventDefault","stopPropagation","getModifiers","ctrlKey","Ctrl","shiftKey","Shift","altKey","Alt","metaKey","Meta","hasModifiers","modifiers","eventModifiers","modifiersList","Array","isArray","includes","Any","some","KeyboardEventManager","options","on","args","key","_normalizeInputs","push","_isMatch","withModifiers","None","RegExp","test","keyStr","toLowerCase","MouseButton","PointerEventManager","button","length","Main","ListFocus","inputs","prevActiveItem","signal","undefined","prevActiveIndex","computed","items","indexOf","activeIndex","activeItem","constructor","isListDisabled","disabled","every","i","getActiveDescendant","focusMode","id","getListTabIndex","getItemTabIndex","item","focus","opts","isFocusable","set","focusElement","element","softDisabled","ListNavigation","goto","focusManager","next","_advance","peekNext","_peek","prev","peekPrev","first","peekFirst","last","peekLast","find","delta","itemCount","startIndex","step","wrap","GridData","cells","maxRowCount","Math","max","_rowCountByCol","values","maxColCount","_colCountsByRow","_coordsMap","coordsMap","Map","visitedCoords","Set","rowIndex","colIndex","row","cell","has","rowspan","rowSpan","colspan","colSpan","spanCoords","rowOffset","colOffset","col","add","coords","_cellMap","cellMap","entries","colCountByRow","_","colCount","get","newColCount","rowCountByCol","rowCount","newRowCount","hasCell","getCell","rowCol","getCoords","getAllCoords","getRowCount","getColCount","GridFocus","activeCell","activeCoords","stateEmpty","stateStale","activeCellCoords","grid","activeCoordsCell","activeCellNotValid","activeCellMismatch","activeDescendant","gridDisabled","currentActiveCell","gridCells","gridTabIndex","getCellTabIndex","focusCell","focusCoordinates","direction","Up","Down","Left","Right","GridNavigation","_maxSteps","gotoCell","gridFocus","gotoCoords","peek","fromCoords","allowDisabled","rowWrap","colWrap","_peekDirectional","advance","nextCoords","fromCell","rowDelta","colDelta","isWrapping","generalDelta","rowStep","colStep","bothWrapping","nextCell","GridSelection","_undoList","undo","oldState","selected","select","toCoords","_updateState","deselect","toggle","selectAll","deselectAll","isSelectable","selectable","_validCells","startRow","min","startCol","endRow","endCol","visited","stateFn","undoList","Grid","data","focusBehavior","navigationBehavior","selectionBehavior","selectionAnchor","linkedSignal","selectionAnchorCell","selectionStabled","allSelected","flat","filter","c","index","cellTabIndex","up","_navigateWithSelection","anchor","_updateSelectionAnchor","down","left","right","firstInRow","lastInRow","selectRow","selectCol","toggleOne","setDefaultState","focusableSelectedCell","firstFocusableCoords","resetState","peekFn","success","_updateRangeSelection","_getSelectionCoords","startCoords","endCoords","startCell","endCell","allCoords","allRows","map","allCols","op","selectOne","GridPattern","gridBehavior","tabIndex","anchorCell","enableSelection","multi","pauseNavigation","reduce","res","isActivated","isFocused","hasBeenFocused","dragging","prevColKey","textDirection","nextColKey","keydown","manager","selectionMode","enableRangeSelection","pointerdown","e","target","pointerup","_maybeDeletion","_deletion","_stateStale","rows","onKeydown","onPointerdown","onPointermove","onPointerup","onFocusIn","onFocusOut","blurTarget","focusTarget","relatedTarget","contains","setDefaultStateEffect","resetStateEffect","hasReset","resetFocusEffect","untracked","isRoving","restoreFocusEffect","deletion","focusEffect","gridFocused","cellFocused","GridRowPattern","GridCellPattern","active","ariaSelected","ariaRowIndex","ariaColIndex","_tabIndex","singleWidgetMode","navigationActivated","widgets","multiWidgetMode","navigationDisabled","activeWidget","widgetActivated","w","prevKey","orientation","nextKey","startNavigation","stopNavigation","listNavigationInputs","widget","getWidget","widgetTabIndex","GridCellWidgetPattern","widgetHost","lastActivateEvent","lastDeactivateEvent","widgetType","deactivate","activate"],"mappings":";;IA2CYA;AAAZ,CAAA,UAAYA,QAAQ,EAAA;EAClBA,QAAA,CAAAA,QAAA,CAAA,MAAA,CAAA,GAAA,CAAA,CAAA,GAAA,MAAQ;EACRA,QAAA,CAAAA,QAAA,CAAA,MAAA,CAAA,GAAA,CAAA,CAAA,GAAA,MAAU;EACVA,QAAA,CAAAA,QAAA,CAAA,OAAA,CAAA,GAAA,CAAA,CAAA,GAAA,OAAY;EACZA,QAAA,CAAAA,QAAA,CAAA,KAAA,CAAA,GAAA,CAAA,CAAA,GAAA,KAAW;EACXA,QAAA,CAAAA,QAAA,CAAA,MAAA,CAAA,GAAA,CAAA,CAAA,GAAA,MAAa;AACbA,EAAAA,QAAA,CAAA,KAAA,CAAA,GAAA,KAAW;AACb,CAAC,EAPWA,QAAQ,KAARA,QAAQ,GAOnB,EAAA,CAAA,CAAA;MAUqBC,YAAY,CAAA;AACtBC,EAAAA,OAAO,GAA4B,EAAE;EAI/CC,MAAMA,CAACC,KAAQ,EAAA;AACb,IAAA,KAAK,MAAMC,MAAM,IAAI,IAAI,CAACH,OAAO,EAAE;AACjC,MAAA,IAAIG,MAAM,CAACC,OAAO,CAACF,KAAK,CAAC,EAAE;AACzBC,QAAAA,MAAM,CAACE,OAAO,CAACH,KAAK,CAAC;QAErB,IAAIC,MAAM,CAACG,cAAc,EAAE;UACzBJ,KAAK,CAACI,cAAc,EAAE;AACxB;QAEA,IAAIH,MAAM,CAACI,eAAe,EAAE;UAC1BL,KAAK,CAACK,eAAe,EAAE;AACzB;AACF;AACF;AACF;AAID;AAGK,SAAUC,YAAYA,CAACN,KAAyB,EAAA;AACpD,EAAA,OACE,CAAC,CAACA,KAAK,CAACO,OAAO,IAAIX,QAAQ,CAACY,IAAI,KAC/B,CAACR,KAAK,CAACS,QAAQ,IAAIb,QAAQ,CAACc,KAAK,CAAC,IAClC,CAACV,KAAK,CAACW,MAAM,IAAIf,QAAQ,CAACgB,GAAG,CAAC,IAC9B,CAACZ,KAAK,CAACa,OAAO,IAAIjB,QAAQ,CAACkB,IAAI,CAAC;AAErC;AAMgB,SAAAC,YAAYA,CAACf,KAAyB,EAAEgB,SAAyB,EAAA;AAC/E,EAAA,MAAMC,cAAc,GAAGX,YAAY,CAACN,KAAK,CAAC;AAC1C,EAAA,MAAMkB,aAAa,GAAGC,KAAK,CAACC,OAAO,CAACJ,SAAS,CAAC,GAAGA,SAAS,GAAG,CAACA,SAAS,CAAC;EAExE,IAAIE,aAAa,CAACG,QAAQ,CAACzB,QAAQ,CAAC0B,GAAG,CAAC,EAAE;AACxC,IAAA,OAAO,IAAI;AACb;EAEA,OAAOJ,aAAa,CAACK,IAAI,CAACP,SAAS,IAAIC,cAAc,KAAKD,SAAS,CAAC;AACtE;;AC9EM,MAAOQ,oBAA8C,SAAQ3B,YAAe,CAAA;AAChF4B,EAAAA,OAAO,GAAwB;AAC7BrB,IAAAA,cAAc,EAAE,IAAI;AACpBC,IAAAA,eAAe,EAAE;GAClB;EAaDqB,EAAEA,CAAC,GAAGC,IAAW,EAAA;IACf,MAAM;MAACX,SAAS;MAAEY,GAAG;MAAEzB,OAAO;AAAEsB,MAAAA;AAAQ,KAAA,GAAG,IAAI,CAACI,gBAAgB,CAAC,GAAGF,IAAI,CAAC;AAEzE,IAAA,IAAI,CAAC7B,OAAO,CAACgC,IAAI,CAAC;AAChB3B,MAAAA,OAAO,EAAEA,OAAO;AAChBD,MAAAA,OAAO,EAAEF,KAAK,IAAI,IAAI,CAAC+B,QAAQ,CAAC/B,KAAK,EAAE4B,GAAG,EAAEZ,SAAS,CAAC;MACtD,GAAG,IAAI,CAACS,OAAO;MACf,GAAGA;AACJ,KAAA,CAAC;AAEF,IAAA,OAAO,IAAI;AACb;EAEQI,gBAAgBA,CAAC,GAAGF,IAAW,EAAA;AACrC,IAAA,MAAMK,aAAa,GAAGb,KAAK,CAACC,OAAO,CAACO,IAAI,CAAC,CAAC,CAAC,CAAC,IAAIA,IAAI,CAAC,CAAC,CAAC,IAAI/B,QAAQ;IACnE,MAAMoB,SAAS,GAAGgB,aAAa,GAAGL,IAAI,CAAC,CAAC,CAAC,GAAG/B,QAAQ,CAACqC,IAAI;AACzD,IAAA,MAAML,GAAG,GAAGI,aAAa,GAAGL,IAAI,CAAC,CAAC,CAAC,GAAGA,IAAI,CAAC,CAAC,CAAC;AAC7C,IAAA,MAAMxB,OAAO,GAAG6B,aAAa,GAAGL,IAAI,CAAC,CAAC,CAAC,GAAGA,IAAI,CAAC,CAAC,CAAC;AACjD,IAAA,MAAMF,OAAO,GAAGO,aAAa,GAAGL,IAAI,CAAC,CAAC,CAAC,GAAGA,IAAI,CAAC,CAAC,CAAC;IAEjD,OAAO;AACLC,MAAAA,GAAG,EAAEA,GAAc;AACnBzB,MAAAA,OAAO,EAAEA,OAA0B;AACnCa,MAAAA,SAAS,EAAEA,SAA2B;MACtCS,OAAO,EAAGA,OAAO,IAAI;KACtB;AACH;AAEQM,EAAAA,QAAQA,CAAC/B,KAAQ,EAAE4B,GAAY,EAAEZ,SAAyB,EAAA;AAChE,IAAA,IAAI,CAACD,YAAY,CAACf,KAAK,EAAEgB,SAAS,CAAC,EAAE;AACnC,MAAA,OAAO,KAAK;AACd;IAEA,IAAIY,GAAG,YAAYM,MAAM,EAAE;AACzB,MAAA,OAAON,GAAG,CAACO,IAAI,CAACnC,KAAK,CAAC4B,GAAG,CAAC;AAC5B;IAEA,MAAMQ,MAAM,GAAG,OAAOR,GAAG,KAAK,QAAQ,GAAGA,GAAG,GAAGA,GAAG,EAAE;AACpD,IAAA,OAAOQ,MAAM,CAACC,WAAW,EAAE,KAAKrC,KAAK,CAAC4B,GAAG,CAACS,WAAW,EAAE;AACzD;AACD;;ACnED,IAAYC,WAIX;AAJD,CAAA,UAAYA,WAAW,EAAA;EACrBA,WAAA,CAAAA,WAAA,CAAA,MAAA,CAAA,GAAA,CAAA,CAAA,GAAA,MAAQ;EACRA,WAAA,CAAAA,WAAA,CAAA,WAAA,CAAA,GAAA,CAAA,CAAA,GAAA,WAAa;EACbA,WAAA,CAAAA,WAAA,CAAA,WAAA,CAAA,GAAA,CAAA,CAAA,GAAA,WAAa;AACf,CAAC,EAJWA,WAAW,KAAXA,WAAW,GAItB,EAAA,CAAA,CAAA;AAGK,MAAOC,mBAA4C,SAAQ1C,YAAe,CAAA;AAC9E4B,EAAAA,OAAO,GAAwB;AAC7BrB,IAAAA,cAAc,EAAE,KAAK;AACrBC,IAAAA,eAAe,EAAE;GAClB;EAqBDqB,EAAEA,CAAC,GAAGC,IAAW,EAAA;IACf,MAAM;MAACa,MAAM;MAAErC,OAAO;AAAEa,MAAAA;AAAS,KAAC,GAAG,IAAI,CAACa,gBAAgB,CAAC,GAAGF,IAAI,CAAC;AAEnE,IAAA,IAAI,CAAC7B,OAAO,CAACgC,IAAI,CAAC;MAChB3B,OAAO;AACPD,MAAAA,OAAO,EAAEF,KAAK,IAAI,IAAI,CAAC+B,QAAQ,CAAC/B,KAAK,EAAEwC,MAAM,EAAExB,SAAS,CAAC;AACzD,MAAA,GAAG,IAAI,CAACS;AACT,KAAA,CAAC;AACF,IAAA,OAAO,IAAI;AACb;EAEQI,gBAAgBA,CAAC,GAAGF,IAAW,EAAA;AACrC,IAAA,IAAIA,IAAI,CAACc,MAAM,KAAK,CAAC,EAAE;MACrB,OAAO;AACLD,QAAAA,MAAM,EAAEb,IAAI,CAAC,CAAC,CAAgB;AAC9BX,QAAAA,SAAS,EAAEW,IAAI,CAAC,CAAC,CAAmB;QACpCxB,OAAO,EAAEwB,IAAI,CAAC,CAAC;OAChB;AACH;AAEA,IAAA,IAAIA,IAAI,CAACc,MAAM,KAAK,CAAC,EAAE;MACrB,OAAO;QACLD,MAAM,EAAEF,WAAW,CAACI,IAAI;AACxB1B,QAAAA,SAAS,EAAEW,IAAI,CAAC,CAAC,CAAmB;QACpCxB,OAAO,EAAEwB,IAAI,CAAC,CAAC;OAChB;AACH;IAEA,OAAO;MACLa,MAAM,EAAEF,WAAW,CAACI,IAAI;MACxB1B,SAAS,EAAEpB,QAAQ,CAACqC,IAAI;MACxB9B,OAAO,EAAEwB,IAAI,CAAC,CAAC;KAChB;AACH;AAEAI,EAAAA,QAAQA,CAAC/B,KAAmB,EAAEwC,MAAmB,EAAExB,SAAyB,EAAA;AAC1E,IAAA,OAAOwB,MAAM,MAAMxC,KAAK,CAACwC,MAAM,IAAI,CAAC,CAAC,IAAIzB,YAAY,CAACf,KAAK,EAAEgB,SAAS,CAAC;AACzE;AACD;;MC3CY2B,SAAS,CAAA;EAcCC,MAAA;AAZrBC,EAAAA,cAAc,GAAGC,MAAM,CAAgBC,SAAS,CAAC;EAGjDC,eAAe,GAAGC,QAAQ,CAAC,MAAK;IAC9B,OAAO,IAAI,CAACJ,cAAc,EAAE,GAAG,IAAI,CAACD,MAAM,CAACM,KAAK,EAAE,CAACC,OAAO,CAAC,IAAI,CAACN,cAAc,EAAG,CAAC,GAAG,CAAC,CAAC;AACzF,GAAC,CAAC;EAGFO,WAAW,GAAGH,QAAQ,CAAC,MAAK;AAC1B,IAAA,OAAO,IAAI,CAACL,MAAM,CAACS,UAAU,EAAE,GAAG,IAAI,CAACT,MAAM,CAACM,KAAK,EAAE,CAACC,OAAO,CAAC,IAAI,CAACP,MAAM,CAACS,UAAU,EAAG,CAAC,GAAG,CAAC,CAAC;AAC/F,GAAC,CAAC;EAEFC,WAAAA,CAAqBV,MAA0B,EAAA;IAA1B,IAAM,CAAAA,MAAA,GAANA,MAAM;AAAuB;AAGlDW,EAAAA,cAAcA,GAAA;IACZ,OAAO,IAAI,CAACX,MAAM,CAACY,QAAQ,EAAE,IAAI,IAAI,CAACZ,MAAM,CAACM,KAAK,EAAE,CAACO,KAAK,CAACC,CAAC,IAAIA,CAAC,CAACF,QAAQ,EAAE,CAAC;AAC/E;AAGAG,EAAAA,mBAAmBA,GAAA;AACjB,IAAA,IAAI,IAAI,CAACJ,cAAc,EAAE,EAAE;AACzB,MAAA,OAAOR,SAAS;AAClB;IACA,IAAI,IAAI,CAACH,MAAM,CAACgB,SAAS,EAAE,KAAK,QAAQ,EAAE;AACxC,MAAA,OAAOb,SAAS;AAClB;AACA,IAAA,OAAO,IAAI,CAACH,MAAM,CAACS,UAAU,EAAE,EAAEQ,EAAE,EAAE,IAAId,SAAS;AACpD;AAGAe,EAAAA,eAAeA,GAAA;AACb,IAAA,IAAI,IAAI,CAACP,cAAc,EAAE,EAAE;AACzB,MAAA,OAAO,CAAC;AACV;AACA,IAAA,OAAO,IAAI,CAACX,MAAM,CAACgB,SAAS,EAAE,KAAK,kBAAkB,GAAG,CAAC,GAAG,CAAC,CAAC;AAChE;EAGAG,eAAeA,CAACC,IAAO,EAAA;AACrB,IAAA,IAAI,IAAI,CAACT,cAAc,EAAE,EAAE;AACzB,MAAA,OAAO,CAAC,CAAC;AACX;IACA,IAAI,IAAI,CAACX,MAAM,CAACgB,SAAS,EAAE,KAAK,kBAAkB,EAAE;AAClD,MAAA,OAAO,CAAC,CAAC;AACX;AACA,IAAA,OAAO,IAAI,CAAChB,MAAM,CAACS,UAAU,EAAE,KAAKW,IAAI,GAAG,CAAC,GAAG,CAAC,CAAC;AACnD;AAGAC,EAAAA,KAAKA,CAACD,IAAO,EAAEE,IAA+B,EAAA;AAC5C,IAAA,IAAI,IAAI,CAACX,cAAc,EAAE,IAAI,CAAC,IAAI,CAACY,WAAW,CAACH,IAAI,CAAC,EAAE;AACpD,MAAA,OAAO,KAAK;AACd;AAEA,IAAA,IAAI,CAACnB,cAAc,CAACuB,GAAG,CAAC,IAAI,CAACxB,MAAM,CAACS,UAAU,EAAE,CAAC;IACjD,IAAI,CAACT,MAAM,CAACS,UAAU,CAACe,GAAG,CAACJ,IAAI,CAAC;IAEhC,IAAIE,IAAI,EAAEG,YAAY,IAAIH,IAAI,EAAEG,YAAY,KAAKtB,SAAS,EAAE;AAC1D,MAAA,IAAI,CAACH,MAAM,CAACgB,SAAS,EAAE,KAAK,QAAQ,GAChCI,IAAI,CAACM,OAAO,EAAE,EAAEL,KAAK,EAAE,GACvB,IAAI,CAACrB,MAAM,CAAC0B,OAAO,EAAE,EAAEL,KAAK,EAAE;AACpC;AAEA,IAAA,OAAO,IAAI;AACb;EAGAE,WAAWA,CAACH,IAAO,EAAA;AACjB,IAAA,OAAO,CAACA,IAAI,CAACR,QAAQ,EAAE,IAAI,IAAI,CAACZ,MAAM,CAAC2B,YAAY,EAAE;AACvD;AACD;;MC7FYC,cAAc,CAAA;EACJ5B,MAAA;EAArBU,WAAAA,CAAqBV,MAA8D,EAAA;IAA9D,IAAM,CAAAA,MAAA,GAANA,MAAM;AAA2D;AAGtF6B,EAAAA,IAAIA,CAACT,IAAQ,EAAEE,IAA+B,EAAA;AAC5C,IAAA,OAAOF,IAAI,GAAG,IAAI,CAACpB,MAAM,CAAC8B,YAAY,CAACT,KAAK,CAACD,IAAI,EAAEE,IAAI,CAAC,GAAG,KAAK;AAClE;EAGAS,IAAIA,CAACT,IAA+B,EAAA;AAClC,IAAA,OAAO,IAAI,CAACU,QAAQ,CAAC,CAAC,EAAEV,IAAI,CAAC;AAC/B;AAGAW,EAAAA,QAAQA,GAAA;AACN,IAAA,OAAO,IAAI,CAACC,KAAK,CAAC,CAAC,CAAC;AACtB;EAGAC,IAAIA,CAACb,IAA+B,EAAA;IAClC,OAAO,IAAI,CAACU,QAAQ,CAAC,CAAC,CAAC,EAAEV,IAAI,CAAC;AAChC;AAGAc,EAAAA,QAAQA,GAAA;AACN,IAAA,OAAO,IAAI,CAACF,KAAK,CAAC,CAAC,CAAC,CAAC;AACvB;EAGAG,KAAKA,CAACf,IAA+B,EAAA;AACnC,IAAA,MAAMF,IAAI,GAAG,IAAI,CAACkB,SAAS,EAAE;IAC7B,OAAOlB,IAAI,GAAG,IAAI,CAACS,IAAI,CAACT,IAAI,EAAEE,IAAI,CAAC,GAAG,KAAK;AAC7C;EAGAiB,IAAIA,CAACjB,IAA+B,EAAA;AAClC,IAAA,MAAMF,IAAI,GAAG,IAAI,CAACoB,QAAQ,EAAE;IAC5B,OAAOpB,IAAI,GAAG,IAAI,CAACS,IAAI,CAACT,IAAI,EAAEE,IAAI,CAAC,GAAG,KAAK;AAC7C;EAGAgB,SAASA,CAAChC,KAAa,GAAA,IAAI,CAACN,MAAM,CAACM,KAAK,EAAE,EAAA;AACxC,IAAA,OAAOA,KAAK,CAACmC,IAAI,CAAC3B,CAAC,IAAI,IAAI,CAACd,MAAM,CAAC8B,YAAY,CAACP,WAAW,CAACT,CAAC,CAAC,CAAC;AACjE;EAGA0B,QAAQA,CAAClC,KAAa,GAAA,IAAI,CAACN,MAAM,CAACM,KAAK,EAAE,EAAA;AACvC,IAAA,KAAK,IAAIQ,CAAC,GAAGR,KAAK,CAACT,MAAM,GAAG,CAAC,EAAEiB,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAAE;AAC1C,MAAA,IAAI,IAAI,CAACd,MAAM,CAAC8B,YAAY,CAACP,WAAW,CAACjB,KAAK,CAACQ,CAAC,CAAC,CAAC,EAAE;QAClD,OAAOR,KAAK,CAACQ,CAAC,CAAC;AACjB;AACF;AACA,IAAA;AACF;AAGQkB,EAAAA,QAAQA,CAACU,KAAa,EAAEpB,IAA+B,EAAA;AAC7D,IAAA,MAAMF,IAAI,GAAG,IAAI,CAACc,KAAK,CAACQ,KAAK,CAAC;IAC9B,OAAOtB,IAAI,GAAG,IAAI,CAACS,IAAI,CAACT,IAAI,EAAEE,IAAI,CAAC,GAAG,KAAK;AAC7C;EAGQY,KAAKA,CAACQ,KAAa,EAAA;IACzB,MAAMpC,KAAK,GAAG,IAAI,CAACN,MAAM,CAACM,KAAK,EAAE;AACjC,IAAA,MAAMqC,SAAS,GAAGrC,KAAK,CAACT,MAAM;IAC9B,MAAM+C,UAAU,GAAG,IAAI,CAAC5C,MAAM,CAAC8B,YAAY,CAACtB,WAAW,EAAE;IACzD,MAAMqC,IAAI,GAAI/B,CAAS,IACrB,IAAI,CAACd,MAAM,CAAC8C,IAAI,EAAE,GAAG,CAAChC,CAAC,GAAG4B,KAAK,GAAGC,SAAS,IAAIA,SAAS,GAAG7B,CAAC,GAAG4B,KAAK;IAKtE,KAAK,IAAI5B,CAAC,GAAG+B,IAAI,CAACD,UAAU,CAAC,EAAE9B,CAAC,KAAK8B,UAAU,IAAI9B,CAAC,GAAG6B,SAAS,IAAI7B,CAAC,IAAI,CAAC,EAAEA,CAAC,GAAG+B,IAAI,CAAC/B,CAAC,CAAC,EAAE;AACvF,MAAA,IAAI,IAAI,CAACd,MAAM,CAAC8B,YAAY,CAACP,WAAW,CAACjB,KAAK,CAACQ,CAAC,CAAC,CAAC,EAAE;QAClD,OAAOR,KAAK,CAACQ,CAAC,CAAC;AACjB;AACF;AAEA,IAAA;AACF;AACD;;MCpEYiC,QAAQ,CAAA;EAuFE/C,MAAA;EArFZgD,KAAK;EAGLC,WAAW,GAAG5C,QAAQ,CAAS,MAAM6C,IAAI,CAACC,GAAG,CAAC,GAAG,IAAI,CAACC,cAAc,EAAE,CAACC,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC;EAGpFC,WAAW,GAAGjD,QAAQ,CAAS,MAAM6C,IAAI,CAACC,GAAG,CAAC,GAAG,IAAI,CAACI,eAAe,EAAE,CAACF,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC;EAG7EG,UAAU,GAAGnD,QAAQ,CAAiD,MAAK;AAC1F,IAAA,MAAMoD,SAAS,GAAG,IAAIC,GAAG,EAAE;AAC3B,IAAA,MAAMC,aAAa,GAAG,IAAIC,GAAG,EAAE;AAE/B,IAAA,KAAK,IAAIC,QAAQ,GAAG,CAAC,EAAEA,QAAQ,GAAG,IAAI,CAACb,KAAK,EAAE,CAACnD,MAAM,EAAEgE,QAAQ,EAAE,EAAE;MACjE,IAAIC,QAAQ,GAAG,CAAC;MAChB,MAAMC,GAAG,GAAG,IAAI,CAACf,KAAK,EAAE,CAACa,QAAQ,CAAC;AAElC,MAAA,KAAK,MAAMG,IAAI,IAAID,GAAG,EAAE;QAEtB,OAAOJ,aAAa,CAACM,GAAG,CAAC,CAAA,EAAGJ,QAAQ,CAAIC,CAAAA,EAAAA,QAAQ,CAAE,CAAA,CAAC,EAAE;AACnDA,UAAAA,QAAQ,EAAE;AACZ;AAEA,QAAA,MAAMI,OAAO,GAAGF,IAAI,CAACG,OAAO,EAAE;AAC9B,QAAA,MAAMC,OAAO,GAAGJ,IAAI,CAACK,OAAO,EAAE;QAC9B,MAAMC,UAAU,GAAa,EAAE;QAE/B,KAAK,IAAIC,SAAS,GAAG,CAAC,EAAEA,SAAS,GAAGL,OAAO,EAAEK,SAAS,EAAE,EAAE;AACxD,UAAA,MAAMR,GAAG,GAAGF,QAAQ,GAAGU,SAAS;UAChC,KAAK,IAAIC,SAAS,GAAG,CAAC,EAAEA,SAAS,GAAGJ,OAAO,EAAEI,SAAS,EAAE,EAAE;AACxD,YAAA,MAAMC,GAAG,GAAGX,QAAQ,GAAGU,SAAS;YAChCb,aAAa,CAACe,GAAG,CAAC,CAAA,EAAGX,GAAG,CAAIU,CAAAA,EAAAA,GAAG,EAAE,CAAC;YAClCH,UAAU,CAACpF,IAAI,CAAC;cAAC6E,GAAG;AAAEU,cAAAA;AAAI,aAAA,CAAC;AAC7B;AACF;AACAhB,QAAAA,SAAS,CAACjC,GAAG,CAACwC,IAAI,EAAE;AAACW,UAAAA,MAAM,EAAEL,UAAU,CAAC,CAAC,CAAC;AAAEA,UAAAA;AAAU,SAAC,CAAC;AAExDR,QAAAA,QAAQ,IAAIM,OAAO;AACrB;AACF;AAEA,IAAA,OAAOX,SAAS;AAClB,GAAC,CAAC;EAGemB,QAAQ,GAAGvE,QAAQ,CAAsB,MAAK;AAC7D,IAAA,MAAMwE,OAAO,GAAG,IAAInB,GAAG,EAAE;IACzB,KAAK,MAAM,CAACM,IAAI,EAAE;AAACM,MAAAA;KAAW,CAAC,IAAI,IAAI,CAACd,UAAU,EAAE,CAACsB,OAAO,EAAE,EAAE;AAC9D,MAAA,KAAK,MAAM;QAACf,GAAG;AAAEU,QAAAA;OAAI,IAAIH,UAAU,EAAE;QACnCO,OAAO,CAACrD,GAAG,CAAC,CAAGuC,EAAAA,GAAG,IAAIU,GAAG,CAAA,CAAE,EAAET,IAAI,CAAC;AACpC;AACF;AACA,IAAA,OAAOa,OAAO;AAChB,GAAC,CAAC;EAGetB,eAAe,GAAGlD,QAAQ,CAAsB,MAAK;AACpE,IAAA,MAAM0E,aAAa,GAAG,IAAIrB,GAAG,EAAE;IAC/B,KAAK,MAAM,CAACsB,CAAC,EAAE;AAACV,MAAAA;KAAW,CAAC,IAAI,IAAI,CAACd,UAAU,EAAE,CAACsB,OAAO,EAAE,EAAE;AAC3D,MAAA,KAAK,MAAM;QAACf,GAAG;AAAEU,QAAAA;OAAI,IAAIH,UAAU,EAAE;AACnC,QAAA,MAAMW,QAAQ,GAAGF,aAAa,CAACG,GAAG,CAACnB,GAAG,CAAC;AACvC,QAAA,MAAMoB,WAAW,GAAGV,GAAG,GAAG,CAAC;AAC3B,QAAA,IAAIQ,QAAQ,KAAK9E,SAAS,IAAI8E,QAAQ,GAAGE,WAAW,EAAE;AACpDJ,UAAAA,aAAa,CAACvD,GAAG,CAACuC,GAAG,EAAEoB,WAAW,CAAC;AACrC;AACF;AACF;AACA,IAAA,OAAOJ,aAAa;AACtB,GAAC,CAAC;EAGe3B,cAAc,GAAG/C,QAAQ,CAAsB,MAAK;AACnE,IAAA,MAAM+E,aAAa,GAAG,IAAI1B,GAAG,EAAE;IAC/B,KAAK,MAAM,CAACsB,CAAC,EAAE;AAACV,MAAAA;KAAW,CAAC,IAAI,IAAI,CAACd,UAAU,EAAE,CAACsB,OAAO,EAAE,EAAE;AAC3D,MAAA,KAAK,MAAM;QAACf,GAAG;AAAEU,QAAAA;OAAI,IAAIH,UAAU,EAAE;AACnC,QAAA,MAAMe,QAAQ,GAAGD,aAAa,CAACF,GAAG,CAACT,GAAG,CAAC;AACvC,QAAA,MAAMa,WAAW,GAAGvB,GAAG,GAAG,CAAC;AAC3B,QAAA,IAAIsB,QAAQ,KAAKlF,SAAS,IAAIkF,QAAQ,GAAGC,WAAW,EAAE;AACpDF,UAAAA,aAAa,CAAC5D,GAAG,CAACiD,GAAG,EAAEa,WAAW,CAAC;AACrC;AACF;AACF;AACA,IAAA,OAAOF,aAAa;AACtB,GAAC,CAAC;EAEF1E,WAAAA,CAAqBV,MAAyB,EAAA;IAAzB,IAAM,CAAAA,MAAA,GAANA,MAAM;AACzB,IAAA,IAAI,CAACgD,KAAK,GAAG,IAAI,CAAChD,MAAM,CAACgD,KAAK;AAChC;EAGAuC,OAAOA,CAACvB,IAAO,EAAA;IACb,OAAO,IAAI,CAACR,UAAU,EAAE,CAACS,GAAG,CAACD,IAAI,CAAC;AACpC;EAGAwB,OAAOA,CAACC,MAAc,EAAA;AACpB,IAAA,OAAO,IAAI,CAACb,QAAQ,EAAE,CAACM,GAAG,CAAC,CAAGO,EAAAA,MAAM,CAAC1B,GAAG,CAAA,CAAA,EAAI0B,MAAM,CAAChB,GAAG,EAAE,CAAC;AAC3D;EAGAiB,SAASA,CAAC1B,IAAO,EAAA;IACf,OAAO,IAAI,CAACR,UAAU,EAAE,CAAC0B,GAAG,CAAClB,IAAI,CAAC,EAAEW,MAAM;AAC5C;EAGAgB,YAAYA,CAAC3B,IAAO,EAAA;IAClB,OAAO,IAAI,CAACR,UAAU,EAAE,CAAC0B,GAAG,CAAClB,IAAI,CAAC,EAAEM,UAAU;AAChD;EAGAsB,WAAWA,CAACnB,GAAW,EAAA;IACrB,OAAO,IAAI,CAACrB,cAAc,EAAE,CAAC8B,GAAG,CAACT,GAAG,CAAC;AACvC;EAGAoB,WAAWA,CAAC9B,GAAW,EAAA;IACrB,OAAO,IAAI,CAACR,eAAe,EAAE,CAAC2B,GAAG,CAACnB,GAAG,CAAC;AACxC;AACD;;MCpHY+B,SAAS,CAAA;EA8DC9F,MAAA;AA5DZ+F,EAAAA,UAAU,GAAkC7F,MAAM,CAACC,SAAS,CAAC;EAG7D6F,YAAY,GAAG9F,MAAM,CAAS;IAAC6D,GAAG,EAAE,CAAC,CAAC;AAAEU,IAAAA,GAAG,EAAE,CAAC;AAAC,GAAC,CAAC;AAGjDwB,EAAAA,UAAU,GAAG5F,QAAQ,CAC5B,MACE,IAAI,CAAC0F,UAAU,EAAE,KAAK5F,SAAS,IAC9B,IAAI,CAAC6F,YAAY,EAAE,CAACjC,GAAG,KAAK,CAAC,CAAC,IAAI,IAAI,CAACiC,YAAY,EAAE,CAACvB,GAAG,KAAK,CAAC,CAAE,CACrE;EASQyB,UAAU,GAAG7F,QAAQ,CAAC,MAAK;AAClC,IAAA,IAAI,IAAI,CAAC4F,UAAU,EAAE,EAAE;AACrB,MAAA,OAAO,IAAI;AACb;AAEA,IAAA,MAAMF,UAAU,GAAG,IAAI,CAACA,UAAU,EAAE;IACpC,MAAMI,gBAAgB,GAAG,IAAI,CAACnG,MAAM,CAACoG,IAAI,CAACV,SAAS,CAACK,UAAW,CAAC;AAChE,IAAA,MAAMC,YAAY,GAAG,IAAI,CAACA,YAAY,EAAE;IACxC,MAAMK,gBAAgB,GAAG,IAAI,CAACrG,MAAM,CAACoG,IAAI,CAACZ,OAAO,CAACQ,YAAY,CAAC;AAE/D,IAAA,MAAMM,kBAAkB,GAAGH,gBAAgB,KAAKhG,SAAS;AACzD,IAAA,MAAMoG,kBAAkB,GAAGR,UAAU,KAAKM,gBAAgB;IAC1D,OAAOC,kBAAkB,IAAIC,kBAAkB;AACjD,GAAC,CAAC;EAGOC,gBAAgB,GAAGnG,QAAQ,CAAqB,MAAK;AAC5D,IAAA,IAAI,IAAI,CAACoG,YAAY,EAAE,IAAI,IAAI,CAACzG,MAAM,CAACgB,SAAS,EAAE,KAAK,QAAQ,EAAE;AAC/D,MAAA,OAAOb,SAAS;AAClB;AACA,IAAA,MAAMuG,iBAAiB,GAAG,IAAI,CAACX,UAAU,EAAE;IAC3C,OAAOW,iBAAiB,GAAGA,iBAAiB,CAACzF,EAAE,EAAE,GAAGd,SAAS;AAC/D,GAAC,CAAC;EAGOsG,YAAY,GAAGpG,QAAQ,CAAU,MAAK;AAC7C,IAAA,IAAI,IAAI,CAACL,MAAM,CAACY,QAAQ,EAAE,EAAE;AAC1B,MAAA,OAAO,IAAI;AACb;IACA,MAAM+F,SAAS,GAAG,IAAI,CAAC3G,MAAM,CAACoG,IAAI,CAACpD,KAAK,EAAE;IAC1C,OAAO2D,SAAS,CAAC9G,MAAM,KAAK,CAAC,IAAI8G,SAAS,CAAC9F,KAAK,CAACkD,GAAG,IAAIA,GAAG,CAAClD,KAAK,CAACmD,IAAI,IAAIA,IAAI,CAACpD,QAAQ,EAAE,CAAC,CAAC;AAC7F,GAAC,CAAC;EAGOgG,YAAY,GAAGvG,QAAQ,CAAS,MAAK;AAC5C,IAAA,IAAI,IAAI,CAACoG,YAAY,EAAE,EAAE;AACvB,MAAA,OAAO,CAAC;AACV;AACA,IAAA,OAAO,IAAI,CAACzG,MAAM,CAACgB,SAAS,EAAE,KAAK,kBAAkB,GAAG,CAAC,GAAG,CAAC,CAAC;AAChE,GAAC,CAAC;EAEFN,WAAAA,CAAqBV,MAA0C,EAAA;IAA1C,IAAM,CAAAA,MAAA,GAANA,MAAM;AAAuC;EAGlE6G,eAAeA,CAAC7C,IAAO,EAAA;AACrB,IAAA,IAAI,IAAI,CAACyC,YAAY,EAAE,EAAE;AACvB,MAAA,OAAO,CAAC,CAAC;AACX;IACA,IAAI,IAAI,CAACzG,MAAM,CAACgB,SAAS,EAAE,KAAK,kBAAkB,EAAE;AAClD,MAAA,OAAO,CAAC,CAAC;AACX;IACA,OAAO,IAAI,CAAC+E,UAAU,EAAE,KAAK/B,IAAI,GAAG,CAAC,GAAG,CAAC,CAAC;AAC5C;EAGAzC,WAAWA,CAACyC,IAAO,EAAA;IACjB,OAAO,IAAI,CAAChE,MAAM,CAACoG,IAAI,CAACb,OAAO,CAACvB,IAAI,CAAC,KAAK,CAACA,IAAI,CAACpD,QAAQ,EAAE,IAAI,IAAI,CAACZ,MAAM,CAAC2B,YAAY,EAAE,CAAC;AAC3F;EAGAmF,SAASA,CAAC9C,IAAO,EAAA;AACf,IAAA,IAAI,IAAI,CAACyC,YAAY,EAAE,EAAE;AACvB,MAAA,OAAO,KAAK;AACd;AAEA,IAAA,IAAI,CAAC,IAAI,CAAClF,WAAW,CAACyC,IAAI,CAAC,EAAE;AAC3B,MAAA,OAAO,KAAK;AACd;AAEA,IAAA,IAAI,IAAI,CAAChE,MAAM,CAACoG,IAAI,CAACV,SAAS,CAAC1B,IAAI,CAAC,KAAK7D,SAAS,EAAE;AAClD,MAAA,OAAO,KAAK;AACd;AAEA,IAAA,IAAI,CAAC6F,YAAY,CAACxE,GAAG,CAAC,IAAI,CAACxB,MAAM,CAACoG,IAAI,CAACV,SAAS,CAAC1B,IAAI,CAAE,CAAC;AACxD,IAAA,IAAI,CAAC+B,UAAU,CAACvE,GAAG,CAACwC,IAAI,CAAC;AAEzB,IAAA,OAAO,IAAI;AACb;EAGA+C,gBAAgBA,CAACpC,MAAc,EAAA;AAC7B,IAAA,IAAI,IAAI,CAAC8B,YAAY,EAAE,EAAE;AACvB,MAAA,OAAO,KAAK;AACd;IAEA,MAAMzC,IAAI,GAAG,IAAI,CAAChE,MAAM,CAACoG,IAAI,CAACZ,OAAO,CAACb,MAAM,CAAC;IAE7C,IAAI,CAACX,IAAI,IAAI,CAAC,IAAI,CAACzC,WAAW,CAACyC,IAAI,CAAC,EAAE;AACpC,MAAA,OAAO,KAAK;AACd;AAEA,IAAA,IAAI,IAAI,CAAChE,MAAM,CAACoG,IAAI,CAACZ,OAAO,CAACb,MAAM,CAAC,KAAKxE,SAAS,EAAE;AAClD,MAAA,OAAO,KAAK;AACd;AAEA,IAAA,IAAI,CAAC6F,YAAY,CAACxE,GAAG,CAACmD,MAAM,CAAC;AAC7B,IAAA,IAAI,CAACoB,UAAU,CAACvE,GAAG,CAAC,IAAI,CAACxB,MAAM,CAACoG,IAAI,CAACZ,OAAO,CAACb,MAAM,CAAC,CAAC;AAErD,IAAA,OAAO,IAAI;AACb;AACD;;AC9IM,MAAMqC,SAAS,GAAoD;AACxEC,EAAAA,EAAE,EAAE;AAAClD,IAAAA,GAAG,EAAE,CAAC;GAAE;AACbmD,EAAAA,IAAI,EAAE;AAACnD,IAAAA,GAAG,EAAE;GAAE;AACdoD,EAAAA,IAAI,EAAE;AAAC1C,IAAAA,GAAG,EAAE,CAAC;GAAE;AACf2C,EAAAA,KAAK,EAAE;AAAC3C,IAAAA,GAAG,EAAE;AAAE;CACP;MA2BG4C,cAAc,CAAA;EAMJrH,MAAA;EAJbsH,SAAS,GAAGjH,QAAQ,CAC1B,MAAM,IAAI,CAACL,MAAM,CAACoG,IAAI,CAACnD,WAAW,EAAE,GAAG,IAAI,CAACjD,MAAM,CAACoG,IAAI,CAAC9C,WAAW,EAAE,CACtE;EAED5C,WAAAA,CAAqBV,MAAoD,EAAA;IAApD,IAAM,CAAAA,MAAA,GAANA,MAAM;AAAiD;EAG5EuH,QAAQA,CAACvD,IAAO,EAAA;IACd,OAAO,IAAI,CAAChE,MAAM,CAACwH,SAAS,CAACV,SAAS,CAAC9C,IAAI,CAAC;AAC9C;EAGAyD,UAAUA,CAAC9C,MAAc,EAAA;IACvB,OAAO,IAAI,CAAC3E,MAAM,CAACwH,SAAS,CAACT,gBAAgB,CAACpC,MAAM,CAAC;AACvD;EAKA+C,IAAIA,CACFV,SAAgB,EAChBW,UAAkB,EAClB7E,IAAmB,EACnB8E,aAAuB,EAAA;IAEvB9E,IAAI,GAAGA,IAAI,KAAKkE,SAAS,CAACjD,GAAG,KAAK5D,SAAS,GAAG,IAAI,CAACH,MAAM,CAAC6H,OAAO,EAAE,GAAG,IAAI,CAAC7H,MAAM,CAAC8H,OAAO,EAAE,CAAC;IAC5F,OAAO,IAAI,CAACC,gBAAgB,CAACf,SAAS,EAAEW,UAAU,EAAE7E,IAAI,EAAE8E,aAAa,CAAC;AAC1E;EAKAI,OAAOA,CAAChB,SAAgB,EAAA;AACtB,IAAA,MAAMiB,UAAU,GAAG,IAAI,CAACP,IAAI,CAACV,SAAS,EAAE,IAAI,CAAChH,MAAM,CAACwH,SAAS,CAACxB,YAAY,EAAE,CAAC;IAC7E,OAAO,CAAC,CAACiC,UAAU,IAAI,IAAI,CAACR,UAAU,CAACQ,UAAU,CAAC;AACpD;AAMA3F,EAAAA,SAASA,CAACyB,GAAY,EAAE6D,aAAuB,EAAA;AAC7C,IAAA,MAAMD,UAAU,GAAG;MACjB5D,GAAG,EAAEA,GAAG,IAAI,CAAC;AACbU,MAAAA,GAAG,EAAE,CAAC;KACP;AACD,IAAA,OAAOV,GAAG,KAAK5D,SAAS,GACpB,IAAI,CAAC4H,gBAAgB,CAACf,SAAS,CAACI,KAAK,EAAEO,UAAU,EAAE,YAAY,EAAEC,aAAa,CAAA,GAC9E,IAAI,CAACG,gBAAgB,CAACf,SAAS,CAACI,KAAK,EAAEO,UAAU,EAAE,QAAQ,EAAEC,aAAa,CAAC;AACjF;EAMAvF,KAAKA,CAAC0B,GAAY,EAAA;AAChB,IAAA,MAAMkE,UAAU,GAAG,IAAI,CAAC3F,SAAS,CAACyB,GAAG,CAAC;IACtC,OAAO,CAAC,CAACkE,UAAU,IAAI,IAAI,CAACR,UAAU,CAACQ,UAAU,CAAC;AACpD;AAMAzF,EAAAA,QAAQA,CAACuB,GAAY,EAAE6D,aAAuB,EAAA;AAC5C,IAAA,MAAMD,UAAU,GAAG;AACjB5D,MAAAA,GAAG,EAAEA,GAAG,IAAI,IAAI,CAAC/D,MAAM,CAACoG,IAAI,CAACnD,WAAW,EAAE,GAAG,CAAC;MAC9CwB,GAAG,EAAE,IAAI,CAACzE,MAAM,CAACoG,IAAI,CAAC9C,WAAW;KAClC;AACD,IAAA,OAAOS,GAAG,KAAK5D,SAAS,GACpB,IAAI,CAAC4H,gBAAgB,CAACf,SAAS,CAACG,IAAI,EAAEQ,UAAU,EAAE,YAAY,EAAEC,aAAa,CAAA,GAC7E,IAAI,CAACG,gBAAgB,CAACf,SAAS,CAACG,IAAI,EAAEQ,UAAU,EAAE,QAAQ,EAAEC,aAAa,CAAC;AAChF;EAMArF,IAAIA,CAACwB,GAAY,EAAA;AACf,IAAA,MAAMkE,UAAU,GAAG,IAAI,CAACzF,QAAQ,CAACuB,GAAG,CAAC;IACrC,OAAO,CAAC,CAACkE,UAAU,IAAI,IAAI,CAACR,UAAU,CAACQ,UAAU,CAAC;AACpD;EAKQF,gBAAgBA,CACtBrF,KAAY,EACZiF,UAAkB,EAClB7E,IAAsC,EACtC8E,gBAAyB,KAAK,EAAA;IAE9B,IAAI,IAAI,CAAC5H,MAAM,CAACwH,SAAS,CAACf,YAAY,EAAE,EAAE,OAAOtG,SAAS;IAE1D,MAAM+H,QAAQ,GAAG,IAAI,CAAClI,MAAM,CAACoG,IAAI,CAACZ,OAAO,CAACmC,UAAU,CAAC;IACrD,MAAM1E,WAAW,GAAG,IAAI,CAACjD,MAAM,CAACoG,IAAI,CAACnD,WAAW,EAAE;IAClD,MAAMK,WAAW,GAAG,IAAI,CAACtD,MAAM,CAACoG,IAAI,CAAC9C,WAAW,EAAE;AAClD,IAAA,MAAM6E,QAAQ,GAAGzF,KAAK,CAACqB,GAAG,IAAI,CAAC;AAC/B,IAAA,MAAMqE,QAAQ,GAAG1F,KAAK,CAAC+B,GAAG,IAAI,CAAC;AAC/B,IAAA,IAAIwD,UAAU,GAAG;MAAC,GAAGN;KAAW;AAEhC,IAAA,KAAK,IAAI9E,IAAI,GAAG,CAAC,EAAEA,IAAI,GAAG,IAAI,CAACyE,SAAS,EAAE,EAAEzE,IAAI,EAAE,EAAE;AAClD,MAAA,MAAMwF,UAAU,GACdJ,UAAU,CAACxD,GAAG,GAAG2D,QAAQ,GAAG,CAAC,IAC7BH,UAAU,CAACxD,GAAG,GAAG2D,QAAQ,IAAI9E,WAAW,IACxC2E,UAAU,CAAClE,GAAG,GAAGoE,QAAQ,GAAG,CAAC,IAC7BF,UAAU,CAAClE,GAAG,GAAGoE,QAAQ,IAAIlF,WAAW;AAE1C,MAAA,IAAIH,IAAI,KAAK,QAAQ,IAAIuF,UAAU,EAAE,OAAOlI,SAAS;MAErD,IAAI2C,IAAI,KAAK,YAAY,EAAE;QACzB,MAAMwF,YAAY,GAAG5F,KAAK,CAACqB,GAAG,IAAIrB,KAAK,CAAC+B,GAAG;AAC3C,QAAA,MAAM8D,OAAO,GAAGF,UAAU,GAAGC,YAAY,GAAGH,QAAQ;AACpD,QAAA,MAAMK,OAAO,GAAGH,UAAU,GAAGC,YAAY,GAAGF,QAAQ;AAGpD,QAAA,MAAMK,YAAY,GACfR,UAAU,CAAClE,GAAG,GAAGwE,OAAO,IAAItF,WAAW,IAAIgF,UAAU,CAACxD,GAAG,GAAG+D,OAAO,IAAIlF,WAAW,IAClF2E,UAAU,CAAClE,GAAG,GAAGwE,OAAO,GAAG,CAAC,IAAIN,UAAU,CAACxD,GAAG,GAAG+D,OAAO,GAAG,CAAE;QAChE,IAAIC,YAAY,EAAE,OAAOtI,SAAS;AAElC8H,QAAAA,UAAU,GAAG;UACXlE,GAAG,EAAE,CAACkE,UAAU,CAAClE,GAAG,GAAGwE,OAAO,GAAGtF,WAAW,IAAIA,WAAW;UAC3DwB,GAAG,EAAE,CAACwD,UAAU,CAACxD,GAAG,GAAG+D,OAAO,GAAGlF,WAAW,IAAIA;SACjD;AACH;MAEA,IAAIR,IAAI,KAAK,MAAM,EAAE;AACnBmF,QAAAA,UAAU,GAAG;UACXlE,GAAG,EAAE,CAACkE,UAAU,CAAClE,GAAG,GAAGoE,QAAQ,GAAGlF,WAAW,IAAIA,WAAW;UAC5DwB,GAAG,EAAE,CAACwD,UAAU,CAACxD,GAAG,GAAG2D,QAAQ,GAAG9E,WAAW,IAAIA;SAClD;AACH;MAEA,IAAIR,IAAI,KAAK,QAAQ,EAAE;AACrBmF,QAAAA,UAAU,GAAG;AACXlE,UAAAA,GAAG,EAAEkE,UAAU,CAAClE,GAAG,GAAGoE,QAAQ;AAC9B1D,UAAAA,GAAG,EAAEwD,UAAU,CAACxD,GAAG,GAAG2D;SACvB;AACH;AAGA,MAAA,IAAIH,UAAU,CAAClE,GAAG,KAAK4D,UAAU,CAAC5D,GAAG,IAAIkE,UAAU,CAACxD,GAAG,KAAKkD,UAAU,CAAClD,GAAG,EAAE;AAC1E,QAAA,OAAOtE,SAAS;AAClB;MAEA,MAAMuI,QAAQ,GAAG,IAAI,CAAC1I,MAAM,CAACoG,IAAI,CAACZ,OAAO,CAACyC,UAAU,CAAC;MACrD,IACES,QAAQ,KAAKvI,SAAS,IACtBuI,QAAQ,KAAKR,QAAQ,KACpBN,aAAa,IAAI,IAAI,CAAC5H,MAAM,CAACwH,SAAS,CAACjG,WAAW,CAACmH,QAAQ,CAAC,CAAC,EAC9D;AACA,QAAA,OAAOT,UAAU;AACnB;AACF;AAEA,IAAA,OAAO9H,SAAS;AAClB;AACD;;MCnLYwI,aAAa,CAAA;EAIH3I,MAAA;AAFJ4I,EAAAA,SAAS,GAAuC1I,MAAM,CAAC,EAAE,CAAC;EAE3EQ,WAAAA,CAAqBV,MAAkD,EAAA;IAAlD,IAAM,CAAAA,MAAA,GAANA,MAAM;AAA+C;AAG1E6I,EAAAA,IAAIA,GAAA;AACF,IAAA,KAAK,MAAM,CAAC7E,IAAI,EAAE8E,QAAQ,CAAC,IAAI,IAAI,CAACF,SAAS,EAAE,EAAE;AAC/C5E,MAAAA,IAAI,CAAC+E,QAAQ,CAACvH,GAAG,CAACsH,QAAQ,CAAC;AAC7B;AACA,IAAA,IAAI,CAACF,SAAS,CAACpH,GAAG,CAAC,EAAE,CAAC;AACxB;AAGAwH,EAAAA,MAAMA,CAACrB,UAAkB,EAAEsB,QAAiB,EAAA;IAC1C,IAAI,CAACC,YAAY,CAACvB,UAAU,EAAEsB,QAAQ,IAAItB,UAAU,EAAE,MAAM,IAAI,CAAC;AACnE;AAGAwB,EAAAA,QAAQA,CAACxB,UAAkB,EAAEsB,QAAiB,EAAA;IAC5C,IAAI,CAACC,YAAY,CAACvB,UAAU,EAAEsB,QAAQ,IAAItB,UAAU,EAAE,MAAM,KAAK,CAAC;AACpE;AAGAyB,EAAAA,MAAMA,CAACzB,UAAkB,EAAEsB,QAAiB,EAAA;AAC1C,IAAA,IAAI,CAACC,YAAY,CAACvB,UAAU,EAAEsB,QAAQ,IAAItB,UAAU,EAAEmB,QAAQ,IAAI,CAACA,QAAQ,CAAC;AAC9E;AAGAO,EAAAA,SAASA,GAAA;IACP,IAAI,CAACH,YAAY,CACf;AAACnF,MAAAA,GAAG,EAAE,CAAC;AAAEU,MAAAA,GAAG,EAAE;AAAC,KAAC,EAChB;MAACV,GAAG,EAAE,IAAI,CAAC/D,MAAM,CAACoG,IAAI,CAACnD,WAAW,EAAE;MAAEwB,GAAG,EAAE,IAAI,CAACzE,MAAM,CAACoG,IAAI,CAAC9C,WAAW;KAAG,EAC1E,MAAM,IAAI,CACX;AACH;AAGAgG,EAAAA,WAAWA,GAAA;IACT,IAAI,CAACJ,YAAY,CACf;AAACnF,MAAAA,GAAG,EAAE,CAAC;AAAEU,MAAAA,GAAG,EAAE;AAAC,KAAC,EAChB;MAACV,GAAG,EAAE,IAAI,CAAC/D,MAAM,CAACoG,IAAI,CAACnD,WAAW,EAAE;MAAEwB,GAAG,EAAE,IAAI,CAACzE,MAAM,CAACoG,IAAI,CAAC9C,WAAW;KAAG,EAC1E,MAAM,KAAK,CACZ;AACH;EAGAiG,YAAYA,CAACvF,IAAO,EAAA;IAClB,OAAOA,IAAI,CAACwF,UAAU,EAAE,IAAI,CAACxF,IAAI,CAACpD,QAAQ,EAAE;AAC9C;AAGA,EAAA,CAAC6I,WAAWA,CAAC9B,UAAkB,EAAEsB,QAAgB,EAAA;AAC/C,IAAA,MAAMS,QAAQ,GAAGxG,IAAI,CAACyG,GAAG,CAAChC,UAAU,CAAC5D,GAAG,EAAEkF,QAAQ,CAAClF,GAAG,CAAC;AACvD,IAAA,MAAM6F,QAAQ,GAAG1G,IAAI,CAACyG,GAAG,CAAChC,UAAU,CAAClD,GAAG,EAAEwE,QAAQ,CAACxE,GAAG,CAAC;AACvD,IAAA,MAAMoF,MAAM,GAAG3G,IAAI,CAACC,GAAG,CAACwE,UAAU,CAAC5D,GAAG,EAAEkF,QAAQ,CAAClF,GAAG,CAAC;AACrD,IAAA,MAAM+F,MAAM,GAAG5G,IAAI,CAACC,GAAG,CAACwE,UAAU,CAAClD,GAAG,EAAEwE,QAAQ,CAACxE,GAAG,CAAC;AACrD,IAAA,MAAMsF,OAAO,GAAG,IAAInG,GAAG,EAAK;AAC5B,IAAA,KAAK,IAAIG,GAAG,GAAG2F,QAAQ,EAAE3F,GAAG,GAAG8F,MAAM,GAAG,CAAC,EAAE9F,GAAG,EAAE,EAAE;AAChD,MAAA,KAAK,IAAIU,GAAG,GAAGmF,QAAQ,EAAEnF,GAAG,GAAGqF,MAAM,GAAG,CAAC,EAAErF,GAAG,EAAE,EAAE;QAChD,MAAMT,IAAI,GAAG,IAAI,CAAChE,MAAM,CAACoG,IAAI,CAACZ,OAAO,CAAC;UAACzB,GAAG;AAAEU,UAAAA;AAAG,SAAC,CAAC;QACjD,IAAIT,IAAI,KAAK7D,SAAS,EAAE;AACxB,QAAA,IAAI,CAAC,IAAI,CAACoJ,YAAY,CAACvF,IAAI,CAAC,EAAE;AAC9B,QAAA,IAAI+F,OAAO,CAAC9F,GAAG,CAACD,IAAI,CAAC,EAAE;AACvB+F,QAAAA,OAAO,CAACrF,GAAG,CAACV,IAAI,CAAC;AACjB,QAAA,MAAMA,IAAI;AACZ;AACF;AACF;AAMQkF,EAAAA,YAAYA,CAClBvB,UAAkB,EAClBsB,QAAgB,EAChBe,OAAuC,EAAA;IAEvC,MAAMC,QAAQ,GAAmB,EAAE;IACnC,KAAK,MAAMjG,IAAI,IAAI,IAAI,CAACyF,WAAW,CAAC9B,UAAU,EAAEsB,QAAQ,CAAC,EAAE;AACzD,MAAA,MAAMH,QAAQ,GAAG9E,IAAI,CAAC+E,QAAQ,EAAE;MAChCkB,QAAQ,CAAC/K,IAAI,CAAC,CAAC8E,IAAI,EAAE8E,QAAQ,CAAC,CAAC;MAC/B9E,IAAI,CAAC+E,QAAQ,CAACvH,GAAG,CAACwI,OAAO,CAAClB,QAAQ,CAAC,CAAC;AACtC;AACA,IAAA,IAAI,CAACF,SAAS,CAACpH,GAAG,CAACyI,QAAQ,CAAC;AAC9B;AACD;;MCrEYC,IAAI,CAAA;EAyCMlK,MAAA;EAvCZmK,IAAI;EAGJC,aAAa;EAGbC,kBAAkB;EAGlBC,iBAAiB;EAGjBC,eAAe,GAAGC,YAAY,CAAS,MAAM,IAAI,CAACJ,aAAa,CAACpE,YAAY,EAAE,CAAC;AAG/EyE,EAAAA,mBAAmB,GAAGpK,QAAQ,CAAC,MAAM,IAAI,CAAC8J,IAAI,CAAC3E,OAAO,CAAC,IAAI,CAAC+E,eAAe,EAAE,CAAC,CAAC;AAG/EG,EAAAA,gBAAgB,GAAGxK,MAAM,CAAC,IAAI,CAAC;AAG/ByK,EAAAA,WAAW,GAAwBtK,QAAQ,CAAC,MACnD,IAAI,CAAC8J,IAAI,CACNnH,KAAK,EAAE,CACP4H,IAAI,EAAE,CACNC,MAAM,CAACC,CAAC,IAAI,IAAI,CAACR,iBAAiB,CAACf,YAAY,CAACuB,CAAC,CAAC,CAAA,CAClDjK,KAAK,CAACiK,CAAC,IAAIA,CAAC,CAAC/B,QAAQ,EAAE,CAAC,CAC5B;EAGQnC,YAAY,GAAuBA,MAAM,IAAI,CAACwD,aAAa,CAACxD,YAAY,EAAE;EAG1EH,YAAY,GAAwBA,MAAM,IAAI,CAAC2D,aAAa,CAAC3D,YAAY,EAAE;EAG3ED,gBAAgB,GAAmCA,MAC1D,IAAI,CAAC4D,aAAa,CAAC5D,gBAAgB,EAAE;EAEvC9F,WAAAA,CAAqBV,MAAqB,EAAA;IAArB,IAAM,CAAAA,MAAA,GAANA,MAAM;AACzB,IAAA,IAAI,CAACmK,IAAI,GAAG,IAAIpH,QAAQ,CAAC/C,MAAM,CAAC;AAChC,IAAA,IAAI,CAACoK,aAAa,GAAG,IAAItE,SAAS,CAAC;AAAC,MAAA,GAAG9F,MAAM;MAAEoG,IAAI,EAAE,IAAI,CAAC+D;AAAI,KAAC,CAAC;AAChE,IAAA,IAAI,CAACE,kBAAkB,GAAG,IAAIhD,cAAc,CAAC;AAC3C,MAAA,GAAGrH,MAAM;MACToG,IAAI,EAAE,IAAI,CAAC+D,IAAI;MACf3C,SAAS,EAAE,IAAI,CAAC4C;AACjB,KAAA,CAAC;AACF,IAAA,IAAI,CAACE,iBAAiB,GAAG,IAAI3B,aAAa,CAAC;AACzC,MAAA,GAAG3I,MAAM;MACToG,IAAI,EAAE,IAAI,CAAC+D,IAAI;MACf3C,SAAS,EAAE,IAAI,CAAC4C;AACjB,KAAA,CAAC;AACJ;EAGAvG,QAAQA,CAACG,IAAO,EAAA;IACd,MAAM+G,KAAK,GAAG,IAAI,CAACZ,IAAI,CAACzE,SAAS,CAAC1B,IAAI,CAAC,EAAED,GAAG;IAC5C,OAAOgH,KAAK,KAAK5K,SAAS,GAAG4K,KAAK,GAAG,CAAC,GAAG5K,SAAS;AACpD;EAGA2D,QAAQA,CAACE,IAAO,EAAA;IACd,MAAM+G,KAAK,GAAG,IAAI,CAACZ,IAAI,CAACzE,SAAS,CAAC1B,IAAI,CAAC,EAAES,GAAG;IAC5C,OAAOsG,KAAK,KAAK5K,SAAS,GAAG4K,KAAK,GAAG,CAAC,GAAG5K,SAAS;AACpD;EAGA6K,YAAYA,CAAChH,IAAO,EAAA;AAClB,IAAA,OAAO,IAAI,CAACoG,aAAa,CAACvD,eAAe,CAAC7C,IAAI,CAAC;AACjD;AAGAiH,EAAAA,EAAEA,CAAC3J,OAAmB,EAAE,EAAA;IACtB,OAAO,IAAI,CAAC4J,sBAAsB,CAChC,MACE5J,IAAI,CAAC6J,MAAM,GACP,IAAI,CAACC,sBAAsB,CAAC,MAC1B,IAAI,CAACf,kBAAkB,CAAC3C,IAAI,CAACV,SAAS,CAACC,EAAE,EAAE,IAAI,CAACsD,eAAe,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAA,GAEpF,IAAI,CAACF,kBAAkB,CAACrC,OAAO,CAAChB,SAAS,CAACC,EAAE,CAAC,EACnD3F,IAAI,CACL;AACH;AAGA+J,EAAAA,IAAIA,CAAC/J,OAAmB,EAAE,EAAA;IACxB,OAAO,IAAI,CAAC4J,sBAAsB,CAChC,MACE5J,IAAI,CAAC6J,MAAM,GACP,IAAI,CAACC,sBAAsB,CAAC,MAC1B,IAAI,CAACf,kBAAkB,CAAC3C,IAAI,CAACV,SAAS,CAACE,IAAI,EAAE,IAAI,CAACqD,eAAe,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAA,GAEtF,IAAI,CAACF,kBAAkB,CAACrC,OAAO,CAAChB,SAAS,CAACE,IAAI,CAAC,EACrD5F,IAAI,CACL;AACH;AAGAgK,EAAAA,IAAIA,CAAChK,OAAmB,EAAE,EAAA;IACxB,OAAO,IAAI,CAAC4J,sBAAsB,CAChC,MACE5J,IAAI,CAAC6J,MAAM,GACP,IAAI,CAACC,sBAAsB,CAAC,MAC1B,IAAI,CAACf,kBAAkB,CAAC3C,IAAI,CAACV,SAAS,CAACG,IAAI,EAAE,IAAI,CAACoD,eAAe,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAA,GAEtF,IAAI,CAACF,kBAAkB,CAACrC,OAAO,CAAChB,SAAS,CAACG,IAAI,CAAC,EACrD7F,IAAI,CACL;AACH;AAGAiK,EAAAA,KAAKA,CAACjK,OAAmB,EAAE,EAAA;IACzB,OAAO,IAAI,CAAC4J,sBAAsB,CAChC,MACE5J,IAAI,CAAC6J,MAAM,GACP,IAAI,CAACC,sBAAsB,CAAC,MAC1B,IAAI,CAACf,kBAAkB,CAAC3C,IAAI,CAACV,SAAS,CAACI,KAAK,EAAE,IAAI,CAACmD,eAAe,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAA,GAEvF,IAAI,CAACF,kBAAkB,CAACrC,OAAO,CAAChB,SAAS,CAACI,KAAK,CAAC,EACtD9F,IAAI,CACL;AACH;AAGAe,EAAAA,KAAKA,CAACf,OAAmB,EAAE,EAAA;AACzB,IAAA,OAAO,IAAI,CAAC4J,sBAAsB,CAChC,MACE5J,IAAI,CAAC6J,MAAM,GACP,IAAI,CAACC,sBAAsB,CAAC,MAAM,IAAI,CAACf,kBAAkB,CAAC/H,SAAS,CAACnC,SAAS,EAAE,IAAI,CAAC,CAAA,GACpF,IAAI,CAACkK,kBAAkB,CAAChI,KAAK,EAAE,EACrCf,IAAI,CACL;AACH;AAGAkK,EAAAA,UAAUA,CAAClK,OAAmB,EAAE,EAAA;IAC9B,MAAMyC,GAAG,GAAG,IAAI,CAACqG,aAAa,CAACpE,YAAY,EAAE,CAACjC,GAAG;AACjD,IAAA,OAAO,IAAI,CAACmH,sBAAsB,CAChC,MACE5J,IAAI,CAAC6J,MAAM,GACP,IAAI,CAACC,sBAAsB,CAAC,MAAM,IAAI,CAACf,kBAAkB,CAAC/H,SAAS,CAACyB,GAAG,EAAE,IAAI,CAAC,CAAA,GAC9E,IAAI,CAACsG,kBAAkB,CAAChI,KAAK,CAAC0B,GAAG,CAAC,EACxCzC,IAAI,CACL;AACH;AAGAiB,EAAAA,IAAIA,CAACjB,OAAmB,EAAE,EAAA;AACxB,IAAA,OAAO,IAAI,CAAC4J,sBAAsB,CAChC,MACE5J,IAAI,CAAC6J,MAAM,GACP,IAAI,CAACC,sBAAsB,CAAC,MAAM,IAAI,CAACf,kBAAkB,CAAC7H,QAAQ,CAACrC,SAAS,EAAE,IAAI,CAAC,CAAA,GACnF,IAAI,CAACkK,kBAAkB,CAAC9H,IAAI,EAAE,EACpCjB,IAAI,CACL;AACH;AAGAmK,EAAAA,SAASA,CAACnK,OAAmB,EAAE,EAAA;IAC7B,MAAMyC,GAAG,GAAG,IAAI,CAACqG,aAAa,CAACpE,YAAY,EAAE,CAACjC,GAAG;AACjD,IAAA,OAAO,IAAI,CAACmH,sBAAsB,CAChC,MACE5J,IAAI,CAAC6J,MAAM,GACP,IAAI,CAACC,sBAAsB,CAAC,MAAM,IAAI,CAACf,kBAAkB,CAAC7H,QAAQ,CAACuB,GAAG,EAAE,IAAI,CAAC,CAAA,GAC7E,IAAI,CAACsG,kBAAkB,CAAC9H,IAAI,CAACwB,GAAG,CAAC,EACvCzC,IAAI,CACL;AACH;AAGAoK,EAAAA,SAASA,GAAA;IACP,MAAM3H,GAAG,GAAG,IAAI,CAACqG,aAAa,CAACpE,YAAY,EAAE,CAACjC,GAAG;AACjD,IAAA,IAAI,CAACuG,iBAAiB,CAAChB,WAAW,EAAE;AACpC,IAAA,IAAI,CAACgB,iBAAiB,CAACtB,MAAM,CAAC;MAACjF,GAAG;AAAEU,MAAAA,GAAG,EAAE;AAAE,KAAA,EAAE;MAACV,GAAG;AAAEU,MAAAA,GAAG,EAAE,IAAI,CAAC0F,IAAI,CAAC7G,WAAW;AAAG,KAAA,CAAC;AACnF;AAGAqI,EAAAA,SAASA,GAAA;IACP,MAAMlH,GAAG,GAAG,IAAI,CAAC2F,aAAa,CAACpE,YAAY,EAAE,CAACvB,GAAG;AACjD,IAAA,IAAI,CAAC6F,iBAAiB,CAAChB,WAAW,EAAE;AACpC,IAAA,IAAI,CAACgB,iBAAiB,CAACtB,MAAM,CAAC;AAACjF,MAAAA,GAAG,EAAE,CAAC;AAAEU,MAAAA;AAAI,KAAA,EAAE;AAACV,MAAAA,GAAG,EAAE,IAAI,CAACoG,IAAI,CAAClH,WAAW,EAAE;AAAEwB,MAAAA;AAAI,KAAA,CAAC;AACnF;AAGAuE,EAAAA,MAAMA,GAAA;AACJ,IAAA,IAAI,CAACsB,iBAAiB,CAACtB,MAAM,CAAC,IAAI,CAACoB,aAAa,CAACpE,YAAY,EAAE,CAAC;AAClE;AAGAmD,EAAAA,QAAQA,GAAA;AACN,IAAA,IAAI,CAACmB,iBAAiB,CAACnB,QAAQ,CAAC,IAAI,CAACiB,aAAa,CAACpE,YAAY,EAAE,CAAC;AACpE;AAMAoD,EAAAA,MAAMA,GAAA;AACJ,IAAA,IAAI,CAACkB,iBAAiB,CAAClB,MAAM,CAAC,IAAI,CAACgB,aAAa,CAACpE,YAAY,EAAE,CAAC;AAClE;AAGA4F,EAAAA,SAASA,GAAA;AACP,IAAA,MAAM7C,QAAQ,GAAG,CAAC,CAAC,IAAI,CAACqB,aAAa,CAACrE,UAAU,EAAE,EAAEgD,QAAQ,EAAE;AAC9D,IAAA,IAAIA,QAAQ,EAAE;MACZ,IAAI,CAACI,QAAQ,EAAE;AACf,MAAA;AACF;IAEA,IAAI,CAACG,WAAW,EAAE;IAClB,IAAI,CAACN,MAAM,EAAE;AACf;AAGAK,EAAAA,SAASA,GAAA;AACP,IAAA,IAAI,CAACiB,iBAAiB,CAACjB,SAAS,EAAE;AACpC;AAGAC,EAAAA,WAAWA,GAAA;AACT,IAAA,IAAI,CAACgB,iBAAiB,CAAChB,WAAW,EAAE;AACtC;AAGA/B,EAAAA,QAAQA,CAACvD,IAAO,EAAE1C,IAAA,GAAmB,EAAE,EAAA;AACrC,IAAA,OAAO,IAAI,CAAC4J,sBAAsB,CAChC,MACE5J,IAAI,CAAC6J,MAAM,GACP,IAAI,CAACC,sBAAsB,CAAC,MAAM,IAAI,CAACjB,IAAI,CAACzE,SAAS,CAAC1B,IAAI,CAAC,CAAA,GAC3D,IAAI,CAACqG,kBAAkB,CAAC9C,QAAQ,CAACvD,IAAI,CAAC,EAC5C1C,IAAI,CACL;AACH;AAGAuK,EAAAA,eAAeA,GAAA;AAEb,IAAA,MAAMC,qBAAqB,GAAkB,IAAI,CAAC3B,IAAI,CACnDnH,KAAK,EAAE,CACP4H,IAAI,EAAE,CACNC,MAAM,CAACC,CAAC,IAAI,IAAI,CAACV,aAAa,CAAC7I,WAAW,CAACuJ,CAAC,CAAC,CAAA,CAC7CrI,IAAI,CAACqI,CAAC,IAAIA,CAAC,CAAC/B,QAAQ,EAAE,CAAC;IAE1B,IAAI+C,qBAAqB,KAAK3L,SAAS,EAAE;AACvC,MAAA,IAAI,CAACiK,aAAa,CAACtD,SAAS,CAACgF,qBAAqB,CAAC;AACnD,MAAA,OAAO,IAAI;AACb;IAGA,MAAMC,oBAAoB,GAAG,IAAI,CAAC1B,kBAAkB,CAAC/H,SAAS,EAAE;IAEhE,IAAIyJ,oBAAoB,KAAK5L,SAAS,EAAE;AACtC,MAAA,OAAO,IAAI,CAACiK,aAAa,CAACrD,gBAAgB,CAACgF,oBAAoB,CAAC;AAClE;AAEA,IAAA,OAAO,KAAK;AACd;AAGAC,EAAAA,UAAUA,GAAA;AACR,IAAA,IAAI,IAAI,CAAC5B,aAAa,CAACnE,UAAU,EAAE,EAAE;AACnC,MAAA,OAAO,IAAI,CAAC4F,eAAe,EAAE;AAC/B;AAEA,IAAA,IAAI,IAAI,CAACzB,aAAa,CAAClE,UAAU,EAAE,EAAE;AAEnC,MAAA,IAAI,IAAI,CAACkE,aAAa,CAACtD,SAAS,CAAC,IAAI,CAACsD,aAAa,CAACrE,UAAU,EAAG,CAAC,EAAE;AAClE,QAAA,OAAO,IAAI;AACb;AAGA,MAAA,IAAI,IAAI,CAACqE,aAAa,CAACrD,gBAAgB,CAAC,IAAI,CAACqD,aAAa,CAACpE,YAAY,EAAE,CAAC,EAAE;AAC1E,QAAA,OAAO,IAAI;AACb;AAGA,MAAA,IAAI,IAAI,CAACoE,aAAa,CAACrD,gBAAgB,CAAC,IAAI,CAACsD,kBAAkB,CAAC/H,SAAS,EAAG,CAAC,EAAE;AAC7E,QAAA,OAAO,IAAI;AACb;AACF;AAEA,IAAA,OAAO,KAAK;AACd;EAGQ8I,sBAAsBA,CAACa,MAAgC,EAAA;AAC7D,IAAA,MAAMtH,MAAM,GAAGsH,MAAM,EAAE;AACvB,IAAA,MAAMC,OAAO,GAAGvH,MAAM,KAAKxE,SAAS;AACpC,IAAA,IAAI,CAAC+L,OAAO,EAAE,OAAO,KAAK;AAC1B,IAAA,IAAI,CAAC3B,eAAe,CAAC/I,GAAG,CAACmD,MAAM,CAAC;AAChC,IAAA,OAAOuH,OAAO;AAChB;AAGQC,EAAAA,qBAAqBA,GAAA;AAC3B,IAAA,IAAI,CAAC,IAAI,CAACzB,gBAAgB,EAAE,EAAE;AAC5B,MAAA,IAAI,CAACJ,iBAAiB,CAACzB,IAAI,EAAE;AAC/B;IACA,IAAI,CAACyB,iBAAiB,CAACtB,MAAM,CAC3B,GAAG,IAAI,CAACoD,mBAAmB,CAAC,IAAI,CAAChC,aAAa,CAACpE,YAAY,EAAE,EAAE,IAAI,CAACuE,eAAe,EAAE,CAAC,CACvF;AACH;AAGQ6B,EAAAA,mBAAmBA,CAACC,WAAmB,EAAEC,SAAiB,EAAA;IAChE,MAAMC,SAAS,GAAG,IAAI,CAACpC,IAAI,CAAC3E,OAAO,CAAC6G,WAAW,CAAE;IACjD,MAAMG,OAAO,GAAG,IAAI,CAACrC,IAAI,CAAC3E,OAAO,CAAC8G,SAAS,CAAE;IAC7C,MAAMG,SAAS,GAAG,CAAC,GAAG,IAAI,CAACtC,IAAI,CAACxE,YAAY,CAAC4G,SAAS,CAAE,EAAE,GAAG,IAAI,CAACpC,IAAI,CAACxE,YAAY,CAAC6G,OAAO,CAAE,CAAC;IAC9F,MAAME,OAAO,GAAGD,SAAS,CAACE,GAAG,CAAC7B,CAAC,IAAIA,CAAC,CAAC/G,GAAG,CAAC;IACzC,MAAM6I,OAAO,GAAGH,SAAS,CAACE,GAAG,CAAC7B,CAAC,IAAIA,CAAC,CAACrG,GAAG,CAAC;AACzC,IAAA,MAAMkD,UAAU,GAAG;AACjB5D,MAAAA,GAAG,EAAEb,IAAI,CAACyG,GAAG,CAAC,GAAG+C,OAAO,CAAC;AACzBjI,MAAAA,GAAG,EAAEvB,IAAI,CAACyG,GAAG,CAAC,GAAGiD,OAAO;KACzB;AACD,IAAA,MAAM3D,QAAQ,GAAG;AACflF,MAAAA,GAAG,EAAEb,IAAI,CAACC,GAAG,CAAC,GAAGuJ,OAAO,CAAC;AACzBjI,MAAAA,GAAG,EAAEvB,IAAI,CAACC,GAAG,CAAC,GAAGyJ,OAAO;KACzB;AAED,IAAA,OAAO,CAACjF,UAAU,EAAEsB,QAAQ,CAAC;AAC/B;AAGQiC,EAAAA,sBAAsBA,CAAC2B,EAAiB,EAAEvL,IAAA,GAAmB,EAAE,EAAA;AACrE,IAAA,MAAM4K,OAAO,GAAGW,EAAE,EAAE;AACpB,IAAA,IAAI,CAACX,OAAO,EAAE,OAAO,KAAK;IAE1B,IAAI5K,IAAI,CAAC6J,MAAM,EAAE;MACf,IAAI,CAACgB,qBAAqB,EAAE;AAC5B,MAAA,IAAI,CAACzB,gBAAgB,CAAClJ,GAAG,CAAC,KAAK,CAAC;AAChC,MAAA,OAAO0K,OAAO;AAChB;AAGA,IAAA,IAAI,CAACxB,gBAAgB,CAAClJ,GAAG,CAAC,IAAI,CAAC;IAE/B,IAAIF,IAAI,CAAC0H,MAAM,EAAE;MACf,IAAI,CAACA,MAAM,EAAE;AACb,MAAA,OAAOkD,OAAO;AAChB;IAEA,IAAI5K,IAAI,CAACwL,SAAS,EAAE;MAClB,IAAI,CAACxD,WAAW,EAAE;MAClB,IAAI,CAACN,MAAM,EAAE;AACb,MAAA,OAAOkD,OAAO;AAChB;IAEA,IAAI5K,IAAI,CAAC8H,MAAM,EAAE;MACf,IAAI,CAACA,MAAM,EAAE;AACb,MAAA,OAAO8C,OAAO;AAChB;IAEA,IAAI5K,IAAI,CAACsK,SAAS,EAAE;AAClB,MAAA,MAAM7C,QAAQ,GAAG,CAAC,CAAC,IAAI,CAACqB,aAAa,CAACrE,UAAU,EAAE,EAAEgD,QAAQ,EAAE;MAC9D,IAAI,CAACO,WAAW,EAAE;MAClB,IAAI,CAACP,QAAQ,EAAE;QACb,IAAI,CAACC,MAAM,EAAE;AACf;AACA,MAAA,OAAOkD,OAAO;AAChB;AAEA,IAAA,OAAOA,OAAO;AAChB;AACD;;MCxXYa,WAAW,CAAA;EA4LD/M,MAAA;EA1LZgN,YAAY;AAGZhK,EAAAA,KAAK,GAAG3C,QAAQ,CAAC,MAAM,IAAI,CAAC2M,YAAY,CAAC7C,IAAI,CAACnH,KAAK,EAAE,CAAC;EAGtDiK,QAAQ,GAAG5M,QAAQ,CAAC,MAAM,IAAI,CAAC2M,YAAY,CAACpG,YAAY,EAAE,CAAC;EAG3DhG,QAAQ,GAAGP,QAAQ,CAAC,MAAM,IAAI,CAAC2M,YAAY,CAACvG,YAAY,EAAE,CAAC;EAG3DD,gBAAgB,GAAGnG,QAAQ,CAAC,MAAM,IAAI,CAAC2M,YAAY,CAACxG,gBAAgB,EAAE,CAAC;AAGvET,EAAAA,UAAU,GAAG1F,QAAQ,CAAC,MAAM,IAAI,CAAC2M,YAAY,CAAC5C,aAAa,CAACrE,UAAU,EAAE,CAAC;AAGzEmH,EAAAA,UAAU,GAA4C7M,QAAQ,CAAC,MACtE,IAAI,CAACL,MAAM,CAACmN,eAAe,EAAE,IAAI,IAAI,CAACnN,MAAM,CAACoN,KAAK,EAAE,GAChD,IAAI,CAACJ,YAAY,CAACvC,mBAAmB,EAAE,GACvCtK,SAAS,CACd;AAGQkN,EAAAA,eAAe,GAAwBhN,QAAQ,CAAC,MACvD,IAAI,CAAC2M,YAAY,CAAC7C,IAAI,CACnBnH,KAAK,EAAE,CACP4H,IAAI,EAAE,CACN0C,MAAM,CAAC,CAACC,GAAG,EAAEzC,CAAC,KAAKyC,GAAG,IAAIzC,CAAC,CAAC0C,WAAW,EAAE,EAAE,KAAK,CAAC,CACrD;AAGQC,EAAAA,SAAS,GAAGvN,MAAM,CAAC,KAAK,CAAC;AAGzBwN,EAAAA,cAAc,GAAGxN,MAAM,CAAC,KAAK,CAAC;AAG9ByN,EAAAA,QAAQ,GAAGzN,MAAM,CAAC,KAAK,CAAC;AAGxB0N,EAAAA,UAAU,GAAGvN,QAAQ,CAAC,MAC7B,IAAI,CAACL,MAAM,CAAC6N,aAAa,EAAE,KAAK,KAAK,GAAG,YAAY,GAAG,WAAW,CACnE;AAGQC,EAAAA,UAAU,GAAGzN,QAAQ,CAAC,MAC7B,IAAI,CAACL,MAAM,CAAC6N,aAAa,EAAE,KAAK,KAAK,GAAG,WAAW,GAAG,YAAY,CACnE;EAGQE,OAAO,GAAG1N,QAAQ,CAAC,MAAK;AAC/B,IAAA,MAAM2N,OAAO,GAAG,IAAIpP,oBAAoB,EAAE;AAE1C,IAAA,IAAI,IAAI,CAACyO,eAAe,EAAE,EAAE;AAC1B,MAAA,OAAOW,OAAO;AAChB;AAGA,IAAA,MAAM1M,IAAI,GAAe;AACvBwL,MAAAA,SAAS,EAAE,IAAI,CAAC9M,MAAM,CAACmN,eAAe,EAAE,IAAI,IAAI,CAACnN,MAAM,CAACiO,aAAa,EAAE,KAAK;KAC7E;AACDD,IAAAA,OAAO,CACJlP,EAAE,CAAC,SAAS,EAAE,MAAM,IAAI,CAACkO,YAAY,CAAC/B,EAAE,CAAC3J,IAAI,CAAC,CAAA,CAC9CxC,EAAE,CAAC,WAAW,EAAE,MAAM,IAAI,CAACkO,YAAY,CAAC3B,IAAI,CAAC/J,IAAI,CAAC,CAAA,CAClDxC,EAAE,CAAC,IAAI,CAAC8O,UAAU,EAAE,EAAE,MAAM,IAAI,CAACZ,YAAY,CAAC1B,IAAI,CAAChK,IAAI,CAAC,CAAA,CACxDxC,EAAE,CAAC,IAAI,CAACgP,UAAU,EAAE,EAAE,MAAM,IAAI,CAACd,YAAY,CAACzB,KAAK,CAACjK,IAAI,CAAC,CAAA,CACzDxC,EAAE,CAAC,MAAM,EAAE,MAAM,IAAI,CAACkO,YAAY,CAACxB,UAAU,CAAClK,IAAI,CAAC,CAAA,CACnDxC,EAAE,CAAC,KAAK,EAAE,MAAM,IAAI,CAACkO,YAAY,CAACvB,SAAS,CAACnK,IAAI,CAAC,CAAA,CACjDxC,EAAE,CAAC,CAAC9B,QAAQ,CAACY,IAAI,CAAC,EAAE,MAAM,EAAE,MAAM,IAAI,CAACoP,YAAY,CAAC3K,KAAK,CAACf,IAAI,CAAC,CAAA,CAC/DxC,EAAE,CAAC,CAAC9B,QAAQ,CAACY,IAAI,CAAC,EAAE,KAAK,EAAE,MAAM,IAAI,CAACoP,YAAY,CAACzK,IAAI,CAACjB,IAAI,CAAC,CAAC;AAGjE,IAAA,IAAI,IAAI,CAACtB,MAAM,CAACmN,eAAe,EAAE,IAAI,IAAI,CAACnN,MAAM,CAACiO,aAAa,EAAE,KAAK,UAAU,EAAE;AAC/ED,MAAAA,OAAO,CAAClP,EAAE,CAAC,SAAS,EAAE,MACpB,IAAI,CAACkB,MAAM,CAACoN,KAAK,EAAE,GAAG,IAAI,CAACJ,YAAY,CAAC5D,MAAM,EAAE,GAAG,IAAI,CAAC4D,YAAY,CAACpB,SAAS,EAAE,CACjF;AACH;AAGA,IAAA,IAAI,IAAI,CAAC5L,MAAM,CAACmN,eAAe,EAAE,IAAI,IAAI,CAACnN,MAAM,CAACkO,oBAAoB,EAAE,EAAE;AACvEF,MAAAA,OAAO,CACJlP,EAAE,CAAC9B,QAAQ,CAACc,KAAK,EAAE,SAAS,EAAE,MAAM,IAAI,CAACkP,YAAY,CAAC/B,EAAE,CAAC;AAACE,QAAAA,MAAM,EAAE;AAAK,OAAA,CAAC,CAAA,CACxErM,EAAE,CAAC9B,QAAQ,CAACc,KAAK,EAAE,WAAW,EAAE,MAAM,IAAI,CAACkP,YAAY,CAAC3B,IAAI,CAAC;AAACF,QAAAA,MAAM,EAAE;OAAK,CAAC,CAAA,CAC5ErM,EAAE,CAAC9B,QAAQ,CAACc,KAAK,EAAE,IAAI,CAAC8P,UAAU,EAAE,EAAE,MAAM,IAAI,CAACZ,YAAY,CAAC1B,IAAI,CAAC;AAACH,QAAAA,MAAM,EAAE;OAAK,CAAC,CAAA,CAClFrM,EAAE,CAAC9B,QAAQ,CAACc,KAAK,EAAE,IAAI,CAACgQ,UAAU,EAAE,EAAE,MAAM,IAAI,CAACd,YAAY,CAACzB,KAAK,CAAC;AAACJ,QAAAA,MAAM,EAAE;AAAK,OAAA,CAAC,CAAA,CACnFrM,EAAE,CAAC9B,QAAQ,CAACc,KAAK,EAAE,MAAM,EAAE,MAAM,IAAI,CAACkP,YAAY,CAACxB,UAAU,CAAC;AAACL,QAAAA,MAAM,EAAE;AAAK,OAAA,CAAC,CAAA,CAC7ErM,EAAE,CAAC9B,QAAQ,CAACc,KAAK,EAAE,KAAK,EAAE,MAAM,IAAI,CAACkP,YAAY,CAACvB,SAAS,CAAC;AAACN,QAAAA,MAAM,EAAE;OAAK,CAAC,CAAA,CAC3ErM,EAAE,CAAC,CAAC9B,QAAQ,CAACY,IAAI,GAAGZ,QAAQ,CAACc,KAAK,CAAC,EAAE,MAAM,EAAE,MAAM,IAAI,CAACkP,YAAY,CAAC3K,KAAK,CAAC;AAAC8I,QAAAA,MAAM,EAAE;OAAK,CAAC,CAAA,CAC1FrM,EAAE,CAAC,CAAC9B,QAAQ,CAACY,IAAI,GAAGZ,QAAQ,CAACc,KAAK,CAAC,EAAE,KAAK,EAAE,MAAM,IAAI,CAACkP,YAAY,CAACzK,IAAI,CAAC;AAAC4I,QAAAA,MAAM,EAAE;AAAK,OAAA,CAAC,CAAA,CACxFrM,EAAE,CAAC,CAAC9B,QAAQ,CAACY,IAAI,EAAEZ,QAAQ,CAACkB,IAAI,CAAC,EAAE,GAAG,EAAE,MAAK;AAC5C,QAAA,IAAI,IAAI,CAAC8O,YAAY,CAACrC,WAAW,EAAE,EAAE;AACnC,UAAA,IAAI,CAACqC,YAAY,CAAC1D,WAAW,EAAE;AACjC,SAAA,MAAO;AACL,UAAA,IAAI,CAAC0D,YAAY,CAAC3D,SAAS,EAAE;AAC/B;OACD,CAAA,CACAvK,EAAE,CAAC,CAAC9B,QAAQ,CAACc,KAAK,CAAC,EAAE,GAAG,EAAE,MAAM,IAAI,CAACkP,YAAY,CAACtB,SAAS,EAAE,CAAA,CAC7D5M,EAAE,CAAC,CAAC9B,QAAQ,CAACY,IAAI,EAAEZ,QAAQ,CAACkB,IAAI,CAAC,EAAE,GAAG,EAAE,MAAM,IAAI,CAAC8O,YAAY,CAACrB,SAAS,EAAE,CAAC;AACjF;AAEA,IAAA,OAAOqC,OAAO;AAChB,GAAC,CAAC;EAGOG,WAAW,GAAG9N,QAAQ,CAAC,MAAK;AACnC,IAAA,MAAM2N,OAAO,GAAG,IAAIrO,mBAAmB,EAAE;IAGzC,IAAI,CAAC,IAAI,CAACK,MAAM,CAACmN,eAAe,EAAE,EAAE;AAClCa,MAAAA,OAAO,CAAClP,EAAE,CAACsP,CAAC,IAAG;QACb,MAAMpK,IAAI,GAAG,IAAI,CAAChE,MAAM,CAACwF,OAAO,CAAC4I,CAAC,CAACC,MAAiB,CAAC;AACrD,QAAA,IAAI,CAACrK,IAAI,IAAI,CAAC,IAAI,CAACgJ,YAAY,CAAC5C,aAAa,CAAC7I,WAAW,CAACyC,IAAI,CAAC,EAAE;AAEjE,QAAA,IAAI,CAACgJ,YAAY,CAACzF,QAAQ,CAACvD,IAAI,CAAC;AAClC,OAAC,CAAC;AACJ;AAGA,IAAA,IAAI,IAAI,CAAChE,MAAM,CAACmN,eAAe,EAAE,EAAE;AACjCa,MAAAA,OAAO,CAAClP,EAAE,CAACsP,CAAC,IAAG;QACb,MAAMpK,IAAI,GAAG,IAAI,CAAChE,MAAM,CAACwF,OAAO,CAAC4I,CAAC,CAACC,MAAiB,CAAC;AACrD,QAAA,IAAI,CAACrK,IAAI,IAAI,CAAC,IAAI,CAACgJ,YAAY,CAAC5C,aAAa,CAAC7I,WAAW,CAACyC,IAAI,CAAC,EAAE;AAEjE,QAAA,IAAI,CAACgJ,YAAY,CAACzF,QAAQ,CAACvD,IAAI,EAAE;UAC/B8I,SAAS,EAAE,IAAI,CAAC9M,MAAM,CAACiO,aAAa,EAAE,KAAK,QAAQ;AACnDrC,UAAAA,SAAS,EAAE,IAAI,CAAC5L,MAAM,CAACiO,aAAa,EAAE,KAAK,UAAU,IAAI,CAAC,IAAI,CAACjO,MAAM,CAACoN,KAAK,EAAE;AAC7EhE,UAAAA,MAAM,EAAE,IAAI,CAACpJ,MAAM,CAACiO,aAAa,EAAE,KAAK,UAAU,IAAI,IAAI,CAACjO,MAAM,CAACoN,KAAK;AACxE,SAAA,CAAC;AAEF,QAAA,IAAI,IAAI,CAACpN,MAAM,CAACoN,KAAK,EAAE,IAAI,IAAI,CAACpN,MAAM,CAACkO,oBAAoB,EAAE,EAAE;AAC7D,UAAA,IAAI,CAACP,QAAQ,CAACnM,GAAG,CAAC,IAAI,CAAC;AACzB;AACF,OAAC,CAAC;AAGF,MAAA,IAAI,IAAI,CAACxB,MAAM,CAACoN,KAAK,EAAE,EAAE;AACvBY,QAAAA,OAAO,CAAClP,EAAE,CAAC,CAAC9B,QAAQ,CAACY,IAAI,EAAEZ,QAAQ,CAACkB,IAAI,CAAC,EAAEkQ,CAAC,IAAG;UAC7C,MAAMpK,IAAI,GAAG,IAAI,CAAChE,MAAM,CAACwF,OAAO,CAAC4I,CAAC,CAACC,MAAiB,CAAC;AACrD,UAAA,IAAI,CAACrK,IAAI,IAAI,CAAC,IAAI,CAACgJ,YAAY,CAAC5C,aAAa,CAAC7I,WAAW,CAACyC,IAAI,CAAC,EAAE;AAEjE,UAAA,IAAI,CAACgJ,YAAY,CAACzF,QAAQ,CAACvD,IAAI,EAAE;AAACoF,YAAAA,MAAM,EAAE;AAAI,WAAC,CAAC;AAEhD,UAAA,IAAI,IAAI,CAACpJ,MAAM,CAACkO,oBAAoB,EAAE,EAAE;AACtC,YAAA,IAAI,CAACP,QAAQ,CAACnM,GAAG,CAAC,IAAI,CAAC;AACzB;AACF,SAAC,CAAC;AAEF,QAAA,IAAI,IAAI,CAACxB,MAAM,CAACkO,oBAAoB,EAAE,EAAE;UACtCF,OAAO,CAAClP,EAAE,CAAC9B,QAAQ,CAACc,KAAK,EAAEsQ,CAAC,IAAG;YAC7B,MAAMpK,IAAI,GAAG,IAAI,CAAChE,MAAM,CAACwF,OAAO,CAAC4I,CAAC,CAACC,MAAiB,CAAC;YACrD,IAAI,CAACrK,IAAI,EAAE;AAEX,YAAA,IAAI,CAACgJ,YAAY,CAACzF,QAAQ,CAACvD,IAAI,EAAE;AAACmH,cAAAA,MAAM,EAAE;AAAI,aAAC,CAAC;AAChD,YAAA,IAAI,CAACwC,QAAQ,CAACnM,GAAG,CAAC,IAAI,CAAC;AACzB,WAAC,CAAC;AACJ;AACF;AACF;AAEA,IAAA,OAAOwM,OAAO;AAChB,GAAC,CAAC;EAGOM,SAAS,GAAGjO,QAAQ,CAAC,MAAK;AACjC,IAAA,MAAM2N,OAAO,GAAG,IAAIrO,mBAAmB,EAAE;AAEzC,IAAA,IAAI,IAAI,CAACK,MAAM,CAACmN,eAAe,EAAE,IAAI,IAAI,CAACnN,MAAM,CAACkO,oBAAoB,EAAE,EAAE;MACvEF,OAAO,CAAClP,EAAE,CAAC,CAAC9B,QAAQ,CAACc,KAAK,EAAEd,QAAQ,CAACY,IAAI,EAAEZ,QAAQ,CAACkB,IAAI,EAAElB,QAAQ,CAACqC,IAAI,CAAC,EAAE,MAAK;AAC7E,QAAA,IAAI,CAACsO,QAAQ,CAACnM,GAAG,CAAC,KAAK,CAAC;AAC1B,OAAC,CAAC;AACJ;AAEA,IAAA,OAAOwM,OAAO;AAChB,GAAC,CAAC;AAGeO,EAAAA,cAAc,GAAGrO,MAAM,CAAC,KAAK,CAAC;AAG9BsO,EAAAA,SAAS,GAAGtO,MAAM,CAAC,KAAK,CAAC;AAGzBuO,EAAAA,WAAW,GAAGvO,MAAM,CAAC,KAAK,CAAC;EAE5CQ,WAAAA,CAAqBV,MAAkB,EAAA;IAAlB,IAAM,CAAAA,MAAA,GAANA,MAAM;AACzB,IAAA,IAAI,CAACgN,YAAY,GAAG,IAAI9C,IAAI,CAAC;AAC3B,MAAA,GAAGlK,MAAM;MACTgD,KAAK,EAAE3C,QAAQ,CAAC,MAAM,IAAI,CAACL,MAAM,CAAC0O,IAAI,EAAE,CAAC/B,GAAG,CAAC5I,GAAG,IAAIA,GAAG,CAAC/D,MAAM,CAACgD,KAAK,EAAE,CAAC;AACxE,KAAA,CAAC;AACJ;EAGA2L,SAASA,CAACvR,KAAoB,EAAA;AAC5B,IAAA,IAAI,IAAI,CAACwD,QAAQ,EAAE,EAAE;IAErB,IAAI,CAACmF,UAAU,EAAE,EAAE4I,SAAS,CAACvR,KAAK,CAAC;IACnC,IAAI,CAAC2Q,OAAO,EAAE,CAAC5Q,MAAM,CAACC,KAAK,CAAC;AAC9B;EAGAwR,aAAaA,CAACxR,KAAmB,EAAA;AAC/B,IAAA,IAAI,IAAI,CAACwD,QAAQ,EAAE,EAAE;IAErB,IAAI,CAACuN,WAAW,EAAE,CAAChR,MAAM,CAACC,KAAK,CAAC;AAClC;EAGAyR,aAAaA,CAACzR,KAAmB,EAAA;AAC/B,IAAA,IACE,IAAI,CAACwD,QAAQ,EAAE,IACf,CAAC,IAAI,CAACZ,MAAM,CAACmN,eAAe,EAAE,IAC9B,CAAC,IAAI,CAACnN,MAAM,CAACkO,oBAAoB,EAAE,IACnC,CAAC,IAAI,CAACP,QAAQ,EAAE,EAChB;AACA,MAAA;AACF;IAEA,MAAM3J,IAAI,GAAG,IAAI,CAAChE,MAAM,CAACwF,OAAO,CAACpI,KAAK,CAACiR,MAAiB,CAAC;IAGzD,IAAIrK,IAAI,KAAK7D,SAAS,EAAE;AACtB,MAAA,IAAI,CAAC6M,YAAY,CAACzF,QAAQ,CAACvD,IAAI,EAAE;AAACmH,QAAAA,MAAM,EAAE;AAAI,OAAC,CAAC;AAClD;AACF;EAGA2D,WAAWA,CAAC1R,KAAmB,EAAA;AAC7B,IAAA,IAAI,IAAI,CAACwD,QAAQ,EAAE,EAAE;IAErB,IAAI,CAAC0N,SAAS,EAAE,CAACnR,MAAM,CAACC,KAAK,CAAC;AAChC;EAGA2R,SAASA,CAAC3R,KAAiB,EAAA;AACzB,IAAA,IAAI,CAACqQ,SAAS,CAACjM,GAAG,CAAC,IAAI,CAAC;AACxB,IAAA,IAAI,CAACkM,cAAc,CAAClM,GAAG,CAAC,IAAI,CAAC;AAG7B,IAAA,IAAI,IAAI,CAACmM,QAAQ,EAAE,EAAE;IAGrB,MAAM3J,IAAI,GAAG,IAAI,CAAChE,MAAM,CAACwF,OAAO,CAACpI,KAAK,CAACiR,MAAwB,CAAC;AAChE,IAAA,IAAI,CAACrK,IAAI,IAAI,CAAC,IAAI,CAACgJ,YAAY,CAAC5C,aAAa,CAAC7I,WAAW,CAACyC,IAAI,CAAC,EAAE;AAGjEA,IAAAA,IAAI,CAAC+K,SAAS,CAAC3R,KAAK,CAAC;AAIrB,IAAA,IAAI4G,IAAI,KAAK,IAAI,CAAC+B,UAAU,EAAE,EAAE;AAC9B,MAAA,IAAI,CAACiH,YAAY,CAACzF,QAAQ,CAACvD,IAAI,CAAC;AAClC;AACF;EAGAgL,UAAUA,CAAC5R,KAAiB,EAAA;AAE1B,IAAA,MAAM6R,UAAU,GAAG7R,KAAK,CAACiR,MAAwB;IACjD,MAAMrK,IAAI,GAAG,IAAI,CAAChE,MAAM,CAACwF,OAAO,CAACyJ,UAAU,CAAC;AAG5CjL,IAAAA,IAAI,EAAEgL,UAAU,CAAC5R,KAAK,CAAC;AAEvB,IAAA,MAAM8R,WAAW,GAAG9R,KAAK,CAAC+R,aAA+B;AACzD,IAAA,IAAI,IAAI,CAACnP,MAAM,CAAC0B,OAAO,EAAE,CAAC0N,QAAQ,CAACF,WAAW,CAAC,EAAE;IAKjD,IAAIA,WAAW,KAAK,IAAI,EAAE;AACxB,MAAA,IAAI,CAACX,cAAc,CAAC/M,GAAG,CAAC,IAAI,CAAC;AAC/B;AAEA,IAAA,IAAI,CAACiM,SAAS,CAACjM,GAAG,CAAC,KAAK,CAAC;AAC3B;AAGA6N,EAAAA,qBAAqBA,GAAA;AACnB,IAAA,IAAI,IAAI,CAAC3B,cAAc,EAAE,EAAE;AAE3B,IAAA,IAAI,CAACV,YAAY,CAACnB,eAAe,EAAE;AACrC;AAGAyD,EAAAA,gBAAgBA,GAAA;IACd,MAAMC,QAAQ,GAAG,IAAI,CAACvC,YAAY,CAAChB,UAAU,EAAE;AAE/C,IAAA,IAAIuD,QAAQ,EAAE;AAGZ,MAAA,IAAI,IAAI,CAAChB,cAAc,EAAE,EAAE;AACzB,QAAA,IAAI,CAACC,SAAS,CAAChN,GAAG,CAAC,IAAI,CAAC;AAC1B,OAAA,MAAO;AACL,QAAA,IAAI,CAACiN,WAAW,CAACjN,GAAG,CAAC,IAAI,CAAC;AAC5B;AACF;AAEA,IAAA,IAAI,CAAC+M,cAAc,CAAC/M,GAAG,CAAC,KAAK,CAAC;AAChC;AAGAgO,EAAAA,gBAAgBA,GAAA;AACd,IAAA,MAAMtJ,UAAU,GAAG,IAAI,CAACuI,WAAW,EAAE;IACrC,IAAI,CAACvI,UAAU,EAAE;IAEjB,MAAMuH,SAAS,GAAGgC,SAAS,CAAC,MAAM,IAAI,CAAChC,SAAS,EAAE,CAAC;AACnD,IAAA,MAAMiC,QAAQ,GAAGD,SAAS,CAAC,MAAM,IAAI,CAACzP,MAAM,CAACgB,SAAS,EAAE,KAAK,QAAQ,CAAC;IACtE,MAAM+E,UAAU,GAAG0J,SAAS,CAAC,MAAM,IAAI,CAAC1J,UAAU,EAAE,CAAC;AAErD,IAAA,IAAI2J,QAAQ,IAAI3J,UAAU,KAAK5F,SAAS,IAAIsN,SAAS,EAAE;AACrD,MAAA,IAAI,CAAC1H,UAAU,CAAC0H,SAAS,EAAE,EAAE;QAC3B1H,UAAU,CAAC1E,KAAK,EAAE;AACpB;AACF;AAEA,IAAA,IAAI,CAACoN,WAAW,CAACjN,GAAG,CAAC,KAAK,CAAC;AAC7B;AAGAmO,EAAAA,kBAAkBA,GAAA;AAChB,IAAA,MAAMC,QAAQ,GAAG,IAAI,CAACpB,SAAS,EAAE;IACjC,IAAI,CAACoB,QAAQ,EAAE;AAEf,IAAA,MAAMF,QAAQ,GAAGD,SAAS,CAAC,MAAM,IAAI,CAACzP,MAAM,CAACgB,SAAS,EAAE,KAAK,QAAQ,CAAC;IACtE,MAAM+E,UAAU,GAAG0J,SAAS,CAAC,MAAM,IAAI,CAAC1J,UAAU,EAAE,CAAC;AAErD,IAAA,IAAI2J,QAAQ,IAAI3J,UAAU,KAAK5F,SAAS,EAAE;AACxC,MAAA,IAAI,CAAC4F,UAAU,CAAC0H,SAAS,EAAE,EAAE;QAC3B1H,UAAU,CAAC1E,KAAK,EAAE;AACpB;AACF;AAEA,IAAA,IAAI,CAACmN,SAAS,CAAChN,GAAG,CAAC,KAAK,CAAC;AAC3B;AAGAqO,EAAAA,WAAWA,GAAA;AACT,IAAA,MAAM9J,UAAU,GAAG,IAAI,CAACA,UAAU,EAAE;IACpC,MAAM+J,WAAW,GAAGL,SAAS,CAAC,MAAM,IAAI,CAAChC,SAAS,EAAE,CAAC;AAErD,IAAA,IAAI1H,UAAU,KAAK5F,SAAS,IAAI,CAAC2P,WAAW,EAAE;AAE9C,IAAA,MAAMJ,QAAQ,GAAGD,SAAS,CAAC,MAAM,IAAI,CAACzP,MAAM,CAACgB,SAAS,EAAE,KAAK,QAAQ,CAAC;IACtE,MAAM+O,WAAW,GAAGN,SAAS,CAAC,MAAM1J,UAAU,CAAC0H,SAAS,EAAE,CAAC;AAE3D,IAAA,IAAIiC,QAAQ,IAAI,CAACK,WAAW,EAAE;MAC5BhK,UAAU,CAAC1E,KAAK,EAAE;AACpB;AACF;AACD;;MCnXY2O,cAAc,CAAA;EAIJhQ,MAAA;EAFrB6D,QAAQ;EAERnD,WAAAA,CAAqBV,MAAqB,EAAA;IAArB,IAAM,CAAAA,MAAA,GAANA,MAAM;AACzB,IAAA,IAAI,CAAC6D,QAAQ,GAAG7D,MAAM,CAAC6D,QAAQ;AACjC;AACD;;MCaYoM,eAAe,CAAA;EAgJLjQ,MAAA;EA9IZiB,EAAE,GAAuBA,MAAM,IAAI,CAACjB,MAAM,CAACiB,EAAE,EAAE;EAG/CS,OAAO,GAA4BA,MAAM,IAAI,CAAC1B,MAAM,CAAC0B,OAAO,EAAE;AAG9D+L,EAAAA,SAAS,GAA4BvN,MAAM,CAAC,KAAK,CAAC;EAGlD6I,QAAQ;EAGRS,UAAU,GAAwBA,MAAM,IAAI,CAACxJ,MAAM,CAACwJ,UAAU,EAAE;EAGhE5I,QAAQ,GAAwBA,MAAM,IAAI,CAACZ,MAAM,CAACY,QAAQ,EAAE;EAG5DuD,OAAO,GAAuBA,MAAM,IAAI,CAACnE,MAAM,CAACmE,OAAO,EAAE;EAGzDE,OAAO,GAAuBA,MAAM,IAAI,CAACrE,MAAM,CAACqE,OAAO,EAAE;AAGzD6L,EAAAA,MAAM,GAAwB7P,QAAQ,CAAC,MAAM,IAAI,CAACL,MAAM,CAACoG,IAAI,EAAE,CAACL,UAAU,EAAE,KAAK,IAAI,CAAC;EAGtFoF,MAAM,GAAiC9K,QAAQ,CAAC,MACvD,IAAI,CAACL,MAAM,CAACoG,IAAI,EAAE,CAAC8G,UAAU,EAAE,KAAK,IAAI,GAAG,IAAI,GAAG/M,SAAS,CAC5D;AAGQgQ,EAAAA,YAAY,GAAoC9P,QAAQ,CAAC,MAChE,IAAI,CAACL,MAAM,CAACoG,IAAI,EAAE,CAACpG,MAAM,CAACmN,eAAe,EAAE,IAAI,IAAI,CAAC3D,UAAU,EAAE,GAAG,IAAI,CAACT,QAAQ,EAAE,GAAG5I,SAAS,CAC/F;AAGQiQ,EAAAA,YAAY,GAAmC/P,QAAQ,CAC9D,MACE,IAAI,CAACL,MAAM,CAAC+D,GAAG,EAAE,CAACF,QAAQ,EAAE,IAC5B,IAAI,CAAC7D,MAAM,CAAC6D,QAAQ,EAAE,IACtB,IAAI,CAAC7D,MAAM,CAACoG,IAAI,EAAE,CAAC4G,YAAY,CAACnJ,QAAQ,CAAC,IAAI,CAAC,CACjD;EAGQwM,YAAY,GAAmChQ,QAAQ,CAC9D,MAAM,IAAI,CAACL,MAAM,CAAC8D,QAAQ,EAAE,IAAI,IAAI,CAAC9D,MAAM,CAACoG,IAAI,EAAE,CAAC4G,YAAY,CAAClJ,QAAQ,CAAC,IAAI,CAAC,CAC/E;AAGgBwM,EAAAA,SAAS,GAAuBjQ,QAAQ,CAAC,MACxD,IAAI,CAACL,MAAM,CAACoG,IAAI,EAAE,CAAC4G,YAAY,CAAChC,YAAY,CAAC,IAAI,CAAC,CACnD;EAGQiC,QAAQ,GAAuB5M,QAAQ,CAAC,MAAK;IACpD,IAAI,IAAI,CAACkQ,gBAAgB,EAAE,IAAI,IAAI,CAACC,mBAAmB,EAAE,EAAE;AACzD,MAAA,OAAO,CAAC,CAAC;AACX;AACA,IAAA,OAAO,IAAI,CAACF,SAAS,EAAE;AACzB,GAAC,CAAC;AAKOC,EAAAA,gBAAgB,GAAwBlQ,QAAQ,CACvD,MAAM,IAAI,CAACL,MAAM,CAACyQ,OAAO,EAAE,CAAC5Q,MAAM,KAAK,CAAC,CACzC;AAGQ6Q,EAAAA,eAAe,GAAwBrQ,QAAQ,CAAC,MAAM,IAAI,CAACL,MAAM,CAACyQ,OAAO,EAAE,CAAC5Q,MAAM,GAAG,CAAC,CAAC;EAGvF8Q,kBAAkB,GAAwBtQ,QAAQ,CACzD,MAAM,CAAC,IAAI,CAACqQ,eAAe,EAAE,IAAI,CAAC,IAAI,CAACR,MAAM,EAAE,IAAI,IAAI,CAAClQ,MAAM,CAACY,QAAQ,EAAE,CAC1E;EAGQwJ,aAAa;EAGbC,kBAAkB;AAGlBuG,EAAAA,YAAY,GAA0DpG,YAAY,CAAC,MAC1F,IAAI,CAACxK,MAAM,CAACyQ,OAAO,EAAE,CAAC5Q,MAAM,GAAG,CAAC,GAAG,IAAI,CAACG,MAAM,CAACyQ,OAAO,EAAE,CAAC,CAAC,CAAC,GAAGtQ,SAAS,CACxE;AAGQqQ,EAAAA,mBAAmB,GAAgCtQ,MAAM,CAAC,KAAK,CAAC;EAGhE2Q,eAAe,GAAwBxQ,QAAQ,CAAC,MACvD,IAAI,CAACL,MAAM,CAACyQ,OAAO,EAAE,CAAC9R,IAAI,CAACmS,CAAC,IAAIA,CAAC,CAACtD,WAAW,EAAE,CAAC,CACjD;AAGQA,EAAAA,WAAW,GAAwBnN,QAAQ,CAClD,MAAM,IAAI,CAACmQ,mBAAmB,EAAE,IAAI,IAAI,CAACK,eAAe,EAAE,CAC3D;EAGQE,OAAO,GAAG1Q,QAAQ,CAAC,MAAK;IAC/B,IAAI,IAAI,CAACL,MAAM,CAACgR,WAAW,EAAE,KAAK,UAAU,EAAE;AAC5C,MAAA,OAAO,SAAS;AAClB;AACA,IAAA,OAAO,IAAI,CAAChR,MAAM,CAAC6N,aAAa,EAAE,KAAK,KAAK,GAAG,YAAY,GAAG,WAAW;AAC3E,GAAC,CAAC;EAGOoD,OAAO,GAAG5Q,QAAQ,CAAC,MAAK;IAC/B,IAAI,IAAI,CAACL,MAAM,CAACgR,WAAW,EAAE,KAAK,UAAU,EAAE;AAC5C,MAAA,OAAO,WAAW;AACpB;AACA,IAAA,OAAO,IAAI,CAAChR,MAAM,CAAC6N,aAAa,EAAE,KAAK,KAAK,GAAG,WAAW,GAAG,YAAY;AAC3E,GAAC,CAAC;EAGOE,OAAO,GAAG1N,QAAQ,CAAC,MAAK;AAC/B,IAAA,MAAM2N,OAAO,GAAG,IAAIpP,oBAAoB,EAAE;AAG1C,IAAA,IAAI,CAAC,IAAI,CAAC4R,mBAAmB,EAAE,EAAE;MAC/BxC,OAAO,CAAClP,EAAE,CAAC,OAAO,EAAE,MAAM,IAAI,CAACoS,eAAe,EAAE,CAAC;AACjD,MAAA,OAAOlD,OAAO;AAChB;AAGAA,IAAAA,OAAO,CACJlP,EAAE,CAAC,QAAQ,EAAE,MAAM,IAAI,CAACqS,cAAc,EAAE,CAAA,CACxCrS,EAAE,CAAC,IAAI,CAACiS,OAAO,EAAE,EAAE,MAClB,IAAI,CAAC/O,QAAQ,CAAC,MAAM,IAAI,CAACqI,kBAAkB,CAAClI,IAAI,CAAC;AAACV,MAAAA,YAAY,EAAE;KAAM,CAAC,CAAC,CAAA,CAEzE3C,EAAE,CAAC,IAAI,CAACmS,OAAO,EAAE,EAAE,MAClB,IAAI,CAACjP,QAAQ,CAAC,MAAM,IAAI,CAACqI,kBAAkB,CAACtI,IAAI,CAAC;AAACN,MAAAA,YAAY,EAAE;AAAM,KAAA,CAAC,CAAC,CAAA,CAEzE3C,EAAE,CAAC,MAAM,EAAE,MAAM,IAAI,CAACkD,QAAQ,CAAC,MAAM,IAAI,CAACqI,kBAAkB,CAACtI,IAAI,CAAC;AAACN,MAAAA,YAAY,EAAE;AAAK,KAAC,CAAC,CAAC,CAAA,CACzF3C,EAAE,CAAC,KAAK,EAAE,MAAM,IAAI,CAACkD,QAAQ,CAAC,MAAM,IAAI,CAACqI,kBAAkB,CAACtI,IAAI,CAAC;AAACN,MAAAA,YAAY,EAAE;KAAM,CAAC,CAAC,CAAC;AAE5F,IAAA,OAAOuM,OAAO;AAChB,GAAC,CAAC;EAEFtN,WAAAA,CAAqBV,MAAsB,EAAA;IAAtB,IAAM,CAAAA,MAAA,GAANA,MAAM;AACzB,IAAA,IAAI,CAAC+I,QAAQ,GAAG/I,MAAM,CAAC+I,QAAQ;AAE/B,IAAA,MAAMqI,oBAAoB,GAAgD;AACxE,MAAA,GAAGpR,MAAM;MACTM,KAAK,EAAEN,MAAM,CAACyQ,OAAO;MACrBhQ,UAAU,EAAE,IAAI,CAACmQ,YAAY;MAC7BhQ,QAAQ,EAAE,IAAI,CAAC+P,kBAAkB;MACjC3P,SAAS,EAAEA,MAAM,QAAQ;MACzBW,YAAY,EAAEA,MAAM;KACrB;AAED,IAAA,IAAI,CAACyI,aAAa,GAAG,IAAIrK,SAAS,CAAwBqR,oBAAoB,CAAC;AAC/E,IAAA,IAAI,CAAC/G,kBAAkB,GAAG,IAAIzI,cAAc,CAAwB;AAClE,MAAA,GAAGwP,oBAAoB;MACvBtP,YAAY,EAAE,IAAI,CAACsI;AACpB,KAAA,CAAC;AACJ;EAGAuE,SAASA,CAACvR,KAAoB,EAAA;AAC5B,IAAA,IAAI,IAAI,CAACwD,QAAQ,EAAE,IAAI,IAAI,CAACZ,MAAM,CAACyQ,OAAO,EAAE,CAAC5Q,MAAM,KAAK,CAAC,EAAE;AAG3D,IAAA,IAAI,IAAI,CAAC0Q,gBAAgB,EAAE,EAAE;MAC3B,IAAI,CAACK,YAAY,EAAG,CAACjC,SAAS,CAACvR,KAAK,CAAC;AACrC,MAAA;AACF;AAGA,IAAA,IAAI,CAAC,IAAI,CAACoT,mBAAmB,EAAE,EAAE;MAC/B,IAAI,CAACzC,OAAO,EAAE,CAAC5Q,MAAM,CAACC,KAAK,CAAC;AAC5B,MAAA;AACF;AAGA,IAAA,MAAMyT,eAAe,GAAG,IAAI,CAACA,eAAe,EAAE;IAE9C,IAAI,CAACD,YAAY,EAAG,CAACjC,SAAS,CAACvR,KAAK,CAAC;IAErC,IAAI,CAACyT,eAAe,EAAE;MACpB,IAAI,CAAC9C,OAAO,EAAE,CAAC5Q,MAAM,CAACC,KAAK,CAAC;AAC9B;AACF;EAGA2R,SAASA,CAAC3R,KAAiB,EAAA;AACzB,IAAA,IAAI,CAACqQ,SAAS,CAACjM,GAAG,CAAC,IAAI,CAAC;AAExB,IAAA,MAAM0N,WAAW,GAAG9R,KAAK,CAACiR,MAAwB;IAClD,MAAMgD,MAAM,GAAG,IAAI,CAACrR,MAAM,CAACsR,SAAS,CAACpC,WAAW,CAAC;IACjD,IAAI,CAACmC,MAAM,EAAE;AAGbA,IAAAA,MAAM,CAACtC,SAAS,CAAC3R,KAAK,CAAC;AAMvB,IAAA,IAAIiU,MAAM,KAAK,IAAI,CAACT,YAAY,EAAE,EAAE;AAClC,MAAA,IAAI,CAACvG,kBAAkB,CAACxI,IAAI,CAACwP,MAAM,EAAE;AAAC5P,QAAAA,YAAY,EAAE;AAAK,OAAC,CAAC;AAC7D;AAGA,IAAA,IAAI,IAAI,CAACiP,eAAe,EAAE,EAAE;AAC1B,MAAA,IAAI,CAACF,mBAAmB,CAAChP,GAAG,CAAC,IAAI,CAAC;AACpC;AACF;EAGAwN,UAAUA,CAAC5R,KAAiB,EAAA;AAC1B,IAAA,MAAM6R,UAAU,GAAG7R,KAAK,CAACiR,MAAwB;IACjD,MAAMgD,MAAM,GAAG,IAAI,CAACrR,MAAM,CAACsR,SAAS,CAACrC,UAAU,CAAC;AAGhDoC,IAAAA,MAAM,EAAErC,UAAU,CAAC5R,KAAK,CAAC;AAEzB,IAAA,MAAM8R,WAAW,GAAG9R,KAAK,CAAC+R,aAA+B;IACzD,IAAI,IAAI,CAACzN,OAAO,EAAE,CAAC0N,QAAQ,CAACF,WAAW,CAAC,EAAE;AAE1C,IAAA,IAAI,CAACzB,SAAS,CAACjM,GAAG,CAAC,KAAK,CAAC;AAEzB,IAAA,IAAI,CAACgP,mBAAmB,CAAChP,GAAG,CAAC,KAAK,CAAC;AACrC;AAGAH,EAAAA,KAAKA,GAAA;AACH,IAAA,IAAI,IAAI,CAACkP,gBAAgB,EAAE,EAAE;AAC3B,MAAA,IAAI,CAACK,YAAY,EAAE,EAAEvP,KAAK,EAAE;AAC9B,KAAA,MAAO;AACL,MAAA,IAAI,CAACK,OAAO,EAAE,CAACL,KAAK,EAAE;AACxB;AACF;AAGAkQ,EAAAA,cAAcA,GAAA;AACZ,IAAA,IAAI,IAAI,CAAChB,gBAAgB,EAAE,EAAE;AAC3B,MAAA,OAAO,IAAI,CAACD,SAAS,EAAE;AACzB;IACA,OAAO,IAAI,CAACE,mBAAmB,EAAE,GAAG,CAAC,GAAG,CAAC,CAAC;AAC5C;AAGAU,EAAAA,eAAeA,GAAA;AACb,IAAA,IAAI,IAAI,CAACV,mBAAmB,EAAE,EAAE;AAEhC,IAAA,IAAI,CAACA,mBAAmB,CAAChP,GAAG,CAAC,IAAI,CAAC;AAClC,IAAA,IAAI,CAAC6I,kBAAkB,CAAChI,KAAK,EAAE;AACjC;AAGA8O,EAAAA,cAAcA,GAAA;AACZ,IAAA,IAAI,CAAC,IAAI,CAACX,mBAAmB,EAAE,EAAE;AAEjC,IAAA,IAAI,CAACA,mBAAmB,CAAChP,GAAG,CAAC,KAAK,CAAC;AACnC,IAAA,IAAI,CAACE,OAAO,EAAE,CAACL,KAAK,EAAE;AACxB;EAGQW,QAAQA,CAAC6K,EAAiB,EAAA;AAChC,IAAA,MAAMX,OAAO,GAAGW,EAAE,EAAE;AACpB,IAAA,IAAIX,OAAO,EAAE;AACX,MAAA,IAAI,CAAC0E,YAAY,EAAE,EAAEvP,KAAK,EAAE;AAC9B;AACF;AACD;;MC7RYmQ,qBAAqB,CAAA;EA6EXxR,MAAA;EA3EZiB,EAAE,GAAuBA,MAAM,IAAI,CAACjB,MAAM,CAACiB,EAAE,EAAE;EAG/CS,OAAO,GAA4BA,MAAM,IAAI,CAAC1B,MAAM,CAAC0B,OAAO,EAAE;AAG9D+P,EAAAA,UAAU,GAAwBpR,QAAQ,CACjD,MAAM,IAAI,CAACL,MAAM,CAACkP,WAAW,EAAE,IAAI,IAAI,CAACxN,OAAO,EAAE,CAClD;EAGQqJ,KAAK,GAAmB1K,QAAQ,CAAC,MACxC,IAAI,CAACL,MAAM,CAACgE,IAAI,EAAE,CAAChE,MAAM,CAACyQ,OAAO,EAAE,CAAClQ,OAAO,CAAC,IAAI,CAAC,CAClD;EAGQK,QAAQ,GAAoBP,QAAQ,CAC3C,MAAM,IAAI,CAACL,MAAM,CAACY,QAAQ,EAAE,IAAI,IAAI,CAACZ,MAAM,CAACgE,IAAI,EAAE,CAACpD,QAAQ,EAAE,CAC9D;AAGQqM,EAAAA,QAAQ,GAAmB5M,QAAQ,CAAC,MAAM,IAAI,CAACL,MAAM,CAACgE,IAAI,EAAE,CAACuN,cAAc,EAAE,CAAC;AAG9ErB,EAAAA,MAAM,GAAoB7P,QAAQ,CAAC,MAAM,IAAI,CAACL,MAAM,CAACgE,IAAI,EAAE,CAAC4M,YAAY,EAAE,KAAK,IAAI,CAAC;AAGpFpD,EAAAA,WAAW,GAA4BtN,MAAM,CAAC,KAAK,CAAC;AAGpDwR,EAAAA,iBAAiB,GACxBxR,MAAM,CAACC,SAAS,CAAC;AAGVwR,EAAAA,mBAAmB,GAC1BzR,MAAM,CAACC,SAAS,CAAC;EAGV4N,OAAO,GAAG1N,QAAQ,CAAC,MAAK;AAC/B,IAAA,MAAM2N,OAAO,GAAG,IAAIpP,oBAAoB,EAAE;IAG1C,IAAI,IAAI,CAACoB,MAAM,CAAC4R,UAAU,EAAE,KAAK,QAAQ,EAAE;AACzC,MAAA,OAAO5D,OAAO;AAChB;AAGA,IAAA,IAAI,IAAI,CAACR,WAAW,EAAE,EAAE;AACtBQ,MAAAA,OAAO,CAAClP,EAAE,CAAC,QAAQ,EAAEsP,CAAC,IAAG;AACvB,QAAA,IAAI,CAACyD,UAAU,CAACzD,CAAC,CAAC;QAClB,IAAI,CAAC/M,KAAK,EAAE;AACd,OAAC,CAAC;MAEF,IAAI,IAAI,CAACrB,MAAM,CAAC4R,UAAU,EAAE,KAAK,UAAU,EAAE;AAC3C5D,QAAAA,OAAO,CAAClP,EAAE,CAAC,OAAO,EAAEsP,CAAC,IAAG;AACtB,UAAA,IAAI,CAACyD,UAAU,CAACzD,CAAC,CAAC;UAClB,IAAI,CAAC/M,KAAK,EAAE;AACd,SAAC,CAAC;AACJ;AAEA,MAAA,OAAO2M,OAAO;AAChB;AAGAA,IAAAA,OAAO,CAAClP,EAAE,CAAC,OAAO,EAAEsP,CAAC,IAAI,IAAI,CAAC0D,QAAQ,CAAC1D,CAAC,CAAC,CAAC;IAE1C,IAAI,IAAI,CAACpO,MAAM,CAAC4R,UAAU,EAAE,KAAK,UAAU,EAAE;MAC3C5D,OAAO,CAAClP,EAAE,CAAC,CAAC9B,QAAQ,CAACc,KAAK,EAAEd,QAAQ,CAACqC,IAAI,CAAC,EAAE,eAAe,EAAE+O,CAAC,IAAI,IAAI,CAAC0D,QAAQ,CAAC1D,CAAC,CAAC,EAAE;AAClF5Q,QAAAA,cAAc,EAAE;AACjB,OAAA,CAAC;AACJ;AAEA,IAAA,OAAOwQ,OAAO;AAChB,GAAC,CAAC;EAEFtN,WAAAA,CAAqBV,MAA4B,EAAA;IAA5B,IAAM,CAAAA,MAAA,GAANA,MAAM;AAAyB;EAGpD2O,SAASA,CAACvR,KAAoB,EAAA;AAC5B,IAAA,IAAI,IAAI,CAACwD,QAAQ,EAAE,EAAE;IAErB,IAAI,CAACmN,OAAO,EAAE,CAAC5Q,MAAM,CAACC,KAAK,CAAC;AAC9B;EAGA2R,SAASA,CAAC3R,KAAiB,EAAA;IAEzB,IAAI,IAAI,CAAC4C,MAAM,CAAC4R,UAAU,EAAE,KAAK,QAAQ,EAAE;AAG3C,IAAA,MAAM1C,WAAW,GAAG9R,KAAK,CAACiR,MAAiB;AAC3C,IAAA,IAAI,IAAI,CAACoD,UAAU,EAAE,CAACrC,QAAQ,CAACF,WAAW,CAAC,IAAI,IAAI,CAACuC,UAAU,EAAE,KAAKvC,WAAW,EAAE;AAChF,MAAA,IAAI,CAAC4C,QAAQ,CAAC1U,KAAK,CAAC;AACtB;AACF;EAGA4R,UAAUA,CAAC5R,KAAiB,EAAA;AAC1B,IAAA,MAAM8R,WAAW,GAAG9R,KAAK,CAAC+R,aAAwB;IAClD,IAAI,IAAI,CAACsC,UAAU,EAAE,CAACrC,QAAQ,CAACF,WAAW,CAAC,EAAE;AAG7C,IAAA,IAAI,CAAC2C,UAAU,CAACzU,KAAK,CAAC;AACxB;AAGAiE,EAAAA,KAAKA,GAAA;AACH,IAAA,IAAI,CAACoQ,UAAU,EAAE,CAACpQ,KAAK,EAAE;AAC3B;EAGAyQ,QAAQA,CAAC1U,KAAkC,EAAA;AACzC,IAAA,IAAI,IAAI,CAACoQ,WAAW,EAAE,EAAE;IACxB,IAAI,IAAI,CAACxN,MAAM,CAAC4R,UAAU,EAAE,KAAK,QAAQ,EAAE;AAE3C,IAAA,IAAI,CAACpE,WAAW,CAAChM,GAAG,CAAC,IAAI,CAAC;AAC1B,IAAA,IAAI,CAACkQ,iBAAiB,CAAClQ,GAAG,CAACpE,KAAK,CAAC;AACnC;EAGAyU,UAAUA,CAACzU,KAAkC,EAAA;AAC3C,IAAA,IAAI,CAAC,IAAI,CAACoQ,WAAW,EAAE,EAAE;AAEzB,IAAA,IAAI,CAACA,WAAW,CAAChM,GAAG,CAAC,KAAK,CAAC;AAC3B,IAAA,IAAI,CAACmQ,mBAAmB,CAACnQ,GAAG,CAACpE,KAAK,CAAC;AACrC;AACD;;;;"}